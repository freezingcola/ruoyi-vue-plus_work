import{d as ye,V as we,aa as be,r as u,Y as M,aK as ke,b as Ce,o as m,c as Ve,k as e,m as t,e as l,a3 as I,x,y as d,ab as Se,w as C,t as W,a7 as P,p as _,T as K,q as z,D as De,aC as Ee,a0 as Ne,W as Re,a1 as $e,a2 as Te,C as Ie,G as xe,H as Ke,X as ze,a8 as Le,ak as Ue,ar as Be,a9 as Fe,am as Pe,v as Ae}from"./index-BoCONcAc.js";import{_ as qe}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as He}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as Ye}from"./index-B4NenLWv.js";/* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                       *//* empty css                        *//* empty css               *//* empty css                *//* empty css                */import{g as Qe,a as Ge,d as Je,b as Oe,e as Me}from"./index-LhLwlHgt.js";import{m as We}from"./index-Bo-V6W7V.js";import{l as Xe}from"./index-BMOFFQpT.js";import{w as je}from"./index-BWlz0r_B.js";const Ze={class:"p-2"},et={class:"mb-[10px]"},tt={class:"mb-[10px]"},at={style:{"text-align":"right",margin:"5px 0px 0px 0px"}},Ct=ye({__name:"index",setup(nt){const{proxy:o}=we(),{wf_business_status:X}=be(o==null?void 0:o.useDict("wf_business_status")),A=u(),q=u(),c=u(!0),H=u([]),j=u(!0),Y=u(!0),w=u(!0),V=u(0),Z=u(""),S=u([]),ee=u([]),L=u([]),D=u(""),b=M({visible:!1,title:"流程定义"}),f=u("running"),E=u(""),s=u({pageNum:1,pageSize:10,name:void 0,key:void 0,categoryCode:void 0}),te=a=>{s.value.categoryCode=a.categoryCode,a.categoryCode==="ALL"&&(s.value.categoryCode=""),v()},ae=(a,n)=>a?n.categoryName.indexOf(a)!==-1:!0;ke(()=>{q.value.filter(D.value)},{flush:"post"});const ne=async()=>{const a=await Xe();L.value=[];const n={categoryCode:"ALL",categoryName:"顶级节点",children:[]};n.children=o==null?void 0:o.handleTree(a.data,"id","parentId"),L.value.push(n)},v=()=>{f.value==="running"?h():U()},le=()=>{var a;(a=A.value)==null||a.resetFields(),s.value.categoryCode="",s.value.pageNum=1,s.value.pageSize=10,v()},oe=a=>{H.value=a.map(n=>n.id),j.value=a.length!==1,Y.value=!a.length},h=()=>{c.value=!0,Qe(s.value).then(a=>{S.value=a.rows,V.value=a.total,c.value=!1})},U=()=>{c.value=!0,Ge(s.value).then(a=>{S.value=a.rows,V.value=a.total,c.value=!1})},Q=async a=>{const n=a.id||H.value;await(o==null?void 0:o.$modal.confirm("是否确认删除id为【"+n+"】的数据项？")),c.value=!0,f.value==="running"?(await Je(n).finally(()=>c.value=!1),h()):(await Oe(n).finally(()=>c.value=!1),U()),o==null||o.$modal.msgSuccess("删除成功")},ie=async a=>{S.value=[],s.value.pageNum=1,a==="running"?h():U()},se=async a=>{if(await(o==null?void 0:o.$modal.confirm("是否确认作废业务id为【"+a.businessKey+"】的数据项？")),c.value=!0,f.value==="running"){let n={processInstanceId:a.id,deleteReason:E.value};await Me(n).finally(()=>c.value=!1),h(),o==null||o.$modal.msgSuccess("操作成功")}},re=async a=>{(o==null?void 0:o.$refs[`popoverRef${a}`]).hide()},de=async a=>{await(o==null?void 0:o.$modal.confirm("是否确认切换？")),c.value=!0,We(Z.value,a).then(n=>{o==null||o.$modal.msgSuccess("操作成功"),h(),b.visible=!1,c.value=!1})},ue=a=>{const n=M({wfDefinitionConfigVo:a.wfDefinitionConfigVo,wfNodeConfigVo:a.wfNodeConfigVo,businessKey:a.businessKey,taskId:a.id,type:"view"});je.routerJump(n,o)};return Ce(()=>{h(),ne()}),(a,n)=>{const N=De,ce=Ee,R=Ne,y=Re,G=$e,pe=Te,B=Ie,g=xe,me=Ke,fe=Ye,$=ze,r=Le,T=Ue,_e=He,ge=Be,J=Fe,ve=qe,he=Pe,O=Ae;return m(),Ve("div",Ze,[e($,{gutter:20},{default:t(()=>[e(y,{lg:4,xs:24,style:{}},{default:t(()=>[e(R,{shadow:"hover"},{default:t(()=>[e(N,{modelValue:l(D),"onUpdate:modelValue":n[0]||(n[0]=p=>I(D)?D.value=p:null),placeholder:"请输入流程分类名","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),e(ce,{ref_key:"categoryTreeRef",ref:q,class:"mt-2","node-key":"id",data:l(L),props:{label:"categoryName",children:"children"},"expand-on-click-node":!1,"filter-node-method":ae,"highlight-current":"","default-expand-all":"",onNodeClick:te},null,8,["data"])]),_:1})]),_:1}),e(y,{lg:20,xs:24},{default:t(()=>{var p,F;return[x("div",et,[e(R,{shadow:"hover",class:"text-center"},{default:t(()=>[e(pe,{modelValue:l(f),"onUpdate:modelValue":n[1]||(n[1]=i=>I(f)?f.value=i:null),onChange:n[2]||(n[2]=i=>ie(l(f)))},{default:t(()=>[e(G,{value:"running"},{default:t(()=>[d("运行中")]),_:1}),e(G,{value:"finish"},{default:t(()=>[d("已完成")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),e(Se,{"enter-active-class":(p=l(o))==null?void 0:p.animate.searchAnimate.enter,"leave-active-class":(F=l(o))==null?void 0:F.animate.searchAnimate.leave},{default:t(()=>[C(x("div",tt,[e(R,{shadow:"hover"},{default:t(()=>[C(e(me,{ref_key:"queryFormRef",ref:A,model:l(s),inline:!0,"label-width":"120px"},{default:t(()=>[e(B,{label:"流程定义名称",prop:"name"},{default:t(()=>[e(N,{modelValue:l(s).name,"onUpdate:modelValue":n[3]||(n[3]=i=>l(s).name=i),placeholder:"请输入流程定义名称",onKeyup:W(v,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{label:"流程定义KEY",prop:"key"},{default:t(()=>[e(N,{modelValue:l(s).key,"onUpdate:modelValue":n[4]||(n[4]=i=>l(s).key=i),placeholder:"请输入流程定义KEY",onKeyup:W(v,["enter"])},null,8,["modelValue"])]),_:1}),e(B,null,{default:t(()=>[e(g,{type:"primary",icon:"Search",onClick:v},{default:t(()=>[d("搜索")]),_:1}),e(g,{icon:"Refresh",onClick:le},{default:t(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[P,l(w)]])]),_:1})],512),[[P,l(w)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(R,{shadow:"hover"},{header:t(()=>[e($,{gutter:10,class:"mb8"},{default:t(()=>[e(y,{span:1.5},{default:t(()=>[e(g,{type:"danger",plain:"",icon:"Delete",disabled:l(Y),onClick:Q},{default:t(()=>[d("删除")]),_:1},8,["disabled"])]),_:1}),e(fe,{showSearch:l(w),"onUpdate:showSearch":n[5]||(n[5]=i=>I(w)?w.value=i:null),onQueryTable:v},null,8,["showSearch"])]),_:1})]),default:t(()=>[C((m(),_(J,{border:"",data:l(S),onSelectionChange:oe},{default:t(()=>[e(r,{type:"selection",width:"55",align:"center"}),e(r,{align:"center",type:"index",label:"序号",width:"60"}),e(r,{"show-overflow-tooltip":!0,align:"center",label:"流程定义名称"},{default:t(i=>[x("span",null,K(i.row.processDefinitionName)+"v"+K(i.row.processDefinitionVersion)+".0",1)]),_:1}),e(r,{align:"center",prop:"processDefinitionKey",label:"流程定义KEY"}),e(r,{align:"center",prop:"processDefinitionVersion",label:"版本号",width:"90"},{default:t(i=>[d(" v"+K(i.row.processDefinitionVersion)+".0",1)]),_:1}),l(f)==="running"?(m(),_(r,{key:0,align:"center",prop:"isSuspended",label:"状态","min-width":"70"},{default:t(i=>[i.row.isSuspended?(m(),_(T,{key:1,type:"danger"},{default:t(()=>[d("挂起")]),_:1})):(m(),_(T,{key:0,type:"success"},{default:t(()=>[d("激活")]),_:1}))]),_:1})):z("",!0),e(r,{align:"center",label:"流程状态","min-width":"70"},{default:t(i=>[e(_e,{options:l(X),value:i.row.businessStatus},null,8,["options","value"])]),_:1}),e(r,{align:"center",prop:"startTime",label:"启动时间",width:"160"}),l(f)==="finish"?(m(),_(r,{key:1,align:"center",prop:"endTime",label:"结束时间",width:"160"})):z("",!0),e(r,{label:"操作",align:"center",width:130},{default:t(i=>[l(f)==="running"?(m(),_($,{key:0,gutter:10,class:"mb8"},{default:t(()=>[e(y,{span:1.5},{default:t(()=>[e(ge,{ref:`popoverRef${i.$index}`,trigger:"click",placement:"left",width:300},{reference:t(()=>[e(g,{link:"",type:"primary",size:"small",icon:"CircleClose"},{default:t(()=>[d("作废")]),_:1})]),default:t(()=>[e(N,{modelValue:l(E),"onUpdate:modelValue":n[6]||(n[6]=k=>I(E)?E.value=k:null),resize:"none",rows:3,type:"textarea",placeholder:"请输入作废原因"},null,8,["modelValue"]),x("div",at,[e(g,{size:"small",text:"",onClick:k=>re(i.$index)},{default:t(()=>[d("取消")]),_:2},1032,["onClick"]),e(g,{size:"small",type:"primary",onClick:k=>se(i.row)},{default:t(()=>[d("确认")]),_:2},1032,["onClick"])])]),_:2},1536)]),_:2},1024),e(y,{span:1.5},{default:t(()=>[e(g,{link:"",type:"primary",size:"small",icon:"Delete",onClick:k=>Q(i.row)},{default:t(()=>[d("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):z("",!0),e($,{gutter:10,class:"mb8"},{default:t(()=>[e(y,{span:1.5},{default:t(()=>[e(g,{link:"",type:"primary",size:"small",icon:"View",onClick:k=>ue(i.row)},{default:t(()=>[d("查看")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[O,l(c)]]),C(e(ve,{page:l(s).pageNum,"onUpdate:page":n[7]||(n[7]=i=>l(s).pageNum=i),limit:l(s).pageSize,"onUpdate:limit":n[8]||(n[8]=i=>l(s).pageSize=i),total:l(V),onPagination:v},null,8,["page","limit","total"]),[[P,l(V)>0]])]),_:1})]}),_:1})]),_:1}),l(b).visible?(m(),_(he,{key:0,modelValue:l(b).visible,"onUpdate:modelValue":n[9]||(n[9]=p=>l(b).visible=p),title:l(b).title,width:"70%"},{default:t(()=>[C((m(),_(J,{data:l(ee)},{default:t(()=>[e(r,{fixed:"",align:"center",type:"index",label:"序号",width:"60"}),e(r,{fixed:"",align:"center",prop:"name",label:"流程定义名称"}),e(r,{align:"center",prop:"key",label:"标识Key"}),e(r,{align:"center",prop:"version",label:"版本号",width:"90"},{default:t(p=>[d(" v"+K(p.row.version)+".0",1)]),_:1}),e(r,{align:"center",prop:"suspensionState",label:"状态","min-width":"70"},{default:t(p=>[p.row.suspensionState==1?(m(),_(T,{key:0,type:"success"},{default:t(()=>[d("激活")]),_:1})):(m(),_(T,{key:1,type:"danger"},{default:t(()=>[d("挂起")]),_:1}))]),_:1}),e(r,{align:"center",prop:"deploymentTime",label:"部署时间","show-overflow-tooltip":!0}),e(r,{fixed:"right",label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:t(p=>[e(g,{link:"",type:"primary",size:"small",icon:"Sort",onClick:F=>de(p.row.id)},{default:t(()=>[d("切换")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,l(c)]])]),_:1},8,["modelValue","title"])):z("",!0)])}}});export{Ct as default};
