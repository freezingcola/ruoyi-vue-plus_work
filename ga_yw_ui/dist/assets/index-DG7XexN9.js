import{an as S,d as F,aq as v,V as M,r as d,aH as R,S as q,i as G,o as r,c as u,k as p,m as _,y as c,e as h,M as y,x as T,T as I,q as b,N as H,aI as J,G as K,ay as P,aJ as Q,L as W}from"./index-BoCONcAc.js";/* empty css                *//* empty css                    */function ce(o){return S({url:"/resource/oss/list",method:"get",params:o})}function X(o){return S({url:"/resource/oss/listByIds/"+o,method:"get"})}function Y(o){return S({url:"/resource/oss/"+o,method:"delete"})}const Z={class:"upload-file"},ee={key:0,class:"el-upload__tip"},le={style:{color:"#f56c6c"}},se={style:{color:"#f56c6c"}},te={class:"el-icon-document"},ae={class:"ele-upload-list__item-content-action"},oe=F({__name:"index",props:{modelValue:{type:[String,Object,Array],default:()=>[]},limit:v.number.def(5),fileSize:v.number.def(20),fileType:v.array.def(["doc","docx","xls","xlsx","ppt","txt","pdf","zip","rar","png","jpg"]),isShowTip:v.bool.def(!0)},emits:["update:modelValue"],setup(o,{emit:B}){const i=o,{proxy:l}=M(),E=B,f=d(0),g=d([]),L=d("/zzkj-oa"+"/resource/oss/upload"),N=d(R()),n=d([]),U=q(()=>i.isShowTip&&(i.fileType||i.fileSize)),$=d();G(()=>i.modelValue,async e=>{if(e){let t=1,s=[];Array.isArray(e)?s=e:s=(await X(e)).data.map(m=>({name:m.originalName,url:m.url,ossId:m.ossId})),n.value=s.map(a=>(a={name:a.name,url:a.url,ossId:a.ossId},a.uid=a.uid||new Date().getTime()+t++,a))}else return n.value=[],[]},{deep:!0,immediate:!0});const w=e=>{if(i.fileType.length){const t=e.name.split("."),s=t[t.length-1];if(!(i.fileType.indexOf(s)>=0))return l==null||l.$modal.msgError(`文件格式不正确, 请上传${i.fileType.join("/")}格式文件!`),!1}return i.fileSize&&!(e.size/1024/1024<i.fileSize)?(l==null||l.$modal.msgError(`上传文件大小不能超过 ${i.fileSize} MB!`),!1):(l==null||l.$modal.loading("正在上传文件，请稍候..."),f.value++,!0)},O=()=>{l==null||l.$modal.msgError(`上传文件数量不能超过 ${i.limit} 个!`)},C=()=>{l==null||l.$modal.msgError("上传文件失败")},j=(e,t)=>{var s;e.code===200?(g.value.push({name:e.data.fileName,url:e.data.url,ossId:e.data.ossId}),z()):(f.value--,l==null||l.$modal.closeLoading(),l==null||l.$modal.msgError(e.msg),(s=$.value)==null||s.handleRemove(t),z())},x=e=>{let t=n.value[e].ossId;Y(t),n.value.splice(e,1),E("update:modelValue",V(n.value))},z=()=>{f.value>0&&g.value.length===f.value&&(n.value=n.value.filter(e=>e.url!==void 0).concat(g.value),g.value=[],f.value=0,E("update:modelValue",V(n.value)),l==null||l.$modal.closeLoading())},A=e=>e.lastIndexOf("/")>-1?e.slice(e.lastIndexOf("/")+1):e,V=(e,t)=>{let s="";return t=t||",",e.forEach(a=>{a.ossId&&(s+=a.ossId+t)}),s!=""?s.substring(0,s.length-1):""};return(e,t)=>{const s=K,a=P,m=Q;return r(),u("div",Z,[p(a,{ref_key:"fileUploadRef",ref:$,multiple:"",action:h(L),"before-upload":w,"file-list":h(n),limit:o.limit,"on-error":C,"on-exceed":O,"on-success":j,"show-file-list":!1,headers:h(N),class:"upload-file-uploader"},{default:_(()=>[p(s,{type:"primary"},{default:_(()=>[c("选取文件")]),_:1})]),_:1},8,["action","file-list","limit","headers"]),h(U)?(r(),u("div",ee,[c(" 请上传 "),o.fileSize?(r(),u(y,{key:0},[c(" 大小不超过 "),T("b",le,I(o.fileSize)+"MB",1)],64)):b("",!0),o.fileType?(r(),u(y,{key:1},[c(" 格式为 "),T("b",se,I(o.fileType.join("/")),1)],64)):b("",!0),c(" 的文件 ")])):b("",!0),p(J,{class:"upload-file-list el-upload-list el-upload-list--text",name:"el-fade-in-linear",tag:"ul"},{default:_(()=>[(r(!0),u(y,null,H(h(n),(k,D)=>(r(),u("li",{key:k.uid,class:"el-upload-list__item ele-upload-list__item-content"},[p(m,{href:`${k.url}`,underline:!1,target:"_blank"},{default:_(()=>[T("span",te,I(A(k.name)),1)]),_:2},1032,["href"]),T("div",ae,[p(s,{type:"danger",link:"",onClick:ne=>x(D)},{default:_(()=>[c("删除")]),_:2},1032,["onClick"])])]))),128))]),_:1})])}}}),fe=W(oe,[["__scopeId","data-v-cd69b2fd"]]);export{fe as _,ce as a,Y as d,X as l};
