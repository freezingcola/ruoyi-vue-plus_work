import{d as M,aq as K,V as z,r as u,o as b,c as B,k as a,m as l,e,a3 as U,w as G,p as h,x as N,y as g,T as W,q as $,n as A,a4 as le,a8 as oe,ak as se,G as Y,a9 as ne,ar as re,a5 as ie,am as ue,v as J,L as de,Y as pe,aa as ce,b as me,M as ve,N as fe,a0 as be,O as _e,P as ge,C as ye,as as we,D as ke,H as Ve}from"./index-BoCONcAc.js";/* empty css                *//* empty css                       */import"./el-form-item-l0sNRNKZ.js";/* empty css                */import{g as he,u as De,a as Ie}from"./index-B85zt68h.js";import{s as Te}from"./index-DSKxzbdu.js";import{_ as $e}from"./submitVerify.vue_vue_type_script_setup_true_lang-GiF9G2vK.js";/* empty css                    *//* empty css                 *//* empty css                    *//* empty css                        */import{B as Le}from"./index-CvHQooJA.js";import{p as Ce}from"./index-LhLwlHgt.js";import"./index-DG7XexN9.js";/* empty css                *//* empty css                    */import"./index.vue_vue_type_script_setup_true_lang-Bfb_m_-c.js";/* empty css               */import"./index-B1KNwlHH.js";import"./index-BXJ8XT-L.js";/* empty css               *//* empty css                */import"./index-JZ_QvNlG.js";import"./multiInstanceUser.vue_vue_type_script_setup_true_name_User_lang-kSMcaROF.js";import"./index-B4NenLWv.js";import"./Event-BS7rISKI.js";const Ee={class:"container"},Re=M({__name:"approvalRecord",props:{width:K.string.def("70%"),height:K.string.def("100%")},setup(O,{expose:s}){const{proxy:d}=z(),w=O,n=u(!1),y=u(!1),r=u([]),D=u("bpmn"),k=u(),L=async v=>{y.value=!0,n.value=!0,D.value="bpmn",r.value=[],Ce.getHistoryRecord(v).then(f=>{r.value=f.data,n.value=!1}),await A(()=>{k.value.init(v)})},I=v=>{d==null||d.$download.oss(v)};return s({init:L}),(v,f)=>{const T=le,p=oe,t=se,C=Y,E=ne,x=re,F=ie,R=ue,P=J;return b(),B("div",Ee,[a(R,{modelValue:e(y),"onUpdate:modelValue":f[1]||(f[1]=c=>U(y)?y.value=c:null),draggable:"",title:"审批记录",width:w.width,height:w.height,"close-on-click-modal":!1},{default:l(()=>[a(F,{modelValue:e(D),"onUpdate:modelValue":f[0]||(f[0]=c=>U(D)?D.value=c:null),class:"demo-tabs"},{default:l(()=>[a(T,{label:"流程图",name:"bpmn"},{default:l(()=>[a(Le,{ref_key:"bpmnViewRef",ref:k},null,512)]),_:1}),G((b(),h(T,{label:"审批信息",name:"info"},{default:l(()=>[N("div",null,[a(E,{data:e(r),style:{width:"100%"},border:"",fit:""},{default:l(()=>[a(p,{type:"index",label:"序号",align:"center",width:"60"}),a(p,{prop:"name",label:"任务名称",sortable:"",align:"center"}),a(p,{prop:"nickName","show-overflow-tooltip":!0,label:"办理人",sortable:"",align:"center"},{default:l(c=>[a(t,{type:"success"},{default:l(()=>[g(W(c.row.nickName||"无"),1)]),_:2},1024)]),_:1}),a(p,{label:"状态",sortable:"",align:"center"},{default:l(c=>[a(t,{type:"success"},{default:l(()=>[g(W(c.row.statusName),1)]),_:2},1024)]),_:1}),a(p,{prop:"comment",label:"审批意见",sortable:"",align:"center"}),a(p,{prop:"startTime",label:"开始时间",sortable:"",align:"center"}),a(p,{prop:"endTime",label:"结束时间",sortable:"",align:"center"}),a(p,{prop:"runDuration",label:"运行时长",sortable:"",align:"center"}),a(p,{prop:"attachmentList",label:"附件",sortable:"",align:"center"},{default:l(c=>[c.row.attachmentList&&c.row.attachmentList.length>0?(b(),h(x,{key:0,placement:"right",width:310,trigger:"click"},{reference:l(()=>[a(C,{style:{"margin-right":"16px"}},{default:l(()=>[g("附件")]),_:1})]),default:l(()=>[a(E,{border:"",data:c.row.attachmentList},{default:l(()=>[a(p,{prop:"name",width:"202","show-overflow-tooltip":!0,label:"附件名称"}),a(p,{prop:"name",width:"80",align:"center","show-overflow-tooltip":!0,label:"操作"},{default:l(q=>[a(C,{type:"text",onClick:j=>I(q.row.contentId)},{default:l(()=>[g("下载")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])]),_:2},1024)):$("",!0)]),_:1})]),_:1},8,["data"])])]),_:1})),[[P,e(n)]])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","width","height"])])}}}),Se=de(Re,[["__scopeId","data-v-716adb17"]]),Ne={class:"p-2"},xe={style:{display:"flex","justify-content":"space-between"}},Fe=M({name:"Leave"}),ua=M({...Fe,setup(O){const{proxy:s}=z(),d=u(!1),w=u(!0),n=u([]),y=u(""),r=u({}),D=[{value:"1",label:"事假"},{value:"2",label:"调休"},{value:"3",label:"病假"},{value:"4",label:"婚假"}],k=u(),L=u(),I=u(),v=u({businessKey:"",tableName:"",variables:{}}),f=u({}),T={id:void 0,leaveType:void 0,startDate:void 0,endDate:void 0,leaveDays:void 0,remark:void 0,processInstanceVo:{}},p=pe({form:{...T},queryParams:{pageNum:1,pageSize:10,startLeaveDays:void 0,endLeaveDays:void 0},rules:{id:[{required:!0,message:"主键不能为空",trigger:"blur"}],leaveType:[{required:!0,message:"请假类型不能为空",trigger:"blur"}],leaveTime:[{required:!0,message:"请假时间不能为空",trigger:"blur"}],leaveDays:[{required:!0,message:"请假天数不能为空",trigger:"blur"}]}}),{form:t,rules:C}=ce(p),E=()=>{var m;t.value={...T},n.value=[],(m=I.value)==null||m.resetFields()},x=()=>{const m=new Date(n.value[0]).getTime(),_=new Date(n.value[1]).getTime()-m;t.value.leaveDays=Math.floor(_/(1e3*60*60*24))},F=()=>{w.value=!0,d.value=!1,A(async()=>{const m=await he(r.value.id);Object.assign(t.value,m.data),n.value=[],n.value.push(t.value.startDate),n.value.push(t.value.endDate),t.value.processInstanceVo&&(y.value=t.value.processInstanceVo.id),w.value=!1,d.value=!1})},R=m=>{var o;if(n.value.length===0){s==null||s.$modal.msgError("请假时间不能为空");return}try{(o=I.value)==null||o.validate(async _=>{if(t.value.startDate=n.value[0],t.value.endDate=n.value[1],_){d.value=!0;let V;t.value.id?V=await De(t.value):V=await Ie(t.value),t.value=V.data,m==="draft"?(d.value=!1,s==null||s.$modal.msgSuccess("暂存成功"),s.$tab.closePage(s.$route),s.$router.go(-1)):await P(V.data)}})}finally{d.value=!1}},P=async m=>{try{v.value.tableName="test_leave",v.value.businessKey=m.id,f.value={entity:m,leaveDays:m.leaveDays,userList:[1,3],userList2:[1,3]},v.value.variables=f.value;const o=await Te(v.value);k.value&&(d.value=!1,k.value.openDialog(o.data.taskId))}finally{d.value=!1}},c=()=>{L.value.init(y.value)},q=async()=>{await s.$tab.closePage(s.$route),s.$router.go(-1)},j=()=>{s.$tab.closePage(s.$route),s.$router.go(-1)},Q=async()=>{k.value.openDialog(r.value.taskId)};return me(()=>{A(async()=>{r.value=s.$route.query,E(),w.value=!1,(r.value.type==="update"||r.value.type==="view"||r.value.type==="approval")&&F()})}),(m,o)=>{const _=Y,V=be,X=_e,Z=ge,S=ye,ee=we,H=ke,ae=Ve,te=J;return b(),B("div",Ne,[a(V,{shadow:"never"},{default:l(()=>[N("div",xe,[N("div",null,[e(r).type==="add"||e(r).type==="update"&&e(t).processInstanceVo&&e(t).processInstanceVo.businessStatus&&(e(t).processInstanceVo.businessStatus==="draft"||e(t).processInstanceVo.businessStatus==="cancel"||e(t).processInstanceVo.businessStatus==="back")?(b(),h(_,{key:0,loading:e(d),type:"info",onClick:o[0]||(o[0]=i=>R("draft"))},{default:l(()=>[g("暂存")]),_:1},8,["loading"])):$("",!0),e(r).type==="add"||e(r).type==="update"&&e(t).processInstanceVo&&(e(t).processInstanceVo.businessStatus==="draft"||e(t).processInstanceVo.businessStatus==="cancel"||e(t).processInstanceVo.businessStatus==="back")?(b(),h(_,{key:1,loading:e(d),type:"primary",onClick:o[1]||(o[1]=i=>R("submit"))},{default:l(()=>[g("提 交")]),_:1},8,["loading"])):$("",!0),e(r).type==="approval"&&e(t).processInstanceVo&&e(t).processInstanceVo.businessStatus==="waiting"?(b(),h(_,{key:2,loading:e(d),type:"primary",onClick:Q},{default:l(()=>[g("审批")]),_:1},8,["loading"])):$("",!0),e(y)?(b(),h(_,{key:3,type:"primary",onClick:c},{default:l(()=>[g("流程进度")]),_:1})):$("",!0)]),N("div",null,[a(_,{style:{float:"right"},onClick:o[2]||(o[2]=i=>j())},{default:l(()=>[g("返回")]),_:1})])])]),_:1}),a(V,{shadow:"never",style:{height:"78vh","overflow-y":"auto"}},{default:l(()=>[G((b(),h(ae,{ref_key:"leaveFormRef",ref:I,disabled:e(r).type==="view",model:e(t),rules:e(C),"label-width":"80px"},{default:l(()=>[a(S,{label:"请假类型",prop:"leaveType"},{default:l(()=>[a(Z,{modelValue:e(t).leaveType,"onUpdate:modelValue":o[3]||(o[3]=i=>e(t).leaveType=i),placeholder:"请选择请假类型",style:{width:"100%"}},{default:l(()=>[(b(),B(ve,null,fe(D,i=>a(X,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(S,{label:"请假时间"},{default:l(()=>[a(ee,{modelValue:e(n),"onUpdate:modelValue":o[4]||(o[4]=i=>U(n)?n.value=i:null),type:"daterange","range-separator":"To","start-placeholder":"开始时间","end-placeholder":"结束时间",onChange:o[5]||(o[5]=i=>x())},null,8,["modelValue"])]),_:1}),a(S,{label:"请假天数",prop:"leaveDays"},{default:l(()=>[a(H,{modelValue:e(t).leaveDays,"onUpdate:modelValue":o[6]||(o[6]=i=>e(t).leaveDays=i),disabled:"",type:"number",placeholder:"请输入请假天数"},null,8,["modelValue"])]),_:1}),a(S,{label:"请假原因",prop:"remark"},{default:l(()=>[a(H,{modelValue:e(t).remark,"onUpdate:modelValue":o[7]||(o[7]=i=>e(t).remark=i),type:"textarea",rows:3,placeholder:"请输入请假原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","model","rules"])),[[te,e(w)]])]),_:1}),a($e,{ref_key:"submitVerifyRef",ref:k,"task-variables":e(f),onSubmitCallback:q},null,8,["task-variables"]),a(Se,{ref_key:"approvalRecordRef",ref:L},null,512)])}}});export{ua as default};
