import{d as fe,a as xe,V as Be,aa as ie,r as c,h as de,Y as j,b as Oe,$ as ze,o as s,c as w,k as l,m as a,e as o,x as h,w as y,M as b,N as V,p,y as _,a7 as ce,ab as Qe,T as pe,q as me,aw as Me,O as Ge,P as He,C as Je,D as Xe,G as Ye,H as Ke,a0 as Ze,W as el,X as ll,a8 as al,ac as tl,a9 as ol,am as nl,v as rl}from"./index-BoCONcAc.js";import{_ as sl}from"./index-DG7XexN9.js";import{_ as ul}from"./index.vue_vue_type_style_index_0_lang-Dyb-nOKR.js";import{_ as il}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as dl}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as cl}from"./index-B4NenLWv.js";/* empty css               *//* empty css                *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{A as pl,f as ml,u as fl,h as vl,i as _l}from"./index-DABdJVQF.js";import{_ as kl}from"./selectUser.vue_vue_type_script_setup_true_name_SelectUser_lang-BJmx2FMg.js";import{_ as wl}from"./finishWork.vue_vue_type_script_setup_true_name_InfoLog_lang-Brp9TV0x.js";import{_ as bl}from"./workLog.vue_vue_type_script_setup_true_name_SelectUser_lang-CCcApUss.js";import gl from"./process1-CwB6Ars8.js";import{l as yl}from"./index-JZ_QvNlG.js";import{a as Vl}from"./index-BjZ9Zf1q.js";/* empty css                *//* empty css                    *//* empty css                */import"./index-hgsK1_Ho.js";/* empty css                       *//* empty css                 */import"./index-hmiVVuGg.js";import"./index-Xwb6tvPf.js";/* empty css                        *//* empty css                             */const hl=h("div",{style:{height:"0px"}},null,-1),Tl={class:"p-2"},Il={class:"mb-[10px]"},Cl=["onClick"],Nl={class:"dialog-footer"},Al={class:"dialog-footer"},Ul=fe({name:"WorkInfo"}),ua=fe({...Ul,setup(jl){const L=xe();console.log(L.currentRoute.value.query,"router");const{proxy:i}=Be(),{work_info_type:$,work_info_state:Q,test_xm:ve,test_fl:_e,test_dj:ke}=ie(i==null?void 0:i.useDict("work_info_type","work_info_state","test_xm","test_fl","test_dj")),M=c(),we=c(),G=c(),H=c([]),S=c(!1),T=c(!0),P=c(!0),q=c([]),J=c(!0),X=c(!0),R=c(0);de().userId;const be=de(),F=j({someProperty:""}),Y=c([]),W=c(c()),K=c(),x=c(),g=j({visible:!1,title:""}),U=j({}),Z={id:void 0,workTitle:void 0,workContent:void 0,state:void 0,workType:void 0,projectName:void 0,workLevel:void 0,classificationType:void 0,acceptAccount:void 0,acceptAccountName:void 0,attachs:void 0,attachIds:void 0},ge=j({form:{...Z},queryParams:{pageNum:1,pageSize:10,workTitle:void 0,workContent:void 0,state:void 0,workType:void 0,projectName:void 0,workLevel:void 0,classificationType:void 0,attachs:void 0,attachIds:void 0,acceptAccount:void 0,acceptAccountName:void 0,params:{}},rules:{workTitle:[{required:!0,message:"标题不能为空",trigger:"blur"}],workContent:[{required:!0,message:"内容不能为空",trigger:"blur"}],workType:[{required:!0,message:"类型不能为空",trigger:"change"}],workLevel:[{required:!0,message:"类型不能为空",trigger:"change"}],classificationType:[{required:!0,message:"类型不能为空",trigger:"change"}],projectName:[{required:!0,message:"项目名称不能为空",trigger:"change"}]}}),{queryParams:u,form:r,rules:ye}=ie(ge),I=async()=>{T.value=!0,console.log("事件列表查询信息-----"+L.currentRoute.value.query.state);const n=await pl(u.value);H.value=n.rows,R.value=n.total,T.value=!1},Ve=n=>{r.value.acceptAccount=n.userId,r.value.acceptAccountName=n.nickName},he=()=>{B(),g.visible=!1},C=c(!1),Te=n=>{console.log(n.number),console.log(C.value),F.someProperty=n.number,console.log(F,1111),C.value=!0},B=()=>{var n;r.value={...Z},(n=x.value)==null||n.resetFields()},Ie=()=>{var n;(n=K.value)==null||n.resetFields(),E()},Ce=n=>{var t;(t=G.value)==null||t.show(),U.row=n,U.type="finishAudit",U.title="审核工作成果"},Ne=async()=>{try{T.value=!0;const n=await yl();n&&n.rows&&(W.value=n.rows)}catch(n){console.error("获取用户列表失败:",n)}},Ae=()=>{var n;(n=M.value)==null||n.show()},E=()=>{u.value.pageNum=1,I()},Ue=n=>{q.value=n.map(t=>t.id),J.value=n.length!=1,X.value=!n.length},je=()=>{B(),g.visible=!0,g.title="添加工单管理"},ee=async n=>{B();const t=(n==null?void 0:n.id)||q.value[0],O=await ml(t);Object.assign(r.value,O.data);let f="";if(r.value.attachs){let d=JSON.parse(r.value.attachs),N=[];for(var v of d)N.push(v.id);f=N.join(","),r.value.attachIds=f}g.visible=!0,g.title="修改工单管理"},Se=async()=>{T.value=!0,console.log(" 事件列表查询信息-----"+L.currentRoute.value.query.state);const n=await Vl();n&&n.rows&&(Y.value=n.rows),console.log(n),T.value=!1},Ee=()=>{var n;(n=x.value)==null||n.validate(async t=>{t&&(S.value=!0,r.value.id?await fl(r.value).finally(()=>S.value=!1):await vl(r.value).finally(()=>S.value=!1),i==null||i.$modal.msgSuccess("操作成功"),g.visible=!1,await I())})},le=async n=>{const t=(n==null?void 0:n.id)||q.value;await(i==null?void 0:i.$modal.confirm('是否确认删除工单管理编号为"'+t+'"的数据项？').finally(()=>T.value=!1)),await _l(t),i==null||i.$modal.msgSuccess("删除成功"),await I()},De=()=>{i==null||i.download("workInfo/workInfo/export",{...u.value},`workInfo_${new Date().getTime()}.xlsx`)};return j({color:"rgba(0, 0, 0, .15)"}),Oe(()=>{Se(),Ne(),I()}),(n,t)=>{var se,ue;const O=Me,f=Ge,v=He,d=Je,N=Xe,m=Ye,ae=Ke,te=Ze,D=el,Le=cl,$e=ll,k=al,oe=dl,ne=tl,Pe=ol,qe=il,Re=ul,Fe=sl,re=nl,A=ze("hasPermi"),We=rl;return s(),w(b,null,[l(O,{style:{position:"static"},content:[o(be).nickname]},{default:a(()=>[hl]),_:1},8,["content"]),h("div",Tl,[l(Qe,{"enter-active-class":(se=o(i))==null?void 0:se.animate.searchAnimate.enter,"leave-active-class":(ue=o(i))==null?void 0:ue.animate.searchAnimate.leave},{default:a(()=>[y(h("div",Il,[l(te,{shadow:"hover"},{default:a(()=>[l(ae,{ref_key:"queryFormRef",ref:K,model:o(u),inline:!0},{default:a(()=>[l(d,{label:"项目名称",prop:"projectName"},{default:a(()=>[l(v,{filterable:"",modelValue:o(u).projectName,"onUpdate:modelValue":t[0]||(t[0]=e=>o(u).projectName=e),placeholder:"请选择项目名称",clearable:""},{default:a(()=>[(s(!0),w(b,null,V(Y.value,e=>(s(),p(f,{key:e.id,label:e.proName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"创建人",prop:"createName"},{default:a(()=>[l(v,{filterable:"",modelValue:o(u).createBy,"onUpdate:modelValue":t[1]||(t[1]=e=>o(u).createBy=e),placeholder:"请选择创建人",clearable:""},{default:a(()=>[(s(!0),w(b,null,V(W.value,e=>(s(),p(f,{key:e.userId,label:e.nickName,value:e.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{filterable:"",label:"接收人",prop:"acceptAccount"},{default:a(()=>[l(v,{modelValue:o(u).acceptAccount,"onUpdate:modelValue":t[2]||(t[2]=e=>o(u).acceptAccount=e),placeholder:"请选择接收人",clearable:""},{default:a(()=>[(s(!0),w(b,null,V(W.value,e=>(s(),p(f,{key:e.userId,label:e.nickName,value:e.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"状态",prop:"state"},{default:a(()=>[l(v,{modelValue:o(u).state,"onUpdate:modelValue":t[3]||(t[3]=e=>o(u).state=e),placeholder:"请选择状态",clearable:""},{default:a(()=>[(s(!0),w(b,null,V(o(Q),e=>(s(),p(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"类型",prop:"workType"},{default:a(()=>[l(v,{modelValue:o(u).workType,"onUpdate:modelValue":t[4]||(t[4]=e=>o(u).workType=e),placeholder:"请选择类型",clearable:""},{default:a(()=>[(s(!0),w(b,null,V(o($),e=>(s(),p(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"标题或内容",prop:"workTitle","label-width":"90"},{default:a(()=>[l(N,{modelValue:o(u).workTitle,"onUpdate:modelValue":t[5]||(t[5]=e=>o(u).workTitle=e),placeholder:"请输入标题或内容"},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(m,{type:"primary",icon:"Search",onClick:E},{default:a(()=>[_("搜索")]),_:1}),l(m,{icon:"Refresh",onClick:Ie},{default:a(()=>[_("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[ce,P.value]])]),_:1},8,["enter-active-class","leave-active-class"]),l(te,{shadow:"never"},{header:a(()=>[l($e,{gutter:10,class:"mb8"},{default:a(()=>[l(D,{span:1.5},{default:a(()=>[y((s(),p(m,{type:"primary",plain:"",icon:"Plus",onClick:je},{default:a(()=>[_("新增")]),_:1})),[[A,["workInfo:workInfo:add"]]])]),_:1}),l(D,{span:1.5},{default:a(()=>[y((s(),p(m,{type:"success",plain:"",icon:"Edit",disabled:J.value,onClick:t[6]||(t[6]=e=>ee())},{default:a(()=>[_("修改")]),_:1},8,["disabled"])),[[A,["workInfo:workInfo:edit"]]])]),_:1}),l(D,{span:1.5},{default:a(()=>[y((s(),p(m,{type:"danger",plain:"",icon:"Delete",disabled:X.value,onClick:t[7]||(t[7]=e=>le())},{default:a(()=>[_("删除")]),_:1},8,["disabled"])),[[A,["workInfo:workInfo:remove"]]])]),_:1}),l(D,{span:1.5},{default:a(()=>[y((s(),p(m,{type:"warning",plain:"",icon:"Download",onClick:De},{default:a(()=>[_("导出")]),_:1})),[[A,["workInfo:workInfo:export"]]])]),_:1}),l(Le,{showSearch:P.value,"onUpdate:showSearch":t[8]||(t[8]=e=>P.value=e),onQueryTable:I},null,8,["showSearch"])]),_:1})]),default:a(()=>[y((s(),p(Pe,{data:H.value,onSelectionChange:Ue},{default:a(()=>[l(k,{type:"selection",width:"55",align:"center"}),l(k,{label:"流水号",align:"center",prop:"number",width:"180"},{default:a(e=>[h("span",{style:{color:"#009fff"},onClick:z=>Te(e.row)},pe(e.row.number),9,Cl)]),_:1}),l(k,{label:"标题",align:"left",prop:"workTitle"}),l(k,{label:"项目名称",align:"left",prop:"projectName"}),l(k,{label:"状态",align:"center",width:"75",prop:"state"},{default:a(e=>[l(oe,{options:o(Q),value:e.row.state},null,8,["options","value"])]),_:1}),l(k,{label:"类型",align:"center",width:"95",prop:"workType"},{default:a(e=>[l(oe,{options:o($),value:e.row.workType},null,8,["options","value"])]),_:1}),l(k,{label:"创建人",align:"center",width:"110",prop:"acceptAccountName"}),l(k,{label:"接收人",align:"center",width:"110",prop:"acceptAccountName"}),l(k,{label:"创建时间",align:"center",prop:"createTime",width:"200"},{default:a(e=>[h("span",null,pe(n.parseTime(e.row.createTime)),1)]),_:1}),l(k,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(e=>[e.row.state=="4"?(s(),p(m,{key:0,type:"warning",onClick:z=>Ce(e.row)},{default:a(()=>[_("审核")]),_:2},1032,["onClick"])):me("",!0),l(ne,{content:"修改",placement:"top"},{default:a(()=>[y(l(m,{type:"primary",icon:"Edit",onClick:z=>ee(e.row)},null,8,["onClick"]),[[A,["workInfo:workInfo:edit"]]])]),_:2},1024),l(ne,{content:"删除",placement:"top"},{default:a(()=>[y(l(m,{type:"danger",icon:"Delete",onClick:z=>le(e.row)},null,8,["onClick"]),[[A,["workInfo:workInfo:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[We,T.value]]),y(l(qe,{total:R.value,page:o(u).pageNum,"onUpdate:page":t[9]||(t[9]=e=>o(u).pageNum=e),limit:o(u).pageSize,"onUpdate:limit":t[10]||(t[10]=e=>o(u).pageSize=e),onPagination:I},null,8,["total","page","limit"]),[[ce,R.value>0]])]),_:1}),l(re,{title:o(g).title,modelValue:o(g).visible,"onUpdate:modelValue":t[19]||(t[19]=e=>o(g).visible=e),width:"auto","append-to-body":""},{footer:a(()=>[h("div",Nl,[l(m,{loading:S.value,type:"primary",onClick:Ee},{default:a(()=>[_("确 定")]),_:1},8,["loading"]),l(m,{onClick:he},{default:a(()=>[_("取 消")]),_:1})])]),default:a(()=>[l(d,{label:"标题",prop:"workTitle"},{default:a(()=>[l(N,{modelValue:o(r).workTitle,"onUpdate:modelValue":t[11]||(t[11]=e=>o(r).workTitle=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(ae,{ref_key:"workInfoFormRef",ref:x,model:o(r),rules:o(ye),"label-width":"80px"},{default:a(()=>[l(d,{label:"项目名称",prop:"projectName"},{default:a(()=>[l(v,{modelValue:o(r).projectName,"onUpdate:modelValue":t[12]||(t[12]=e=>o(r).projectName=e),placeholder:"请选择项目名称"},{default:a(()=>[(s(!0),w(b,null,V(o(ve),e=>(s(),p(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"分类",prop:"classificationType"},{default:a(()=>[l(v,{modelValue:o(r).classificationType,"onUpdate:modelValue":t[13]||(t[13]=e=>o(r).classificationType=e),placeholder:"请选择工单分类"},{default:a(()=>[(s(!0),w(b,null,V(o(_e),e=>(s(),p(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"类型",prop:"workType"},{default:a(()=>[l(v,{modelValue:o(r).workType,"onUpdate:modelValue":t[14]||(t[14]=e=>o(r).workType=e),placeholder:"请选择工单类型"},{default:a(()=>[(s(!0),w(b,null,V(o($),e=>(s(),p(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"等级",prop:"workLevel"},{default:a(()=>[l(v,{modelValue:o(r).workLevel,"onUpdate:modelValue":t[15]||(t[15]=e=>o(r).workLevel=e),placeholder:"请选择工单等级"},{default:a(()=>[(s(!0),w(b,null,V(o(ke),e=>(s(),p(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"内容"},{default:a(()=>[l(Re,{modelValue:o(r).workContent,"onUpdate:modelValue":t[16]||(t[16]=e=>o(r).workContent=e),"min-height":192},null,8,["modelValue"])]),_:1}),l(d,{label:"附件",prop:"attachIds"},{default:a(()=>[l(Fe,{modelValue:o(r).attachIds,"onUpdate:modelValue":t[17]||(t[17]=e=>o(r).attachIds=e)},null,8,["modelValue"])]),_:1}),l(d,{label:"接收人"},{default:a(()=>[l(N,{modelValue:o(r).acceptAccountName,"onUpdate:modelValue":t[18]||(t[18]=e=>o(r).acceptAccountName=e),placeholder:"",style:{width:"120px"},readonly:!0,disabled:!0},null,8,["modelValue"]),l(m,{type:"primary",plain:"",icon:"Plus",onClick:Ae},{default:a(()=>[_("请选择接收人")]),_:1})]),_:1})]),_:1},8,["model","rules"]),l(kl,{ref_key:"selectRef",ref:M,"parent-form":o(r),onOk:E,onSetAcceptAccount:Ve},null,8,["parent-form"])]),_:1},8,["title","modelValue"]),l(wl,{ref_key:"finishWork",ref:G,"data-object":o(U),onOk:E,onFreshList:I},null,8,["data-object"]),l(bl,{ref_key:"workLog",ref:we,"data-object":o(U)},null,8,["data-object"]),l(re,{modelValue:C.value,"onUpdate:modelValue":t[21]||(t[21]=e=>C.value=e),title:"流程跟踪",width:"80%"},{footer:a(()=>[h("div",Al,[l(m,{type:"primary",onClick:t[20]||(t[20]=e=>C.value=!1)},{default:a(()=>[_(" 关闭 ")]),_:1})])]),default:a(()=>[h("div",null,[C.value?(s(),p(gl,{key:0,processData:o(F)},null,8,["processData"])):me("",!0)])]),_:1},8,["modelValue"])])],64)}}});export{ua as default};
