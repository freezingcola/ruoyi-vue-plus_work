import{r as i,d as fe,V as ve,aa as _e,S as ge,aK as he,i as be,b as ke,j as H,o as U,c as M,k as t,m as o,y,e as a,a3 as ye,ab as we,w as O,x as P,t as Q,a7 as j,aL as xe,T as G,M as Ce,N as Ie,p as Ne,n as Ve,D as Re,aC as Se,a0 as De,W as Ee,C as Te,G as Ue,H as Be,ak as Fe,X as Le,am as Ae}from"./index-BoCONcAc.js";/* empty css               */import{_ as Ke}from"./index-B1KNwlHH.js";import{_ as qe}from"./index-BXJ8XT-L.js";/* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css               *//* empty css                *//* empty css                *//* empty css                    */import{e as B}from"./index-JZ_QvNlG.js";const ze=I=>{const g=i(!1);return{title:i(I.title||""),visible:g,openDialog:()=>{g.value=!0},closeDialog:()=>{g.value=!1}}},He={class:"mb-[10px]"},et=fe({__name:"index",props:{modelValue:{default:void 0},multiple:{type:Boolean,default:!0},data:{default:void 0}},emits:["update:modelValue","confirmCallBack"],setup(I,{expose:g,emit:F}){const h=I,N=F,{proxy:c}=ve(),{sys_normal_disable:W}=_e(c==null?void 0:c.useDict("sys_normal_disable")),b=i(),V=i(!0),X=i(!0),R=i(0),L=i(["",""]),w=i(""),A=i([]),n=i([]),S=i(),K=i(),m=i(),d=ze({title:"用户选择"}),u=i({pageNum:1,pageSize:10,userName:"",phonenumber:"",status:"",deptId:"",roleId:""}),D=ge(()=>J(h.data));he(()=>{var e;(e=S.value)==null||e.filter(w.value)},{flush:"post"});const $=()=>{N("update:modelValue",n.value),N("confirmCallBack",n.value),d.closeDialog()},J=e=>e instanceof Array?[...e]:typeof e=="string"?e.split(","):typeof e=="number"?[e]:(console.warn("<UserSelect> The data type of data should be array or string or number, but I received other"),[]),Y=(e,l)=>e?l.label.indexOf(e)!==-1:!0,Z=async()=>{const e=await B.deptTreeSelect();A.value=e.data},E=async()=>{V.value=!0;const e=await B.listUser(c==null?void 0:c.addDateRange(u.value,L.value));V.value=!1,b.value=e.rows,R.value=e.total},ee=async()=>{await E();const e=b.value.filter(l=>n.value.some(s=>s.userId===l.userId));await m.value.setCheckboxRow(e,!0)},te=e=>{u.value.deptId=e.id,k()},k=()=>{u.value.pageNum=1,E()},q=()=>{var e,l;L.value=["",""],(e=K.value)==null||e.resetFields(),u.value.pageNum=1,u.value.deptId=void 0,(l=S.value)==null||l.setCurrentKey(void 0),k()},le=e=>{!h.multiple&&e.checked&&(m.value.setCheckboxRow(n.value,!1),n.value=[]);const l=e.row;e.checked?n.value.push(l):n.value=n.value.filter(s=>s.userId!==l.userId)},ae=e=>{const l=b.value;e.checked?l.forEach(s=>{n.value.some(f=>f.userId===s.userId)||n.value.push(s)}):n.value=n.value.filter(s=>!l.some(f=>f.userId===s.userId))},oe=e=>{var v;const l=e.userId,s=n.value.findIndex(x=>x.userId===l),f=n.value[s];(v=m.value)==null||v.setCheckboxRow(f,!1),n.value.splice(s,1)},ne=async()=>{if(D.value.length>0){const{data:e}=await B.optionSelect(D.value);n.value=e;const l=b.value.filter(s=>D.value.includes(String(s.userId)));await Ve(()=>{m.value.setCheckboxRow(l,!0)})}},se=()=>{d.closeDialog()};return be(()=>d.visible.value,e=>{e?ne():(m.value.clearCheckboxReserve(),m.value.clearCheckboxRow(),q(),n.value=[])}),ke(()=>{Z(),E()}),g({open:d.openDialog,close:d.closeDialog}),(e,l)=>{const s=Re,f=Se,v=De,x=Ee,T=Te,C=Ue,re=Be,ue=Fe,p=H("vxe-column"),ie=qe,ce=H("vxe-table"),de=Ke,pe=Le,me=Ae;return U(),M("div",null,[t(me,{modelValue:a(d).visible.value,"onUpdate:modelValue":l[5]||(l[5]=_=>a(d).visible.value=_),title:a(d).title.value,width:"80%","append-to-body":""},{footer:o(()=>[t(C,{onClick:se},{default:o(()=>[y("取消")]),_:1}),t(C,{type:"primary",onClick:$},{default:o(()=>[y("确定")]),_:1})]),default:o(()=>[t(pe,{gutter:20},{default:o(()=>[t(x,{lg:4,xs:24,style:{}},{default:o(()=>[t(v,{shadow:"hover"},{default:o(()=>[t(s,{modelValue:a(w),"onUpdate:modelValue":l[0]||(l[0]=_=>ye(w)?w.value=_:null),placeholder:"请输入部门名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),t(f,{ref_key:"deptTreeRef",ref:S,class:"mt-2","node-key":"id",data:a(A),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":Y,"highlight-current":"","default-expand-all":"",onNodeClick:te},null,8,["data"])]),_:1})]),_:1}),t(x,{lg:20,xs:24},{default:o(()=>{var _,z;return[t(we,{"enter-active-class":(_=a(c))==null?void 0:_.animate.searchAnimate.enter,"leave-active-class":(z=a(c))==null?void 0:z.animate.searchAnimate.leave},{default:o(()=>[O(P("div",He,[t(v,{shadow:"hover"},{default:o(()=>[t(re,{ref_key:"queryFormRef",ref:K,model:a(u),inline:!0},{default:o(()=>[t(T,{label:"用户名称",prop:"userName"},{default:o(()=>[t(s,{modelValue:a(u).userName,"onUpdate:modelValue":l[1]||(l[1]=r=>a(u).userName=r),placeholder:"请输入用户名称",clearable:"",onKeyup:Q(k,["enter"])},null,8,["modelValue"])]),_:1}),t(T,{label:"手机号码",prop:"phonenumber"},{default:o(()=>[t(s,{modelValue:a(u).phonenumber,"onUpdate:modelValue":l[2]||(l[2]=r=>a(u).phonenumber=r),placeholder:"请输入手机号码",clearable:"",onKeyup:Q(k,["enter"])},null,8,["modelValue"])]),_:1}),t(T,null,{default:o(()=>[t(C,{type:"primary",icon:"Search",onClick:k},{default:o(()=>[y("搜索")]),_:1}),t(C,{icon:"Refresh",onClick:q},{default:o(()=>[y("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[j,a(X)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(v,{shadow:"hover"},xe({default:o(()=>[t(ce,{ref_key:"tableRef",ref:m,height:"400px",border:"","show-overflow":"",data:a(b),loading:a(V),"row-config":{keyField:"userId",isHover:!0},"checkbox-config":{reserve:!0,trigger:"row",highlight:!0,showHeader:h.multiple},onCheckboxAll:ae,onCheckboxChange:le},{default:o(()=>[t(p,{type:"checkbox",width:"50",align:"center"}),t(p,{key:"userId",title:"用户编号",align:"center",field:"userId"}),t(p,{key:"userName",title:"用户名称",align:"center",field:"userName"}),t(p,{key:"nickName",title:"用户昵称",align:"center",field:"nickName"}),t(p,{key:"deptName",title:"部门",align:"center",field:"deptName"}),t(p,{key:"phonenumber",title:"手机号码",align:"center",field:"phonenumber",width:"120"}),t(p,{key:"status",title:"状态",align:"center"},{default:o(r=>[t(ie,{options:a(W),value:r.row.status},null,8,["options","value"])]),_:1}),t(p,{title:"创建时间",align:"center",width:"160"},{default:o(r=>[P("span",null,G(r.row.createTime),1)]),_:1})]),_:1},8,["data","loading","checkbox-config"]),O(t(de,{page:a(u).pageNum,"onUpdate:page":l[3]||(l[3]=r=>a(u).pageNum=r),limit:a(u).pageSize,"onUpdate:limit":l[4]||(l[4]=r=>a(u).pageSize=r),total:a(R),onPagination:ee},null,8,["page","limit","total"]),[[j,a(R)>0]])]),_:2},[h.multiple?{name:"header",fn:o(()=>[(U(!0),M(Ce,null,Ie(a(n),r=>(U(),Ne(ue,{key:r.userId,closable:"",style:{margin:"2px"},onClose:Me=>oe(r)},{default:o(()=>[y(G(r.userName),1)]),_:2},1032,["onClose"]))),128))]),key:"0"}:void 0]),1024)]}),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});export{et as _,ze as u};
