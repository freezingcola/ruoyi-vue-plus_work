import{d as U,r as y,w as X,e as q,o as F,c as J,k as v,m as w,x as _,n as D,G as Q,ac as tt,aM as et,aN as ot,aO as it,v as at,I as lt,J as rt,L as st}from"./index-BoCONcAc.js";import{c as nt,a as V,t as B,e as x,b as dt,V as G}from"./Event-BS7rISKI.js";import{p as ht}from"./index-LhLwlHgt.js";var ct=/^djs-cursor-.*$/;function A(i){var t=nt(document.body);t.removeMatching(ct),i&&t.add("djs-cursor-"+i)}function ut(){A(null)}var gt=5e3;function ft(i,t){t=t||"element.click";function l(){return!1}return i.once(t,gt,l),function(){i.off(t,l)}}function Z(i,t){return{x:i.x-t.x,y:i.y-t.y}}var mt=15;function H(i,t){var l;i.on("element.mousedown",500,function(d){return c(d.originalEvent)});function r(d){var u=l.start,k=l.button,M=B(d),b=Z(M,u);if(!l.dragging&&pt(b)>mt&&(l.dragging=!0,k===0&&ft(i),A("grab")),l.dragging){var E=l.last||l.start;b=Z(M,E),t.scroll({dx:b.x,dy:b.y}),l.last=M}d.preventDefault()}function h(d){x.unbind(document,"mousemove",r),x.unbind(document,"mouseup",h),l=null,ut()}function c(d){if(!V(d.target,".djs-draggable")){var u=d.button;if(!(u>=2||d.ctrlKey||d.shiftKey||d.altKey))return l={button:u,start:B(d)},x.bind(document,"mousemove",r),x.bind(document,"mouseup",h),!0}}this.isActive=function(){return!!l}}H.$inject=["eventBus","canvas"];function pt(i){return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}const I={__init__:["moveCanvas"],moveCanvas:["type",H]};function L(i){return Math.log(i)/Math.log(10)}function j(i,t){var l=L(i.min),r=L(i.max),h=Math.abs(l)+Math.abs(r);return h/t}function vt(i,t){return Math.max(i.min,Math.min(i.max,t))}var _t=Math.sign||function(i){return i>=0?1:-1},z={min:.2,max:4},K=10,yt=.1,kt=.75;function p(i,t,l){i=i||{},this._enabled=!1,this._canvas=l,this._container=l._container,this._handleWheel=dt(this._handleWheel,this),this._totalDelta=0,this._scale=i.scale||kt;var r=this;t.on("canvas.init",function(h){r._init(i.enabled!==!1)})}p.$inject=["config.zoomScroll","eventBus","canvas"];p.prototype.scroll=function(t){this._canvas.scroll(t)};p.prototype.reset=function(){this._canvas.zoom("fit-viewport")};p.prototype.zoom=function(t,l){var r=j(z,K*2);this._totalDelta+=t,Math.abs(this._totalDelta)>yt&&(this._zoom(t,l,r),this._totalDelta=0)};p.prototype._handleWheel=function(t){if(!V(t.target,".djs-scrollable",!0)){var l=this._container;t.preventDefault();var r=t.ctrlKey,h=t.shiftKey,c=-1*this._scale,d;if(r?c*=t.deltaMode===0?.02:.32:c*=t.deltaMode===0?1:16,r){var u=l.getBoundingClientRect(),k={x:t.clientX-u.left,y:t.clientY-u.top};d=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*_t(t.deltaY)*c,this.zoom(d,k)}else h?d={dx:c*t.deltaY,dy:0}:d={dx:c*t.deltaX,dy:c*t.deltaY},this.scroll(d)}};p.prototype.stepZoom=function(t,l){var r=j(z,K);this._zoom(t,l,r)};p.prototype._zoom=function(i,t,l){var r=this._canvas,h=i>0?1:-1,c=L(r.zoom()),d=Math.round(c/l)*l;d+=l*h;var u=Math.pow(10,d);r.zoom(vt(z,u),t)};p.prototype.toggle=function(t){var l=this._container,r=this._handleWheel,h=this._enabled;return typeof t>"u"&&(t=!h),h!==t&&x[t?"bind":"unbind"](l,"wheel",r,!1),this._enabled=t,t};p.prototype._init=function(i){this.toggle(i)};const P={__init__:["zoomScroll"],zoomScroll:["type",p]},Mt=i=>(lt("data-v-190fbfdc"),i=i(),rt(),i),bt={class:"bpmnDialogContainers"},wt={class:"header-div"},xt=Mt(()=>_("div",null,[_("div",{class:"tips-label"},[_("div",{class:"un-complete"},"未完成"),_("div",{class:"in-progress"},"进行中"),_("div",{class:"complete"},"已完成")])],-1)),Et={class:"flow-containers"},Rt=U({__name:"index",setup(i,{expose:t}){const l=y(),r=y(),h=y([]),c=y(1),d=y(""),u=y(!1),k=y(!0),M=y([]),b=n=>{u.value=!0,k.value=!0,D(async()=>{r.value&&r.value.destroy(),r.value=new G({container:l.value,additionalModules:[{zoomScroll:["value",""]},P,I]});const e=await ht.getHistoryList(n);d.value=e.data.xml,h.value=e.data.taskList,M.value=e.data.historyList,await S(d.value),u.value=!1})},E=n=>{u.value=!0,k.value=!0,D(async()=>{r.value&&r.value.destroy(),r.value=new G({container:l.value,additionalModules:[{zoomScroll:["value",""]},P,I]}),d.value=n,await S(d.value),u.value=!1})},S=async n=>{try{await r.value.importXML(n),T(),W(),u.value=!1,N()}catch(e){console.log(e)}},N=()=>{const n=r.value.get("eventBus"),e=r.value.get("overlays");n.on("element.hover",o=>{let g=M.value.find(a=>a.taskDefinitionKey===o.element.id);o.element.type==="bpmn:UserTask"&&g&&setTimeout(()=>{O(o,e,g)},10)}),n.on("element.out",o=>{e.clear()})},O=(n,e,o)=>{e.add(n.element.id,{position:{top:n.element.height,left:0},html:`<div class="verlays">
                    <p>审批人员: ${o.nickName||""}<p/>
                    <p>节点状态：${o.status||""}</p>
                    <p>开始时间：${o.startTime||""}</p>
                    <p>结束时间：${o.endTime||""}</p>
                    <p>审批耗时：${o.runDuration||""}</p>
                   </div>`})},T=()=>{c.value=r.value.get("canvas").zoom("fit-viewport");const n=document.querySelector(".flow-containers .viewport").getBBox(),e=r.value.get("canvas").viewbox(),o={x:n.x+n.width/2-65,y:n.y+n.height/2};r.value.get("canvas").viewbox({x:o.x-e.width/2,y:o.y-e.height/2,width:e.width,height:e.height}),c.value=n.width/e.width*1.8},$=(n=!0)=>{c.value=r.value.get("canvas").zoom(),c.value+=n?.1:-.1,r.value.get("canvas").zoom(c.value)},W=()=>{const n=r.value.get("canvas");C(r.value._definitions.rootElements[0].flowElements,n)},C=(n,e)=>{n.forEach(o=>{var g;if(o.$type==="bpmn:UserTask"){const a=h.value.find(s=>s.key===o.id);a&&(e.addMarker(o.id,a.completed?"highlight":"highlight-todo"),(g=o.outgoing)==null||g.forEach(s=>{const m=h.value.find(f=>f.key===s.targetRef.id);m?e.addMarker(s.id,m.completed?"highlight":"highlight-todo"):s.targetRef.$type==="bpmn:ExclusiveGateway"?(e.addMarker(s.id,a.completed?"highlight":"highlight-todo"),e.addMarker(s.targetRef.id,a.completed?"highlight":"highlight-todo"),s.targetRef.outgoing.forEach(f=>{R(f.id,f.targetRef.$type,f.targetRef.id,e,a.completed)})):s.targetRef.$type==="bpmn:ParallelGateway"?(e.addMarker(s.id,a.completed?"highlight":"highlight-todo"),e.addMarker(s.targetRef.id,a.completed?"highlight":"highlight-todo"),s.targetRef.outgoing.forEach(f=>{R(f.id,f.targetRef.$type,f.targetRef.id,e,a.completed)})):s.targetRef.$type==="bpmn:InclusiveGateway"&&(e.addMarker(s.id,a.completed?"highlight":"highlight-todo"),e.addMarker(s.targetRef.id,a.completed?"highlight":"highlight-todo"),s.targetRef.outgoing.forEach(f=>{R(f.id,f.targetRef.$type,f.targetRef.id,e,a.completed)}))}))}else if(o.$type==="bpmn:ExclusiveGateway")o.outgoing.forEach(a=>{const s=h.value.find(m=>m.key===a.targetRef.id);s&&e.addMarker(a.id,s.completed?"highlight":"highlight-todo")});else if(o.$type==="bpmn:ParallelGateway")o.outgoing.forEach(a=>{const s=h.value.find(m=>m.key===a.targetRef.id);s&&e.addMarker(a.id,s.completed?"highlight":"highlight-todo")});else if(o.$type==="bpmn:InclusiveGateway")o.outgoing.forEach(a=>{const s=h.value.find(m=>m.key===a.targetRef.id);s&&e.addMarker(a.id,s.completed?"highlight":"highlight-todo")});else if(o.$type==="bpmn:SubProcess"){const a=h.value.find(s=>s.key===o.id);a&&e.addMarker(o.id,a.completed?"highlight":"highlight-todo"),C(o.flowElements,e)}else if(o.$type==="bpmn:StartEvent")e.addMarker(o.id,"startEvent"),o.outgoing&&o.outgoing.forEach(a=>{h.value.find(m=>m.key===a.targetRef.id)&&(e.addMarker(a.id,"highlight"),e.addMarker(o.id,"highlight"))});else if(o.$type==="bpmn:EndEvent"){e.addMarker(o.id,"endEvent");const a=h.value.find(s=>s.key===o.id);if(a){e.addMarker(a.key,"highlight"),e.addMarker(o.id,"highlight");return}}})},R=(n,e,o,g,a)=>{e==="bpmn:ExclusiveGateway"&&(g.addMarker(n,a?"highlight":"highlight-todo"),g.addMarker(o,a?"highlight":"highlight-todo")),e==="bpmn:ParallelGateway"&&(g.addMarker(n,a?"highlight":"highlight-todo"),g.addMarker(o,a?"highlight":"highlight-todo")),e==="bpmn:InclusiveGateway"&&(g.addMarker(n,a?"highlight":"highlight-todo"),g.addMarker(o,a?"highlight":"highlight-todo"))};return t({init:b,initXml:E}),(n,e)=>{const o=Q,g=tt,a=et,s=ot,m=it,f=at;return X((F(),J("div",bt,[v(a,{style:{"border-bottom":"1px solid rgb(218 218 218)",height:"auto"}},{default:w(()=>[_("div",wt,[_("div",null,[v(g,{effect:"dark",content:"自适应屏幕",placement:"bottom"},{default:w(()=>[v(o,{size:"small",icon:"Rank",onClick:T})]),_:1}),v(g,{effect:"dark",content:"放大",placement:"bottom"},{default:w(()=>[v(o,{size:"small",icon:"ZoomIn",onClick:e[0]||(e[0]=Y=>$(!0))})]),_:1}),v(g,{effect:"dark",content:"缩小",placement:"bottom"},{default:w(()=>[v(o,{size:"small",icon:"ZoomOut",onClick:e[1]||(e[1]=Y=>$(!1))})]),_:1})]),xt])]),_:1}),_("div",Et,[v(m,{class:"bpmn-el-container",style:{"align-items":"stretch"}},{default:w(()=>[v(s,{style:{padding:"0"}},{default:w(()=>[_("div",{ref_key:"canvas",ref:l,class:"canvas"},null,512)]),_:1})]),_:1})])])),[[f,q(u)]])}}}),Tt=st(Rt,[["__scopeId","data-v-190fbfdc"]]);export{Tt as B};
