import{d as ge,a as ll,V as tl,aa as ce,r as i,Y as fe,b as al,j as ol,$ as nl,o as p,c as Y,k as t,m as o,w as y,x as T,e as n,t as ve,M as W,N as X,p as v,a3 as h,y as m,a7 as _e,ab as sl,q as E,T as ye,n as ke,D as ul,C as dl,O as rl,P as il,as as ml,G as pl,H as cl,a0 as fl,W as vl,X as _l,a8 as yl,ap as kl,ac as bl,a9 as gl,ax as hl,al as Cl,ao as Vl,a2 as Sl,F as wl,aC as Rl,am as El,v as Nl}from"./index-BoCONcAc.js";/* empty css                *//* empty css                    *//* empty css                       *//* empty css                 *//* empty css                        */import{_ as Ul}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                        *//* empty css               */import{_ as Kl}from"./index-B4NenLWv.js";/* empty css               *//* empty css                *//* empty css                *//* empty css                       */import"./el-form-item-l0sNRNKZ.js";import{l as Il,f as Dl,g as Tl,h as be,i as $l,j as xl,k as Fl,m as ql}from"./index-hgsK1_Ho.js";import{r as Ml,t as Al}from"./index-CbY-aW9v.js";const Pl={class:"p-2"},Bl={class:"mb-[10px]"},Ol={class:"dialog-footer"},Ll={class:"dialog-footer"},Yl=ge({name:"Role"}),it=ge({...Yl,setup(jl){const he=ll(),{proxy:d}=tl(),{sys_normal_disable:J}=ce(d==null?void 0:d.useDict("sys_normal_disable")),Z=i(),j=i(!0),$=i(!0),x=i([]),ee=i(!0),Ce=i(!0),N=i(0),U=i(["",""]),K=i([]),F=i(!1),q=i(!1),M=i(!0),A=i(!1),P=i([]),S=i(!1),Ve=i([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),le=i(),z=i(),te=i(),k=i(),b=i(),H={roleId:void 0,roleSort:1,status:"0",roleName:"",roleKey:"",menuCheckStrictly:!0,deptCheckStrictly:!0,remark:"",dataScope:"1",menuIds:[],deptIds:[]},Se=fe({form:{...H},queryParams:{pageNum:1,pageSize:10,roleName:"",roleKey:"",status:""},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),{form:s,queryParams:c,rules:we}=ce(Se),_=fe({visible:!1,title:""}),C=()=>{j.value=!0,Il(d==null?void 0:d.addDateRange(c.value,U.value)).then(a=>{Z.value=a.rows,N.value=a.total,j.value=!1})},B=()=>{c.value.pageNum=1,C()},Re=()=>{var a;U.value=["",""],(a=le.value)==null||a.resetFields(),B()},ae=async a=>{const e=(a==null?void 0:a.roleId)||x.value;await(d==null?void 0:d.$modal.confirm("是否确认删除角色编号为"+e+"数据项目")),await Dl(e),C(),d==null||d.$modal.msgSuccess("删除成功")},Ee=()=>{d==null||d.download("system/role/export",{...c.value},`role_${new Date().getTime()}.xlsx`)},Ne=a=>{x.value=a.map(e=>e.roleId),ee.value=a.length!=1,Ce.value=!a.length},Ue=async a=>{let e=a.status==="0"?"启用":"停用";try{await(d==null?void 0:d.$modal.confirm('确认要"'+e+'""'+a.roleName+'"角色吗?')),await Tl(a.roleId,a.status),d==null||d.$modal.msgSuccess(e+"成功")}catch{a.status=a.status==="0"?"1":"0"}},Ke=a=>{he.push("/system/role-auth/user/"+a.roleId)},Ie=async()=>{const a=await Al();K.value=a.data},De=()=>{var r,u;let a=(r=b.value)==null?void 0:r.getCheckedKeys(),e=(u=b.value)==null?void 0:u.getHalfCheckedKeys();return e&&(a==null||a.unshift.apply(a,e)),a},Q=()=>{var a,e;(a=k.value)==null||a.setCheckedKeys([]),F.value=!1,q.value=!1,M.value=!0,A.value=!1,s.value={...H},(e=z.value)==null||e.resetFields()},Te=()=>{Q(),Ie(),_.visible=!0,_.title="添加角色"},oe=async a=>{Q();const e=(a==null?void 0:a.roleId)||x.value[0],{data:r}=await be(e);Object.assign(s.value,r),s.value.roleSort=Number(s.value.roleSort);const u=await $e(e);_.title="修改角色",_.visible=!0,u.checkedKeys.forEach(O=>{ke(()=>{var I;(I=k.value)==null||I.setChecked(O,!0,!1)})})},$e=a=>Ml(a).then(e=>(K.value=e.data.menus,e.data)),xe=async a=>{const e=await ql(a);return P.value=e.data.depts,e.data},ne=(a,e)=>{if(e=="menu"){let r=K.value;for(let u=0;u<r.length;u++)k.value&&(k.value.store.nodesMap[r[u].id].expanded=a)}else if(e=="dept"){let r=P.value;for(let u=0;u<r.length;u++)b.value&&(b.value.store.nodesMap[r[u].id].expanded=a)}},se=(a,e)=>{var r,u;e=="menu"?(r=k.value)==null||r.setCheckedNodes(a?K.value:[]):e=="dept"&&((u=b.value)==null||u.setCheckedNodes(a?P.value:[]))},ue=(a,e)=>{e=="menu"?s.value.menuCheckStrictly=a:e=="dept"&&(s.value.deptCheckStrictly=a)},Fe=()=>{var r,u;let a=(r=k.value)==null?void 0:r.getCheckedKeys(),e=(u=k.value)==null?void 0:u.getHalfCheckedKeys();return e&&(a==null||a.unshift.apply(a,e)),a},qe=()=>{var a;(a=z.value)==null||a.validate(async e=>{e&&(s.value.menuIds=Fe(),s.value.roleId?await $l(s.value):await xl(s.value),d==null||d.$modal.msgSuccess("操作成功"),_.visible=!1,C())})},Me=()=>{Q(),_.visible=!1},Ae=a=>{var e;a!=="2"&&((e=b.value)==null||e.setCheckedKeys([]))},Pe=async a=>{const e=await be(a.roleId);Object.assign(s.value,e.data);const r=await xe(a.roleId);S.value=!0,_.title="分配数据权限",await ke(()=>{var u;(u=b.value)==null||u.setCheckedKeys(r.checkedKeys)})},Be=async()=>{s.value.roleId&&(s.value.deptIds=De(),await Fl(s.value),d==null||d.$modal.msgSuccess("修改成功"),S.value=!1,C())},Oe=()=>{var a;(a=te.value)==null||a.resetFields(),s.value={...H},S.value=!1};return al(()=>{C()}),(a,e)=>{var me,pe;const r=ul,u=dl,O=rl,I=il,Le=ml,f=pl,G=cl,de=fl,L=vl,Ye=Kl,je=_l,V=yl,ze=kl,D=bl,He=gl,Qe=Ul,Ge=ol("question-filled"),We=hl,Xe=Cl,Je=Vl,Ze=Sl,w=wl,re=Rl,ie=El,g=nl("hasPermi"),el=Nl;return p(),Y("div",Pl,[t(sl,{"enter-active-class":(me=n(d))==null?void 0:me.animate.searchAnimate.enter,"leave-active-class":(pe=n(d))==null?void 0:pe.animate.searchAnimate.leave},{default:o(()=>[y(T("div",Bl,[t(de,{shadow:"hover"},{default:o(()=>[t(G,{ref_key:"queryFormRef",ref:le,model:n(c),inline:!0},{default:o(()=>[t(u,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(r,{modelValue:n(c).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>n(c).roleName=l),placeholder:"请输入角色名称",clearable:"",onKeyup:ve(B,["enter"])},null,8,["modelValue"])]),_:1}),t(u,{label:"权限字符",prop:"roleKey"},{default:o(()=>[t(r,{modelValue:n(c).roleKey,"onUpdate:modelValue":e[1]||(e[1]=l=>n(c).roleKey=l),placeholder:"请输入权限字符",clearable:"",onKeyup:ve(B,["enter"])},null,8,["modelValue"])]),_:1}),t(u,{label:"状态",prop:"status"},{default:o(()=>[t(I,{modelValue:n(c).status,"onUpdate:modelValue":e[2]||(e[2]=l=>n(c).status=l),placeholder:"角色状态",clearable:""},{default:o(()=>[(p(!0),Y(W,null,X(n(J),l=>(p(),v(O,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"创建时间",style:{width:"308px"}},{default:o(()=>[t(Le,{modelValue:n(U),"onUpdate:modelValue":e[3]||(e[3]=l=>h(U)?U.value=l:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),t(u,null,{default:o(()=>[t(f,{type:"primary",icon:"Search",onClick:B},{default:o(()=>[m("搜索")]),_:1}),t(f,{icon:"Refresh",onClick:Re},{default:o(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[_e,n($)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(de,{shadow:"hover"},{header:o(()=>[t(je,{gutter:10},{default:o(()=>[t(L,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"primary",plain:"",icon:"Plus",onClick:e[4]||(e[4]=l=>Te())},{default:o(()=>[m("新增")]),_:1})),[[g,["system:role:add"]]])]),_:1}),t(L,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"success",plain:"",disabled:n(ee),icon:"Edit",onClick:e[5]||(e[5]=l=>oe())},{default:o(()=>[m("修改")]),_:1},8,["disabled"])),[[g,["system:role:edit"]]])]),_:1}),t(L,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"danger",plain:"",disabled:n(x).length===0,onClick:e[6]||(e[6]=l=>ae())},{default:o(()=>[m("删除")]),_:1},8,["disabled"])),[[g,["system:role:delete"]]])]),_:1}),t(L,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"warning",plain:"",icon:"Download",onClick:Ee},{default:o(()=>[m("导出")]),_:1})),[[g,["system:role:export"]]])]),_:1}),t(Ye,{showSearch:n($),"onUpdate:showSearch":e[7]||(e[7]=l=>h($)?$.value=l:null),onQueryTable:C},null,8,["showSearch"])]),_:1})]),default:o(()=>[y((p(),v(He,{ref:"roleTableRef",data:n(Z),onSelectionChange:Ne},{default:o(()=>[t(V,{type:"selection",width:"55",align:"center"}),E("",!0),t(V,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),t(V,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"200"}),t(V,{label:"显示顺序",prop:"roleSort",width:"100"}),t(V,{label:"状态",align:"center",width:"100"},{default:o(l=>[t(ze,{modelValue:l.row.status,"onUpdate:modelValue":R=>l.row.status=R,"active-value":"0","inactive-value":"1",onChange:R=>Ue(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(V,{label:"创建时间",align:"center",prop:"createTime"},{default:o(l=>[T("span",null,ye(a.parseTime(l.row.createTime)),1)]),_:1}),t(V,{fixed:"right",label:"操作",width:"180"},{default:o(l=>[l.row.roleId!==1?(p(),v(D,{key:0,content:"修改",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"Edit",onClick:R=>oe(l.row)},null,8,["onClick"]),[[g,["system:role:edit"]]])]),_:2},1024)):E("",!0),l.row.roleId!==1?(p(),v(D,{key:1,content:"删除",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"Delete",onClick:R=>ae(l.row)},null,8,["onClick"]),[[g,["system:role:remove"]]])]),_:2},1024)):E("",!0),l.row.roleId!==1?(p(),v(D,{key:2,content:"数据权限",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"CircleCheck",onClick:R=>Pe(l.row)},null,8,["onClick"]),[[g,["system:role:edit"]]])]),_:2},1024)):E("",!0),l.row.roleId!==1?(p(),v(D,{key:3,content:"分配用户",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"User",onClick:R=>Ke(l.row)},null,8,["onClick"]),[[g,["system:role:edit"]]])]),_:2},1024)):E("",!0)]),_:1})]),_:1},8,["data"])),[[el,n(j)]]),n(N)>0?(p(),v(Qe,{key:0,total:n(N),"onUpdate:total":e[8]||(e[8]=l=>h(N)?N.value=l:null),page:n(c).pageNum,"onUpdate:page":e[9]||(e[9]=l=>n(c).pageNum=l),limit:n(c).pageSize,"onUpdate:limit":e[10]||(e[10]=l=>n(c).pageSize=l),onPagination:C},null,8,["total","page","limit"])):E("",!0)]),_:1}),t(ie,{modelValue:n(_).visible,"onUpdate:modelValue":e[22]||(e[22]=l=>n(_).visible=l),title:n(_).title,width:"500px","append-to-body":""},{footer:o(()=>[T("div",Ol,[t(f,{type:"primary",onClick:qe},{default:o(()=>[m("确 定")]),_:1}),t(f,{onClick:Me},{default:o(()=>[m("取 消")]),_:1})])]),default:o(()=>[t(G,{ref_key:"roleFormRef",ref:z,model:n(s),rules:n(we),"label-width":"100px"},{default:o(()=>[t(u,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(r,{modelValue:n(s).roleName,"onUpdate:modelValue":e[11]||(e[11]=l=>n(s).roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(u,{prop:"roleKey"},{label:o(()=>[T("span",null,[t(D,{content:"控制器中定义的权限字符，如：@SaCheckRole('admin')",placement:"top"},{default:o(()=>[t(We,null,{default:o(()=>[t(Ge)]),_:1})]),_:1}),m(" 权限字符 ")])]),default:o(()=>[t(r,{modelValue:n(s).roleKey,"onUpdate:modelValue":e[12]||(e[12]=l=>n(s).roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),t(u,{label:"角色顺序",prop:"roleSort"},{default:o(()=>[t(Xe,{modelValue:n(s).roleSort,"onUpdate:modelValue":e[13]||(e[13]=l=>n(s).roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:o(()=>[t(Ze,{modelValue:n(s).status,"onUpdate:modelValue":e[14]||(e[14]=l=>n(s).status=l)},{default:o(()=>[(p(!0),Y(W,null,X(n(J),l=>(p(),v(Je,{key:l.value,value:l.value},{default:o(()=>[m(ye(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"菜单权限"},{default:o(()=>[t(w,{modelValue:n(F),"onUpdate:modelValue":e[15]||(e[15]=l=>h(F)?F.value=l:null),onChange:e[16]||(e[16]=l=>ne(l,"menu"))},{default:o(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(w,{modelValue:n(q),"onUpdate:modelValue":e[17]||(e[17]=l=>h(q)?q.value=l:null),onChange:e[18]||(e[18]=l=>se(l,"menu"))},{default:o(()=>[m("全选/全不选")]),_:1},8,["modelValue"]),t(w,{modelValue:n(s).menuCheckStrictly,"onUpdate:modelValue":e[19]||(e[19]=l=>n(s).menuCheckStrictly=l),onChange:e[20]||(e[20]=l=>ue(l,"menu"))},{default:o(()=>[m("父子联动")]),_:1},8,["modelValue"]),t(re,{ref_key:"menuRef",ref:k,class:"tree-border",data:n(K),"show-checkbox":"","node-key":"id","check-strictly":!n(s).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(u,{label:"备注"},{default:o(()=>[t(r,{modelValue:n(s).remark,"onUpdate:modelValue":e[21]||(e[21]=l=>n(s).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ie,{modelValue:n(S),"onUpdate:modelValue":e[32]||(e[32]=l=>h(S)?S.value=l:null),title:n(_).title,width:"500px","append-to-body":""},{footer:o(()=>[T("div",Ll,[t(f,{type:"primary",onClick:Be},{default:o(()=>[m("确 定")]),_:1}),t(f,{onClick:Oe},{default:o(()=>[m("取 消")]),_:1})])]),default:o(()=>[t(G,{ref_key:"dataScopeRef",ref:te,model:n(s),"label-width":"80px"},{default:o(()=>[t(u,{label:"角色名称"},{default:o(()=>[t(r,{modelValue:n(s).roleName,"onUpdate:modelValue":e[23]||(e[23]=l=>n(s).roleName=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(u,{label:"权限字符"},{default:o(()=>[t(r,{modelValue:n(s).roleKey,"onUpdate:modelValue":e[24]||(e[24]=l=>n(s).roleKey=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(u,{label:"权限范围"},{default:o(()=>[t(I,{modelValue:n(s).dataScope,"onUpdate:modelValue":e[25]||(e[25]=l=>n(s).dataScope=l),onChange:Ae},{default:o(()=>[(p(!0),Y(W,null,X(n(Ve),l=>(p(),v(O,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),y(t(u,{label:"数据权限"},{default:o(()=>[t(w,{modelValue:n(M),"onUpdate:modelValue":e[26]||(e[26]=l=>h(M)?M.value=l:null),onChange:e[27]||(e[27]=l=>ne(l,"dept"))},{default:o(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(w,{modelValue:n(A),"onUpdate:modelValue":e[28]||(e[28]=l=>h(A)?A.value=l:null),onChange:e[29]||(e[29]=l=>se(l,"dept"))},{default:o(()=>[m("全选/全不选")]),_:1},8,["modelValue"]),t(w,{modelValue:n(s).deptCheckStrictly,"onUpdate:modelValue":e[30]||(e[30]=l=>n(s).deptCheckStrictly=l),onChange:e[31]||(e[31]=l=>ue(l,"dept"))},{default:o(()=>[m("父子联动")]),_:1},8,["modelValue"]),t(re,{ref_key:"deptRef",ref:b,class:"tree-border",data:n(P),"show-checkbox":"","default-expand-all":"","node-key":"id","check-strictly":!n(s).deptCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[_e,n(s).dataScope==="2"]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{it as default};
