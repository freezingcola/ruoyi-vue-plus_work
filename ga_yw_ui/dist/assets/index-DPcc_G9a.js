import{an as J,d as _e,V as Le,r as u,Y as X,b as Ke,aK as ze,j as Ie,o as g,c as H,k as e,m as l,e as o,a3 as Q,ab as xe,w as L,x as h,t as pe,y as d,a7 as j,p as b,T as k,q as G,R as Be,D as Re,aC as Pe,a0 as Fe,W as Ye,C as Me,G as qe,H as Ae,X as Oe,a8 as Xe,aJ as He,ak as Qe,a9 as je,bl as Ge,au as Je,ax as We,ay as Ze,am as el,v as ll}from"./index-BoCONcAc.js";/* empty css                    *//* empty css                *//* empty css                    *//* empty css                       */import{_ as tl}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                *//* empty css                        *//* empty css               */import{_ as al}from"./index-B4NenLWv.js";/* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css               *//* empty css                */import{l as ol,g as nl,d as il,a as sl,u as dl,c as rl,b as ul}from"./index-Bo-V6W7V.js";import{_ as cl}from"./processPreview.vue_vue_type_script_setup_true_lang-CT3WBW6g.js";import{l as ml}from"./index-BMOFFQpT.js";import"./index-CvHQooJA.js";import"./Event-BS7rISKI.js";import"./index-LhLwlHgt.js";const pl=V=>J({url:"/workflow/definitionConfig/getByDefId/"+V,method:"get"}),fe=V=>J({url:"/workflow/definitionConfig/saveOrUpdate",method:"post",data:V}),fl=(V,n)=>J({url:`/workflow/definitionConfig/getByTableNameNotDefId/${V}/${n}`,method:"get"}),_l={class:"p-2"},vl={class:"mb-[10px]"},gl={key:0},yl={class:"mb5"},kl=h("span",{class:"text-danger"},"*",-1),wl=h("div",{class:"el-upload__text"},[h("em",null,"点击上传，选择BPMN流程文件")],-1),bl=h("div",{class:"el-upload__text"},"仅支持 .zip、.bpmn20.xml、bpmn 格式文件",-1),hl=h("div",{class:"el-upload__text"},"PS:如若部署请部署从本项目模型管理导出的数据",-1),Cl={class:"dialog-footer"},Sl=_e({name:"processDefinition"}),Xl=_e({...Sl,setup(V){const{proxy:n}=Le(),P=u(),W=u(),Z=u(),c=u({}),_=u(!0),ee=u([]),le=u([]),te=u([]),ve=u(!0),ae=u(!0),K=u(!0),F=u(0),Y=u(!1),oe=u([]),ne=u([]),I=u([]),x=u(""),N=u(),D=X({visible:!1,title:"部署流程文件"}),z=X({visible:!1,title:"历史版本"}),C=X({visible:!1,title:"流程定义配置"}),m=u({pageNum:1,pageSize:10,name:void 0,key:void 0,categoryCode:void 0});Ke(()=>{y(),ke()});const ge=a=>{m.value.categoryCode=a.categoryCode,a.categoryCode==="ALL"&&(m.value.categoryCode=""),$()},ye=(a,t)=>a?t.categoryName.indexOf(a)!==-1:!0;ze(()=>{Z.value.filter(x.value)},{flush:"post"});const ke=async()=>{const a=await ml();I.value=[];const t={categoryCode:"ALL",categoryName:"顶级节点",children:[]};t.children=n==null?void 0:n.handleTree(a.data,"id","parentId"),I.value.push(t)},$=()=>{m.value.pageNum=1,y()},we=()=>{var a;(a=W.value)==null||a.resetFields(),m.value.categoryCode="",m.value.pageNum=1,m.value.pageSize=10,$()},ie=a=>{ee.value=a.map(t=>t.id),le.value=a.map(t=>t.deploymentId),te.value=a.map(t=>t.key),ve.value=a.length!==1,ae.value=!a.length},y=async()=>{_.value=!0;const a=await ol(m.value);oe.value=a.rows,F.value=a.total,_.value=!1},be=async(a,t)=>{z.visible=!0,_.value=!0;const f=await nl(t);f.data&&f.data.length>0&&(ne.value=f.data.filter(S=>S.id!==a)),_.value=!1},se=async(a,t)=>{_.value=!0;const f=await il(a);if(P.value){const S=f.data.xmlStr;_.value=!1,P.value.openDialog(S,t)}},M=async a=>{const t=(a==null?void 0:a.id)||ee.value,f=(a==null?void 0:a.deploymentId)||le.value,S=(a==null?void 0:a.key)||te.value;await(n==null?void 0:n.$modal.confirm("是否确认删除流程定义KEY为【"+S+"】的数据项？")),_.value=!0,await sl(f,t).finally(()=>_.value=!1),await y(),n==null||n.$modal.msgSuccess("删除成功")},de=async a=>{let t;a.suspensionState===1?t=`暂停后，此流程下的所有任务都不允许往后流转，您确定挂起【${a.name||a.key}】吗？`:t=`启动后，此流程下的所有任务都允许往后流转，您确定激活【${a.name||a.key}】吗？`,await(n==null?void 0:n.$modal.confirm(t)),_.value=!0,await dl(a.id).finally(()=>_.value=!1),await y(),n==null||n.$modal.msgSuccess("操作成功")},re=async a=>{await(n==null?void 0:n.$modal.confirm("是否确认转换流程定义key为【"+a.key+"】的数据项？")),await rl(a.id).finally(()=>_.value=!1),y(),n==null||n.$modal.msgSuccess("操作成功")},he=()=>{if(N.value==="ALL")return n==null||n.$modal.msgError("顶级节点不可作为分类！"),!1;if(!N.value)return n==null||n.$modal.msgError("请选择左侧要上传的分类！"),!1},Ce=a=>{let t=new FormData;Y.value=!0,t.append("file",a.file),t.append("categoryCode",N.value),ul(t).then(()=>{D.visible=!1,n==null||n.$modal.msgSuccess("部署成功"),$()}).finally(()=>{Y.value=!1})},ue=async a=>{C.visible=!0,c.value.processKey=a.key,c.value.definitionId=a.id,c.value.version=a.version;const t=await pl(a.id);t.data?c.value=t.data:(c.value.tableName=void 0,c.value.remark=void 0)},Se=async()=>{fl(c.value.tableName,c.value.definitionId).then(a=>{a.data&&a.data.length>0?Be.confirm("表名已被【"+a.data[0].processKey+"】版本v"+a.data[0].version+".0绑定确认后将会删除绑定的流程KEY!","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{fe(c.value).then(t=>{t.code===200&&(n==null||n.$modal.msgSuccess("操作成功"),C.visible=!1,y())})}):fe(c.value).then(t=>{t.code===200&&(n==null||n.$modal.msgSuccess("操作成功"),C.visible=!1,y())})})};return(a,t)=>{const f=Re,S=Pe,q=Fe,v=Ye,E=Me,p=qe,ce=Ae,Ve=al,T=Oe,r=Xe,B=He,R=Qe,me=je,Ne=tl,De=Ge,$e=Je,Ee=Ie("upload-filled"),Te=We,Ue=Ze,A=el,O=ll;return g(),H("div",_l,[e(T,{gutter:20},{default:l(()=>[e(v,{lg:4,xs:24,style:{}},{default:l(()=>[e(q,{shadow:"hover"},{default:l(()=>[e(f,{modelValue:o(x),"onUpdate:modelValue":t[0]||(t[0]=i=>Q(x)?x.value=i:null),placeholder:"请输入流程分类名","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),e(S,{ref_key:"categoryTreeRef",ref:Z,class:"mt-2","node-key":"id",data:o(I),props:{label:"categoryName",children:"children"},"expand-on-click-node":!1,"filter-node-method":ye,"highlight-current":"","default-expand-all":"",onNodeClick:ge},null,8,["data"])]),_:1})]),_:1}),e(v,{lg:20,xs:24},{default:l(()=>{var i,w;return[e(xe,{"enter-active-class":(i=o(n))==null?void 0:i.animate.searchAnimate.enter,"leave-active-class":(w=o(n))==null?void 0:w.animate.searchAnimate.leave},{default:l(()=>[L(h("div",vl,[e(q,{shadow:"hover"},{default:l(()=>[L(e(ce,{ref_key:"queryFormRef",ref:W,model:o(m),inline:!0,"label-width":"120px"},{default:l(()=>[e(E,{label:"流程定义名称",prop:"name"},{default:l(()=>[e(f,{modelValue:o(m).name,"onUpdate:modelValue":t[1]||(t[1]=s=>o(m).name=s),placeholder:"请输入流程定义名称",clearable:"",onKeyup:pe($,["enter"])},null,8,["modelValue"])]),_:1}),e(E,{label:"流程定义KEY",prop:"key"},{default:l(()=>[e(f,{modelValue:o(m).key,"onUpdate:modelValue":t[2]||(t[2]=s=>o(m).key=s),placeholder:"请输入流程定义KEY",clearable:"",onKeyup:pe($,["enter"])},null,8,["modelValue"])]),_:1}),e(E,null,{default:l(()=>[e(p,{type:"primary",icon:"Search",onClick:$},{default:l(()=>[d("搜索")]),_:1}),e(p,{icon:"Refresh",onClick:we},{default:l(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[j,o(K)]])]),_:1})],512),[[j,o(K)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(q,{shadow:"hover"},{header:l(()=>[e(T,{gutter:10,class:"mb8"},{default:l(()=>[e(v,{span:1.5},{default:l(()=>[e(p,{type:"danger",icon:"Delete",disabled:o(ae),onClick:t[3]||(t[3]=s=>M())},{default:l(()=>[d("删除")]),_:1},8,["disabled"])]),_:1}),e(v,{span:1.5},{default:l(()=>[e(p,{type:"primary",icon:"UploadFilled",onClick:t[4]||(t[4]=s=>o(D).visible=!0)},{default:l(()=>[d("部署流程文件")]),_:1})]),_:1}),e(Ve,{showSearch:o(K),"onUpdate:showSearch":t[5]||(t[5]=s=>Q(K)?K.value=s:null),onQueryTable:y},null,8,["showSearch"])]),_:1})]),default:l(()=>[L((g(),b(me,{border:"",data:o(oe),onSelectionChange:ie},{default:l(()=>[e(r,{type:"selection",width:"55",align:"center"}),e(r,{align:"center",type:"index",label:"序号",width:"60"}),e(r,{align:"center",prop:"name",label:"流程定义名称","show-overflow-tooltip":!0}),e(r,{align:"center",prop:"key",label:"标识KEY",width:"80"}),e(r,{align:"center",prop:"version",label:"版本号",width:"80"},{default:l(s=>[d(" v"+k(s.row.version)+".0",1)]),_:1}),e(r,{align:"center",prop:"resourceName",label:"流程XML",width:"100","show-overflow-tooltip":!0},{default:l(s=>[e(B,{type:"primary",onClick:U=>se(s.row.id,"xml")},{default:l(()=>[d(k(s.row.resourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{align:"center",prop:"diagramResourceName",label:"流程图片",width:"100","show-overflow-tooltip":!0},{default:l(s=>[e(B,{type:"primary",onClick:U=>se(s.row.id,"bpmn")},{default:l(()=>[d(k(s.row.diagramResourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{align:"center",prop:"suspensionState",label:"状态",width:"80"},{default:l(s=>[s.row.suspensionState==1?(g(),b(R,{key:0,type:"success"},{default:l(()=>[d("激活")]),_:1})):(g(),b(R,{key:1,type:"danger"},{default:l(()=>[d("挂起")]),_:1}))]),_:1}),e(r,{align:"center",prop:"deploymentTime",label:"部署时间",width:"120","show-overflow-tooltip":!0}),e(r,{align:"center",label:"表名/表单KEY",width:"120","show-overflow-tooltip":!0},{default:l(s=>[s.row.wfDefinitionConfigVo?(g(),H("span",gl,k(s.row.wfDefinitionConfigVo.tableName),1)):G("",!0)]),_:1}),e(r,{fixed:"right",label:"操作",align:"center",width:"220","class-name":"small-padding fixed-width"},{default:l(s=>[e(T,{gutter:10,class:"mb8"},{default:l(()=>[e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",size:"small",icon:s.row.suspensionState===1?"Lock":"Unlock",onClick:U=>de(s.row)},{default:l(()=>[d(k(s.row.suspensionState===1?"挂起流程":"激活流程"),1)]),_:2},1032,["icon","onClick"])]),_:2},1024),e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Document",onClick:U=>be(s.row.id,s.row.key)},{default:l(()=>[d(" 历史版本 ")]),_:2},1032,["onClick"])]),_:2},1024),e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Delete",onClick:U=>M(s.row)},{default:l(()=>[d("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(T,{gutter:10,class:"mb8"},{default:l(()=>[e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Sort",onClick:U=>re(s.row)},{default:l(()=>[d(" 转换模型 ")]),_:2},1032,["onClick"])]),_:2},1024),e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Tickets",onClick:U=>ue(s.row)},{default:l(()=>[d("绑定业务")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[O,o(_)]]),L(e(Ne,{page:o(m).pageNum,"onUpdate:page":t[6]||(t[6]=s=>o(m).pageNum=s),limit:o(m).pageSize,"onUpdate:limit":t[7]||(t[7]=s=>o(m).pageSize=s),total:o(F),onPagination:y},null,8,["page","limit","total"]),[[j,o(F)>0]])]),_:1})]}),_:1})]),_:1}),e(cl,{ref_key:"previewRef",ref:P},null,512),o(D).visible?(g(),b(A,{key:0,modelValue:o(D).visible,"onUpdate:modelValue":t[9]||(t[9]=i=>o(D).visible=i),title:o(D).title,width:"30%"},{default:l(()=>[L((g(),H("div",null,[h("div",yl,[e(De,{class:"mx-1",size:"large"},{default:l(()=>[kl,d("请选择部署流程分类：")]),_:1}),e($e,{modelValue:o(N),"onUpdate:modelValue":t[8]||(t[8]=i=>Q(N)?N.value=i:null),data:o(I),props:{value:"categoryCode",label:"categoryName",children:"children"},filterable:"","value-key":"categoryCode","render-after-expand":!1,"check-strictly":"",style:{width:"240px"}},null,8,["modelValue","data"])]),e(Ue,{class:"upload-demo",drag:"",multiple:"",accept:"application/zip,application/xml,.bpmn","before-upload":he,"http-request":Ce},{default:l(()=>[e(Te,{class:"UploadFilled"},{default:l(()=>[e(Ee)]),_:1}),wl,bl,hl]),_:1})])),[[O,o(Y)]])]),_:1},8,["modelValue","title"])):G("",!0),o(z).visible?(g(),b(A,{key:1,modelValue:o(z).visible,"onUpdate:modelValue":t[10]||(t[10]=i=>o(z).visible=i),title:o(z).title,width:"70%"},{default:l(()=>[L((g(),b(me,{data:o(ne),onSelectionChange:ie},{default:l(()=>[e(r,{type:"selection",width:"55",align:"center"}),e(r,{align:"center",type:"index",label:"序号",width:"60"}),e(r,{align:"center",prop:"name",label:"流程定义名称","show-overflow-tooltip":!0,"min-width":"80"}),e(r,{align:"center",prop:"key",label:"标识KEY"}),e(r,{align:"center",prop:"version",label:"版本号",width:"90"},{default:l(i=>[d(" v"+k(i.row.version)+".0",1)]),_:1}),e(r,{align:"center",prop:"resourceName",label:"流程XML","min-width":"80","show-overflow-tooltip":!0},{default:l(i=>[e(B,{type:"primary",onClick:w=>a.clickPreviewXML(i.row.id)},{default:l(()=>[d(k(i.row.resourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{align:"center",prop:"diagramResourceName",label:"流程图片","min-width":"80","show-overflow-tooltip":!0},{default:l(i=>[e(B,{type:"primary",onClick:w=>a.clickPreviewImg(i.row.id)},{default:l(()=>[d(k(i.row.diagramResourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{align:"center",prop:"suspensionState",label:"状态","min-width":"70"},{default:l(i=>[i.row.suspensionState==1?(g(),b(R,{key:0,type:"success"},{default:l(()=>[d("激活")]),_:1})):(g(),b(R,{key:1,type:"danger"},{default:l(()=>[d("挂起")]),_:1}))]),_:1}),e(r,{align:"center",prop:"deploymentTime",label:"部署时间","show-overflow-tooltip":!0}),e(r,{fixed:"right",label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:l(i=>[e(T,{gutter:10,class:"mb8"},{default:l(()=>[e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",size:"small",icon:i.row.suspensionState===1?"Lock":"Unlock",onClick:w=>de(i.row)},{default:l(()=>[d(k(i.row.suspensionState===1?"挂起流程":"激活流程"),1)]),_:2},1032,["icon","onClick"])]),_:2},1024),e(v,{span:1.5},{default:l(()=>[e(p,{type:"text",size:"small",icon:"Tickets",onClick:w=>ue(i.row)},{default:l(()=>[d("绑定业务")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(T,{gutter:10,class:"mb8"},{default:l(()=>[e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",icon:"Sort",size:"small",onClick:w=>re(i.row)},{default:l(()=>[d(" 转换模型 ")]),_:2},1032,["onClick"])]),_:2},1024),e(v,{span:1.5},{default:l(()=>[e(p,{link:"",type:"primary",icon:"Delete",size:"small",onClick:w=>M(i.row)},{default:l(()=>[d("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[O,o(_)]])]),_:1},8,["modelValue","title"])):G("",!0),e(A,{modelValue:o(C).visible,"onUpdate:modelValue":t[15]||(t[15]=i=>o(C).visible=i),title:o(C).title,width:"650px","append-to-body":"","close-on-click-modal":!1},{footer:l(()=>[h("div",Cl,[e(p,{onClick:t[14]||(t[14]=i=>o(C).visible=!1)},{default:l(()=>[d("取消")]),_:1}),e(p,{type:"primary",onClick:Se},{default:l(()=>[d("保存")]),_:1})])]),default:l(()=>[e(ce,{model:o(c),"label-width":"auto"},{default:l(()=>[e(E,{label:"流程KEY"},{default:l(()=>[e(f,{modelValue:o(c).processKey,"onUpdate:modelValue":t[11]||(t[11]=i=>o(c).processKey=i),disabled:""},null,8,["modelValue"])]),_:1}),e(E,{label:"表名",prop:"formId"},{default:l(()=>[e(f,{modelValue:o(c).tableName,"onUpdate:modelValue":t[12]||(t[12]=i=>o(c).tableName=i),placeholder:"示例:test_leave"},null,8,["modelValue"])]),_:1}),e(E,{label:"备注"},{default:l(()=>[e(f,{modelValue:o(c).remark,"onUpdate:modelValue":t[13]||(t[13]=i=>o(c).remark=i),type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Xl as default};
