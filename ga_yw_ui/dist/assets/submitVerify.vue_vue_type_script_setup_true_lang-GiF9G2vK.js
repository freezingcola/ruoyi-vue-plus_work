import{d as fe,V as pe,r as c,Y as ke,b as ge,o as n,p as i,m as l,x as z,w as k,y as u,q as C,e as V,H as O,k as o,c as j,M as x,N as G,T as be,n as _e,F as ye,aG as Ie,C as Ce,G as Ve,ak as Te,D as we,O as Se,P as Ne,am as Ue,v as $e}from"./index-BoCONcAc.js";import{_ as De}from"./index-DG7XexN9.js";import"./el-form-item-l0sNRNKZ.js";/* empty css                    */import{g as he,c as Be,a as Ee,b as Le,t as Re,d as Me,e as Ae}from"./index-DSKxzbdu.js";import{_ as E}from"./index.vue_vue_type_script_setup_true_lang-Bfb_m_-c.js";import{_ as Fe}from"./multiInstanceUser.vue_vue_type_script_setup_true_name_User_lang-kSMcaROF.js";const Pe={class:"dialog-footer"},ze={class:"dialog-footer",style:{float:"right","padding-bottom":"20px"}},Ye=fe({__name:"submitVerify",props:{taskVariables:{type:Object,default:{}}},emits:["submitCallback","cancelCallback"],setup(K,{expose:W,emit:q}){const{proxy:e}=pe(),L=c(),R=c(),M=c(),U=c(),H=K,m=c(!0),d=c(!0),I=c(""),_=c([]),$=c(void 0),D=c(!1),T=c(!0),h=c([]),r=c({id:void 0,name:void 0,description:void 0,priority:void 0,owner:void 0,assignee:void 0,assigneeName:void 0,processInstanceId:void 0,executionId:void 0,taskDefinitionId:void 0,processDefinitionId:void 0,endTime:void 0,taskDefinitionKey:void 0,dueDate:void 0,category:void 0,parentTaskId:void 0,tenantId:void 0,claimTime:void 0,businessStatus:void 0,businessStatusName:void 0,processDefinitionName:void 0,processDefinitionKey:void 0,participantVo:void 0,multiInstance:void 0,businessKey:void 0,wfNodeConfigVo:void 0}),B=c(""),g=ke({visible:!1,title:"提示"}),v=c({taskId:void 0,message:void 0,variables:{},messageType:["1"],wfCopyList:[]}),f=c({taskId:void 0,targetActivityId:void 0,message:void 0,variables:{},messageType:["1"]}),Y=()=>{g.visible=!1},J=s=>{$.value=void 0,_.value=[],v.value.fileId=void 0,I.value=s,v.value.message=void 0,g.visible=!0,m.value=!0,d.value=!0,_e(()=>{he(I.value).then(a=>{r.value=a.data,m.value=!1,d.value=!1})})};ge(()=>{});const S=q,Q=async()=>{if(v.value.taskId=I.value,v.value.taskVariables=H.taskVariables,_&&_.value.length>0){let s=[];_.value.forEach(a=>{let y={userId:a.userId,userName:a.nickName};s.push(y)}),v.value.wfCopyList=s}await(e==null?void 0:e.$modal.confirm("是否确认提交？")),m.value=!0,d.value=!0;try{await Be(v.value),g.visible=!1,S("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")}finally{m.value=!1,d.value=!1}},X=async()=>{f.value={},f.value.messageType=["1"],D.value=!0,T.value=!0;let s=await Ee(r.value.processInstanceId);h.value=s.data,T.value=!1,f.value.targetActivityId=h.value[0].nodeId},Z=async()=>{f.value.taskId=I.value,await(e==null?void 0:e.$modal.confirm("是否确认驳回到申请人？")),m.value=!0,T.value=!0,await Le(f.value).finally(()=>m.value=!1),g.visible=!1,T.value=!1,S("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")},A=async()=>{g.visible=!1,d.value=!1,S("cancelCallback")},ee=()=>{L.value.open()},ae=s=>{s&&s.length>0&&(_.value=s,$.value=_.value.map(a=>a.userId).join(","))},le=s=>{const a=s.userId,y=_.value.findIndex(N=>N.userId===a);_.value.splice(y,1),$.value=_.value.map(N=>N.userId).join(",")},te=()=>{U.value&&(B.value="加签人员",U.value.getAddMultiInstanceList(I.value,[]))},se=()=>{U.value&&(B.value="减签人员",U.value.getDeleteMultiInstanceList(I.value))},oe=()=>{R.value.open()},ne=async s=>{if(s&&s.length>0){let a={taskId:I.value,userId:s[0].userId,comment:v.value.message};await(e==null?void 0:e.$modal.confirm("是否确认提交？")),m.value=!0,d.value=!0,await Re(a).finally(()=>m.value=!1),g.visible=!1,S("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")}else e==null||e.$modal.msgWarning("请选择用户！")},ie=()=>{M.value.open()},ue=async s=>{if(s&&s.length>0){let a={taskId:I.value,userId:s[0].userId,nickName:s[0].nickName};await(e==null?void 0:e.$modal.confirm("是否确认提交？")),m.value=!0,d.value=!0,await Me(a).finally(()=>m.value=!1),g.visible=!1,S("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")}else e==null||e.$modal.msgWarning("请选择用户！")},de=async s=>{let a={taskId:I.value,comment:v.value.message};await(e==null?void 0:e.$modal.confirm("是否确认终止？")),m.value=!0,d.value=!0,await Ae(a).finally(()=>m.value=!1),g.visible=!1,S("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")};return W({openDialog:J}),(s,a)=>{const y=ye,N=Ie,w=Ce,ce=De,b=Ve,ve=Te,F=we,me=Se,re=Ne,P=Ue,p=$e;return n(),i(P,{modelValue:V(g).visible,"onUpdate:modelValue":a[8]||(a[8]=t=>V(g).visible=t),title:V(g).title,width:"50%",draggable:"","before-close":A,center:"","close-on-click-modal":!1},{footer:l(()=>[z("span",Pe,[k((n(),i(b,{type:"primary",onClick:Q},{default:l(()=>[u(" 提交 ")]),_:1})),[[p,d.value]]),r.value.businessStatus==="waiting"?k((n(),i(b,{key:0,type:"primary",onClick:ie},{default:l(()=>[u(" 委托 ")]),_:1})),[[p,d.value]]):C("",!0),r.value.businessStatus==="waiting"?k((n(),i(b,{key:1,type:"primary",onClick:oe},{default:l(()=>[u(" 转办 ")]),_:1})),[[p,d.value]]):C("",!0),r.value.businessStatus==="waiting"&&r.value.multiInstance?k((n(),i(b,{key:2,type:"primary",onClick:te},{default:l(()=>[u(" 加签 ")]),_:1})),[[p,d.value]]):C("",!0),r.value.businessStatus==="waiting"&&r.value.multiInstance?k((n(),i(b,{key:3,type:"primary",onClick:se},{default:l(()=>[u(" 减签 ")]),_:1})),[[p,d.value]]):C("",!0),r.value.businessStatus==="waiting"?k((n(),i(b,{key:4,type:"danger",onClick:de},{default:l(()=>[u(" 终止 ")]),_:1})),[[p,d.value]]):C("",!0),r.value.businessStatus==="waiting"?k((n(),i(b,{key:5,type:"danger",onClick:X},{default:l(()=>[u(" 退回 ")]),_:1})),[[p,d.value]]):C("",!0),k((n(),i(b,{onClick:A},{default:l(()=>[u("取消")]),_:1})),[[p,d.value]])])]),default:l(()=>[k((n(),i(V(O),{model:v.value,"label-width":"120px"},{default:l(()=>[o(w,{label:"消息提醒"},{default:l(()=>[o(N,{modelValue:v.value.messageType,"onUpdate:modelValue":a[0]||(a[0]=t=>v.value.messageType=t)},{default:l(()=>[o(y,{label:"1",name:"type",disabled:""},{default:l(()=>[u("站内信")]),_:1}),o(y,{label:"2",name:"type"},{default:l(()=>[u("邮件")]),_:1}),o(y,{label:"3",name:"type"},{default:l(()=>[u("短信")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r.value.businessStatus==="waiting"?(n(),i(w,{key:0,label:"附件"},{default:l(()=>[o(ce,{modelValue:v.value.fileId,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value.fileId=t),fileType:["doc","xls","ppt","txt","pdf","xlsx","docx","zip"],fileSize:"20"},null,8,["modelValue"])]),_:1})):C("",!0),o(w,{label:"抄送"},{default:l(()=>[o(b,{type:"primary",onClick:ee,icon:"Plus",circle:""}),(n(!0),j(x,null,G(_.value,t=>(n(),i(ve,{key:t.userId,closable:"",style:{margin:"2px"},onClose:Oe=>le(t)},{default:l(()=>[u(be(t.userName),1)]),_:2},1032,["onClose"]))),128))]),_:1}),r.value.businessStatus==="waiting"?(n(),i(w,{key:1,label:"审批意见"},{default:l(()=>[o(F,{modelValue:v.value.message,"onUpdate:modelValue":a[2]||(a[2]=t=>v.value.message=t),type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})):C("",!0)]),_:1},8,["model"])),[[p,m.value]]),o(V(E),{ref_key:"userSelectCopyRef",ref:L,multiple:!0,data:$.value,onConfirmCallBack:ae},null,8,["data"]),o(V(E),{ref_key:"transferTaskRef",ref:R,multiple:!1,onConfirmCallBack:ne},null,512),o(V(E),{ref_key:"delegateTaskRef",ref:M,multiple:!1,onConfirmCallBack:ue},null,512),o(Fe,{ref_key:"multiInstanceUserRef",ref:U,title:B.value,onSubmitCallback:Y},null,8,["title"]),o(P,{modelValue:D.value,"onUpdate:modelValue":a[7]||(a[7]=t=>D.value=t),draggable:"",title:"驳回",width:"40%","close-on-click-modal":!1},{footer:l(()=>[z("div",ze,[k((n(),i(b,{type:"primary",onClick:Z},{default:l(()=>[u("确认")]),_:1})),[[p,T.value]]),k((n(),i(b,{onClick:a[6]||(a[6]=t=>D.value=!1)},{default:l(()=>[u("取消")]),_:1})),[[p,T.value]])])]),default:l(()=>[r.value.businessStatus==="waiting"?k((n(),i(V(O),{key:0,model:f.value,"label-width":"120px"},{default:l(()=>[o(w,{label:"驳回节点"},{default:l(()=>[o(re,{clearable:"",placeholder:"请选择",modelValue:f.value.targetActivityId,"onUpdate:modelValue":a[3]||(a[3]=t=>f.value.targetActivityId=t),style:{width:"300px"}},{default:l(()=>[(n(!0),j(x,null,G(h.value,t=>(n(),i(me,{key:t.nodeId,label:t.nodeName,value:t.nodeId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"消息提醒"},{default:l(()=>[o(N,{modelValue:f.value.messageType,"onUpdate:modelValue":a[4]||(a[4]=t=>f.value.messageType=t)},{default:l(()=>[o(y,{label:"1",name:"type",disabled:""},{default:l(()=>[u("站内信")]),_:1}),o(y,{label:"2",name:"type"},{default:l(()=>[u("邮件")]),_:1}),o(y,{label:"3",name:"type"},{default:l(()=>[u("短信")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"审批意见"},{default:l(()=>[o(F,{modelValue:f.value.message,"onUpdate:modelValue":a[5]||(a[5]=t=>f.value.message=t),type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[p,T.value]]):C("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{Ye as _};
