import{an as P,d as te,V as we,aa as G,r as f,Y as X,b as he,$ as ye,o as c,c as T,k as e,m as l,w as b,x as D,e as t,t as L,M as J,N as Z,p as w,a3 as x,y as d,a7 as ee,ab as Te,T as p,q as le,D as Ve,C as Ce,O as ke,P as Ne,as as Se,G as De,H as Ee,a0 as Ie,W as Re,X as Ue,a8 as Le,ac as Pe,a9 as $e,am as qe,v as Fe}from"./index-BoCONcAc.js";import{_ as Me}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as Be}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as Oe}from"./index-B4NenLWv.js";/* empty css               *//* empty css                *//* empty css                *//* empty css                       */import"./el-form-item-l0sNRNKZ.js";/* empty css                */function Ye(V){return P({url:"/monitor/operlog/list",method:"get",params:V})}function Ae(V){return P({url:"/monitor/operlog/"+V,method:"delete"})}function Ke(){return P({url:"/monitor/operlog/clean",method:"delete"})}const ze={class:"p-2"},He={class:"mb-[10px]"},Qe={key:0},je={key:1},We={class:"dialog-footer"},Ge=te({name:"Operlog"}),dl=te({...Ge,setup(V){const{proxy:n}=we(),{sys_oper_type:E,sys_common_status:$}=G(n==null?void 0:n.useDict("sys_oper_type","sys_common_status")),q=f([]),I=f(!0),C=f(!0),F=f([]),M=f(!0),R=f(0),h=f(["",""]),y=f({prop:"operTime",order:"descending"}),B=f(),O=f(),k=X({visible:!1,title:""}),ae=X({form:{operId:void 0,tenantId:void 0,title:"",businessType:0,businessTypes:void 0,method:"",requestMethod:"",operatorType:0,operName:"",deptName:"",operUrl:"",operIp:"",operLocation:"",operParam:"",jsonResult:"",status:0,errorMsg:"",operTime:"",costTime:0},queryParams:{pageNum:1,pageSize:10,operIp:"",title:"",operName:"",businessType:"",status:"",orderByColumn:y.value.prop,isAsc:y.value.order},rules:{}}),{queryParams:s,form:r}=G(ae),g=async()=>{I.value=!0;const i=await Ye(n==null?void 0:n.addDateRange(s.value,h.value));q.value=i.rows,R.value=i.total,I.value=!1},oe=i=>n==null?void 0:n.selectDictLabel(E.value,i.businessType),N=()=>{s.value.pageNum=1,g()},ne=()=>{var i,o;h.value=["",""],(i=O.value)==null||i.resetFields(),s.value.pageNum=1,(o=B.value)==null||o.sort(y.value.prop,y.value.order)},se=i=>{F.value=i.map(o=>o.operId),M.value=!i.length},re=i=>{s.value.orderByColumn=i.prop,s.value.isAsc=i.order,g()},ie=i=>{k.visible=!0,r.value=i},ue=async i=>{const o=F.value;await(n==null?void 0:n.$modal.confirm('是否确认删除日志编号为"'+o+'"的数据项?')),await Ae(o),await g(),n==null||n.$modal.msgSuccess("删除成功")},pe=async()=>{await(n==null?void 0:n.$modal.confirm("是否确认清空所有操作日志数据项?")),await Ke(),await g(),n==null||n.$modal.msgSuccess("清空成功")},de=()=>{n==null||n.download("monitor/operlog/export",{...s.value},`config_${new Date().getTime()}.xlsx`)};return he(()=>{g()}),(i,o)=>{var j,W;const U=Ve,u=Ce,Y=ke,A=Ne,me=Se,v=De,K=Ee,z=Ie,m=Re,ce=Oe,H=Ue,_=Le,Q=Be,_e=Pe,fe=$e,ge=Me,ve=qe,S=ye("hasPermi"),be=Fe;return c(),T("div",ze,[e(Te,{"enter-active-class":(j=t(n))==null?void 0:j.animate.searchAnimate.enter,"leave-active-class":(W=t(n))==null?void 0:W.animate.searchAnimate.leave},{default:l(()=>[b(D("div",He,[e(z,{shadow:"hover"},{default:l(()=>[e(K,{ref_key:"queryFormRef",ref:O,model:t(s),inline:!0},{default:l(()=>[e(u,{label:"操作地址",prop:"operIp"},{default:l(()=>[e(U,{modelValue:t(s).operIp,"onUpdate:modelValue":o[0]||(o[0]=a=>t(s).operIp=a),placeholder:"请输入操作地址",clearable:"",onKeyup:L(N,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"系统模块",prop:"title"},{default:l(()=>[e(U,{modelValue:t(s).title,"onUpdate:modelValue":o[1]||(o[1]=a=>t(s).title=a),placeholder:"请输入系统模块",clearable:"",onKeyup:L(N,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"操作人员",prop:"operName"},{default:l(()=>[e(U,{modelValue:t(s).operName,"onUpdate:modelValue":o[2]||(o[2]=a=>t(s).operName=a),placeholder:"请输入操作人员",clearable:"",onKeyup:L(N,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"类型",prop:"businessType"},{default:l(()=>[e(A,{modelValue:t(s).businessType,"onUpdate:modelValue":o[3]||(o[3]=a=>t(s).businessType=a),placeholder:"操作类型",clearable:""},{default:l(()=>[(c(!0),T(J,null,Z(t(E),a=>(c(),w(Y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"状态",prop:"status"},{default:l(()=>[e(A,{modelValue:t(s).status,"onUpdate:modelValue":o[4]||(o[4]=a=>t(s).status=a),placeholder:"操作状态",clearable:""},{default:l(()=>[(c(!0),T(J,null,Z(t($),a=>(c(),w(Y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"操作时间",style:{width:"308px"}},{default:l(()=>[e(me,{modelValue:t(h),"onUpdate:modelValue":o[5]||(o[5]=a=>x(h)?h.value=a:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(u,null,{default:l(()=>[e(v,{type:"primary",icon:"Search",onClick:N},{default:l(()=>[d("搜索")]),_:1}),e(v,{icon:"Refresh",onClick:ne},{default:l(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[ee,t(C)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(z,{shadow:"hover"},{header:l(()=>[e(H,{gutter:10,class:"mb8"},{default:l(()=>[e(m,{span:1.5},{default:l(()=>[b((c(),w(v,{type:"danger",plain:"",icon:"Delete",disabled:t(M),onClick:o[6]||(o[6]=a=>ue())},{default:l(()=>[d(" 删除 ")]),_:1},8,["disabled"])),[[S,["monitor:operlog:remove"]]])]),_:1}),e(m,{span:1.5},{default:l(()=>[b((c(),w(v,{type:"danger",plain:"",icon:"WarnTriangleFilled",onClick:pe},{default:l(()=>[d("清空")]),_:1})),[[S,["monitor:operlog:remove"]]])]),_:1}),e(m,{span:1.5},{default:l(()=>[b((c(),w(v,{type:"warning",plain:"",icon:"Download",onClick:de},{default:l(()=>[d("导出")]),_:1})),[[S,["monitor:operlog:export"]]])]),_:1}),e(ce,{showSearch:t(C),"onUpdate:showSearch":o[7]||(o[7]=a=>x(C)?C.value=a:null),onQueryTable:g},null,8,["showSearch"])]),_:1})]),default:l(()=>[b((c(),w(fe,{ref_key:"operLogTableRef",ref:B,data:t(q),"default-sort":t(y),onSelectionChange:se,onSortChange:re},{default:l(()=>[e(_,{type:"selection",width:"50",align:"center"}),e(_,{label:"日志编号",align:"center",prop:"operId"}),e(_,{label:"系统模块",align:"center",prop:"title","show-overflow-tooltip":!0}),e(_,{label:"操作类型",align:"center",prop:"businessType"},{default:l(a=>[e(Q,{options:t(E),value:a.row.businessType},null,8,["options","value"])]),_:1}),e(_,{label:"操作人员",align:"center",width:"110",prop:"operName","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]}),e(_,{label:"部门",align:"center",prop:"deptName",width:"130","show-overflow-tooltip":!0}),e(_,{label:"操作地址",align:"center",prop:"operIp",width:"130","show-overflow-tooltip":!0}),e(_,{label:"操作状态",align:"center",prop:"status"},{default:l(a=>[e(Q,{options:t($),value:a.row.status},null,8,["options","value"])]),_:1}),e(_,{label:"操作日期",align:"center",prop:"operTime",width:"180",sortable:"custom","sort-orders":["descending","ascending"]},{default:l(a=>[D("span",null,p(i.parseTime(a.row.operTime)),1)]),_:1}),e(_,{label:"消耗时间",align:"center",prop:"costTime",width:"110","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]},{default:l(a=>[D("span",null,p(a.row.costTime)+"毫秒",1)]),_:1}),e(_,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(a=>[e(_e,{content:"详细",placement:"top"},{default:l(()=>[b(e(v,{link:"",type:"primary",icon:"View",onClick:Xe=>ie(a.row)},null,8,["onClick"]),[[S,["monitor:operlog:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data","default-sort"])),[[be,t(I)]]),b(e(ge,{page:t(s).pageNum,"onUpdate:page":o[8]||(o[8]=a=>t(s).pageNum=a),limit:t(s).pageSize,"onUpdate:limit":o[9]||(o[9]=a=>t(s).pageSize=a),total:t(R),onPagination:g},null,8,["page","limit","total"]),[[ee,t(R)>0]])]),_:1}),e(ve,{modelValue:t(k).visible,"onUpdate:modelValue":o[11]||(o[11]=a=>t(k).visible=a),title:"操作日志详细",width:"700px","append-to-body":""},{footer:l(()=>[D("div",We,[e(v,{onClick:o[10]||(o[10]=a=>t(k).visible=!1)},{default:l(()=>[d("关 闭")]),_:1})])]),default:l(()=>[e(K,{model:t(r),"label-width":"100px"},{default:l(()=>[e(H,null,{default:l(()=>[e(m,{span:24},{default:l(()=>[e(u,{label:"登录信息："},{default:l(()=>[d(p(t(r).operName)+" / "+p(t(r).deptName)+" / "+p(t(r).operIp)+" / "+p(t(r).operLocation),1)]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(u,{label:"请求信息："},{default:l(()=>[d(p(t(r).requestMethod)+" "+p(t(r).operUrl),1)]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(u,{label:"操作模块："},{default:l(()=>[d(p(t(r).title)+" / "+p(oe(t(r))),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(u,{label:"操作方法："},{default:l(()=>[d(p(t(r).method),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(u,{label:"请求参数："},{default:l(()=>[d(p(t(r).operParam),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(u,{label:"返回参数："},{default:l(()=>[d(p(t(r).jsonResult),1)]),_:1})]),_:1}),e(m,{span:6},{default:l(()=>[e(u,{label:"操作状态："},{default:l(()=>[t(r).status===0?(c(),T("div",Qe,"正常")):t(r).status===1?(c(),T("div",je,"失败")):le("",!0)]),_:1})]),_:1}),e(m,{span:8},{default:l(()=>[e(u,{label:"消耗时间："},{default:l(()=>[d(p(t(r).costTime)+"毫秒",1)]),_:1})]),_:1}),e(m,{span:10},{default:l(()=>[e(u,{label:"操作时间："},{default:l(()=>[d(p(i.parseTime(t(r).operTime)),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[t(r).status===1?(c(),w(u,{key:0,label:"异常信息："},{default:l(()=>[d(p(t(r).errorMsg),1)]),_:1})):le("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{dl as default};
