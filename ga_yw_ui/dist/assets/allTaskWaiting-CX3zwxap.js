import{d as we,r as i,V as be,aa as ye,b as ke,o as c,c as R,x as C,k as e,m as a,e as l,a3 as F,y as u,w as N,t as z,a7 as A,ab as he,p as m,T as v,aL as Ve,M as j,N as Z,q as D,Y as Ce,a1 as Ne,a2 as De,a0 as Ee,D as Se,C as Ie,G as Ke,H as Re,W as Le,X as Te,a8 as Ue,ak as Be,a9 as $e,am as Fe,v as ze}from"./index-BoCONcAc.js";import{_ as Ae}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as Pe}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as Me}from"./index-B4NenLWv.js";/* empty css               *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                *//* empty css                       *//* empty css                        */import{k as We,l as xe,u as qe,m as Ye}from"./index-DSKxzbdu.js";import{_ as Qe}from"./multiInstanceUser.vue_vue_type_script_setup_true_name_User_lang-kSMcaROF.js";import{_ as Ge}from"./index.vue_vue_type_script_setup_true_lang-Bfb_m_-c.js";import{w as Je}from"./index-BWlz0r_B.js";/* empty css                */import"./index-JZ_QvNlG.js";const Oe={class:"p-2"},Xe={class:"mb-[10px]"},He={class:"mb-[10px]"},je={class:"clearfix"},ya=we({__name:"allTaskWaiting",setup(Ze){const b=i(),P=i(),M=i(),{proxy:r}=be(),{wf_business_status:ee}=ye(r==null?void 0:r.useDict("wf_business_status")),w=i(!0),W=i([]),ae=i(!0),x=i(!0),y=i(!0),E=i(0),S=i([]),L=i(""),I=i(!1),T=i(!0),q=i({key:"",value:""}),Y=i(),s=i({pageNum:1,pageSize:10,name:void 0,processDefinitionName:void 0,processDefinitionKey:void 0}),d=i("waiting"),te=n=>{b.value&&(L.value="加签人员",b.value.getAddMultiInstanceList(n.id,[]))},le=n=>{b.value&&(L.value="减签人员",b.value.getDeleteMultiInstanceList(n.id))},_=()=>{d.value==="waiting"?U():Q()},ne=()=>{var n;(n=M.value)==null||n.resetFields(),s.value.pageNum=1,s.value.pageSize=10,_()},oe=n=>{W.value=n.map(o=>o.id),ae.value=n.length!==1,x.value=!n.length},ie=async n=>{S.value=[],s.value.pageNum=1,n==="waiting"?U():Q()},U=()=>{w.value=!0,We(s.value).then(n=>{S.value=n.rows,E.value=n.total,w.value=!1})},Q=()=>{w.value=!0,xe(s.value).then(n=>{S.value=n.rows,E.value=n.total,w.value=!1})},se=()=>{P.value.open()},ue=async n=>{n&&n.length>0?(await(r==null?void 0:r.$modal.confirm("是否确认提交？")),w.value=!0,await qe(W.value,n[0].userId),_(),r==null||r.$modal.msgSuccess("操作成功")):r==null||r.$modal.msgWarning("请选择用户！")},re=async n=>{T.value=!0,I.value=!0,Y.value=n.processDefinitionName;let o=await Ye(n.id);q.value=o.data,T.value=!1},ce=n=>{const o=Ce({wfDefinitionConfigVo:n.wfDefinitionConfigVo,wfNodeConfigVo:n.wfNodeConfigVo,businessKey:n.businessKey,taskId:n.id,type:"view"});Je.routerJump(o,r)};return ke(()=>{U()}),(n,o)=>{var X,H;const G=Ne,de=De,K=Ee,B=Se,k=Ie,f=Ke,J=Re,h=Le,me=Me,$=Te,p=Ue,V=Be,pe=Pe,_e=$e,fe=Ae,ge=Fe,O=ze;return c(),R("div",Oe,[C("div",Xe,[e(K,{shadow:"hover",class:"text-center"},{default:a(()=>[e(de,{modelValue:l(d),"onUpdate:modelValue":o[0]||(o[0]=t=>F(d)?d.value=t:null),onChange:o[1]||(o[1]=t=>ie(l(d)))},{default:a(()=>[e(G,{value:"waiting"},{default:a(()=>[u("待办任务")]),_:1}),e(G,{value:"finish"},{default:a(()=>[u("已办任务")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),e(he,{"enter-active-class":(X=l(r))==null?void 0:X.animate.searchAnimate.enter,"leave-active-class":(H=l(r))==null?void 0:H.animate.searchAnimate.leave},{default:a(()=>[N(C("div",He,[e(K,{shadow:"hover"},{default:a(()=>[N(e(J,{ref_key:"queryFormRef",ref:M,model:l(s),inline:!0},{default:a(()=>[e(k,{label:"任务名称",prop:"name"},{default:a(()=>[e(B,{modelValue:l(s).name,"onUpdate:modelValue":o[2]||(o[2]=t=>l(s).name=t),placeholder:"请输入任务名称",onKeyup:z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(k,{label:"流程定义名称","label-width":"100",prop:"processDefinitionName"},{default:a(()=>[e(B,{modelValue:l(s).processDefinitionName,"onUpdate:modelValue":o[3]||(o[3]=t=>l(s).processDefinitionName=t),placeholder:"请输入流程定义名称",onKeyup:z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(k,{label:"流程定义KEY","label-width":"100",prop:"processDefinitionKey"},{default:a(()=>[e(B,{modelValue:l(s).processDefinitionKey,"onUpdate:modelValue":o[4]||(o[4]=t=>l(s).processDefinitionKey=t),placeholder:"请输入流程定义KEY",onKeyup:z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(k,null,{default:a(()=>[e(f,{type:"primary",icon:"Search",onClick:_},{default:a(()=>[u("搜索")]),_:1}),e(f,{icon:"Refresh",onClick:ne},{default:a(()=>[u("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[A,l(y)]])]),_:1})],512),[[A,l(y)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(K,{shadow:"hover"},{header:a(()=>[e($,{gutter:10,class:"mb8"},{default:a(()=>[e(h,{span:1.5},{default:a(()=>[e(f,{type:"primary",plain:"",icon:"Edit",disabled:l(x),onClick:se},{default:a(()=>[u("修改办理人")]),_:1},8,["disabled"])]),_:1}),e(me,{showSearch:l(y),"onUpdate:showSearch":o[5]||(o[5]=t=>F(y)?y.value=t:null),onQueryTable:_},null,8,["showSearch"])]),_:1})]),default:a(()=>[N((c(),m(_e,{border:"",data:l(S),onSelectionChange:oe},{default:a(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{align:"center",type:"index",label:"序号",width:"60"}),e(p,{"show-overflow-tooltip":!0,align:"center",label:"流程定义名称"},{default:a(t=>[C("span",null,v(t.row.processDefinitionName)+"v"+v(t.row.processDefinitionVersion)+".0",1)]),_:1}),e(p,{align:"center",prop:"processDefinitionKey",label:"流程定义KEY"}),e(p,{align:"center",prop:"name",label:"任务名称"}),e(p,{align:"center",prop:"assigneeName",label:"办理人"},Ve({_:2},[l(d)==="waiting"?{name:"default",fn:a(t=>[t.row.participantVo&&t.row.assignee===null?(c(!0),R(j,{key:0},Z(t.row.participantVo.candidateName,(g,ve)=>(c(),m(V,{key:ve,type:"success"},{default:a(()=>[u(v(g),1)]),_:2},1024))),128)):(c(),m(V,{key:1,type:"success"},{default:a(()=>[u(v(t.row.assigneeName||"无"),1)]),_:2},1024))]),key:"0"}:l(d)==="finish"?{name:"default",fn:a(t=>[e(V,{type:"success"},{default:a(()=>[u(v(t.row.assigneeName||"无"),1)]),_:2},1024)]),key:"1"}:void 0]),1024),e(p,{align:"center",label:"流程状态","min-width":"70"},{default:a(t=>[l(d)==="waiting"?(c(),m(pe,{key:0,options:l(ee),value:t.row.businessStatus},null,8,["options","value"])):(c(),m(V,{key:1,type:"success"},{default:a(()=>[u("已完成")]),_:1}))]),_:1}),l(d)==="waiting"?(c(),m(p,{key:0,align:"center",prop:"createTime",label:"创建时间",width:"160"})):D("",!0),l(d)==="finish"?(c(),m(p,{key:1,align:"center",prop:"startTime",label:"创建时间",width:"160"})):D("",!0),e(p,{label:"操作",align:"center",width:l(d)==="finish"?"80":"151"},{default:a(t=>[e($,{gutter:10,class:"mb8"},{default:a(()=>[e(h,{span:1.5},{default:a(()=>[e(f,{link:"",type:"primary",size:"small",icon:"View",onClick:g=>ce(t.row)},{default:a(()=>[u("查看")]),_:2},1032,["onClick"])]),_:2},1024),l(d)==="waiting"?(c(),m(h,{key:0,span:1.5},{default:a(()=>[e(f,{link:"",type:"primary",size:"small",icon:"Document",onClick:g=>re(t.row)},{default:a(()=>[u("流程变量")]),_:2},1032,["onClick"])]),_:2},1024)):D("",!0)]),_:2},1024),t.row.multiInstance?(c(),m($,{key:0,gutter:10,class:"mb8"},{default:a(()=>[e(h,{span:1.5},{default:a(()=>[e(f,{link:"",type:"primary",size:"small",icon:"Remove",onClick:g=>le(t.row)},{default:a(()=>[u("减签")]),_:2},1032,["onClick"])]),_:2},1024),e(h,{span:1.5},{default:a(()=>[e(f,{link:"",type:"primary",size:"small",icon:"CirclePlus",onClick:g=>te(t.row)},{default:a(()=>[u("加签")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):D("",!0)]),_:1},8,["width"])]),_:1},8,["data"])),[[O,l(w)]]),N(e(fe,{page:l(s).pageNum,"onUpdate:page":o[6]||(o[6]=t=>l(s).pageNum=t),limit:l(s).pageSize,"onUpdate:limit":o[7]||(o[7]=t=>l(s).pageSize=t),total:l(E),onPagination:_},null,8,["page","limit","total"]),[[A,l(E)>0]])]),_:1}),e(Qe,{ref_key:"multiInstanceUserRef",ref:b,title:l(L),onSubmitCallback:_},null,8,["title"]),e(l(Ge),{ref_key:"userSelectRef",ref:P,multiple:!1,onConfirmCallBack:ue},null,512),e(ge,{modelValue:l(I),"onUpdate:modelValue":o[8]||(o[8]=t=>F(I)?I.value=t:null),draggable:"",title:"流程变量",width:"60%","close-on-click-modal":!1},{default:a(()=>[N((c(),m(K,{class:"box-card"},{header:a(()=>[C("div",je,[C("span",null,[u("流程定义名称："),e(V,null,{default:a(()=>[u(v(l(Y)),1)]),_:1})])])]),default:a(()=>[(c(!0),R(j,null,Z(l(q),(t,g)=>(c(),R("div",{key:g},[t.key!=="_FLOWABLE_SKIP_EXPRESSION_ENABLED"?(c(),m(J,{key:0,"label-position":"right","label-width":"150px"},{default:a(()=>[e(k,{label:t.key+"："},{default:a(()=>[u(v(t.value),1)]),_:2},1032,["label"])]),_:2},1024)):D("",!0)]))),128))]),_:1})),[[O,l(T)]])]),_:1},8,["modelValue"])])}}});export{ya as default};
