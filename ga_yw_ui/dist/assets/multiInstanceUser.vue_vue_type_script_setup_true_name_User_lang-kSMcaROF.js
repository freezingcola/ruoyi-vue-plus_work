import{d as Z,V as we,r as i,aC as P,a9 as M,aK as ke,o as y,p as U,m as s,x as D,k as t,y as E,e as l,c as F,a3 as A,ab as Ie,w as L,t as j,a7 as G,T as H,M as ye,N as be,q as W,D as Ne,a0 as Se,W as Ce,C as Ee,G as Te,H as xe,X as Ve,a8 as Re,ak as Ue,am as Le,v as Be}from"./index-BoCONcAc.js";import{_ as Me}from"./index-B1KNwlHH.js";/* empty css                        *//* empty css                    *//* empty css               */import{_ as De}from"./index-B4NenLWv.js";/* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css               *//* empty css                */import{l as X,o as J,f as Fe}from"./index-JZ_QvNlG.js";import{f as Y,h as Ae,i as Ke,j as $e}from"./index-DSKxzbdu.js";const qe={key:0,class:"p-2"},ze={class:"search"},Qe={key:1,class:"p-2"},Oe={class:"dialog-footer"},Pe=Z({name:"User"}),sa=Z({...Pe,props:{width:{type:String,default:"70%"},height:{type:String,default:"100%"},title:{type:String,default:"加签人员"},multiple:{type:Boolean,default:!0},userIdList:{type:Array,default:[]}},emits:["submitCallback"],setup(T,{expose:ee,emit:ae}){const{proxy:_}=we(),te=T,B=i(P),f=i(M),w=i(),K=i(),p=i(!0),x=i(!0),k=i(),g=i(!1),V=i(0),R=i(""),b=i([]),r=i(i()),v=i([]),C=i(""),n=i({pageNum:1,pageSize:10,userName:"",nickName:"",taskId:""}),$=async(a,e)=>{b.value=[],re(),C.value="add",v.value=e,g.value=!0,n.value.taskId=a,p.value=!0;const o=await Y(a);n.value.excludeUserIds=o.data;const u=await X(n.value);if(p.value=!1,w.value=u.rows,V.value=u.total,w.value&&v.value.length>0){const c=await J(v.value);c.data&&c.data.length>0&&(r.value=c.data,c.data.forEach(m=>{f.value.toggleRowSelection(w.value.find(S=>S.userId==m.userId),!0)}))}},le=async()=>{p.value=!0;const a=await Y(n.value.taskId);n.value.excludeUserIds=a.data;const e=await X(n.value);if(p.value=!1,w.value=e.rows,V.value=e.total,w.value&&v.value.length>0){const o=await J(v.value);o.data&&o.data.length>0&&(r.value=o.data,o.data.forEach(u=>{f.value.toggleRowSelection(w.value.find(c=>c.userId==u.userId),!0)}))}},ne=async a=>{b.value=[],p.value=!0,n.value.taskId=a,C.value="delete",g.value=!0;const e=await Ae(a);K.value=e.data,p.value=!1},N=()=>{n.value.pageNum=1,$(n.value.taskId,v.value)},se=()=>{n.value.pageNum=1,n.value.deptId=void 0,n.value.userName=void 0,n.value.nickName=void 0,B.value.setCurrentKey(null),N()},oe=a=>{if(te.multiple)r.value=a.filter((e,o,u)=>u.findIndex(c=>c.userId===e.userId)===o),a.forEach(e=>{r.value&&!r.value.includes(e)&&f.value.toggleRowSelection(e,void 0)}),v.value=r.value.map(e=>e.userId);else{if(r.value=a,a.length>1){let e=a.shift();f.value.toggleRowSelection(e,void 0)}a.length===0&&(r.value=[])}},ue=a=>{k.value=a},re=async()=>{const a=await Fe();b.value=a.data},ie=(a,e)=>a?e.label.indexOf(a)!==-1:!0;ke(()=>{g.value&&b.value&&b.value.length>0&&B.value.filter(R.value)},{flush:"post"});const de=a=>{n.value.deptId=a.id,le()},ce=(a,e)=>{f.value.selection&&f.value.selection.length>0&&f.value.selection.forEach((o,u)=>{a.userId===o.userId&&f.value.selection.splice(u,1)}),r.value&&r.value.length>0&&r.value.splice(e,1),f.value.toggleRowSelection(a,void 0),v.value&&v.value.length>0&&v.value.forEach((o,u)=>{o===a.userId&&v.value.splice(u,1)})},me=async()=>{if(C.value==="add"){if(r.value&&r.value.length>0){p.value=!0;let a=r.value.map(u=>u.userId),e=r.value.map(u=>u.nickName),o={taskId:n.value.taskId,assignees:a,assigneeNames:e};await Ke(o),q("submitCallback"),p.value=!1,_==null||_.$modal.msgSuccess("操作成功"),g.value=!1}}else if(k.value&&k.value.length>0){p.value=!0;let a=k.value.map(m=>m.id),e=k.value.map(m=>m.executionId),o=k.value.map(m=>m.assignee),u=k.value.map(m=>m.assigneeName),c={taskId:n.value.taskId,taskIds:a,executionIds:e,assigneeIds:o,assigneeNames:u};await $e(c),q("submitCallback"),p.value=!1,_==null||_.$modal.msgSuccess("操作成功"),g.value=!1}},q=ae;return ee({getAddMultiInstanceList:$,getDeleteMultiInstanceList:ne}),(a,e)=>{const o=Ne,u=Se,c=Ce,m=Ee,S=Te,pe=xe,ve=De,z=Ve,h=Re,fe=Me,ge=Ue,he=Le,Q=Be;return y(),U(he,{modelValue:l(g),"onUpdate:modelValue":e[7]||(e[7]=I=>A(g)?g.value=I:null),draggable:"",title:T.title,width:T.width,height:T.height,"append-to-body":"","close-on-click-modal":!1},{footer:s(()=>[D("div",Oe,[t(S,{type:"primary",onClick:me},{default:s(()=>[E("确 定")]),_:1}),t(S,{onClick:e[6]||(e[6]=I=>g.value=!1)},{default:s(()=>[E("取 消")]),_:1})])]),default:s(()=>[l(C)==="add"?(y(),F("div",qe,[t(z,{gutter:20},{default:s(()=>[t(c,{lg:4,xs:24,style:{}},{default:s(()=>[t(u,{shadow:"hover"},{default:s(()=>[t(o,{modelValue:l(R),"onUpdate:modelValue":e[0]||(e[0]=I=>A(R)?R.value=I:null),placeholder:"请输入部门名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),t(l(P),{class:"mt-2",ref_key:"deptTreeRef",ref:B,"node-key":"id",data:l(b),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":ie,"highlight-current":"","default-expand-all":"",onNodeClick:de},null,8,["data"])]),_:1})]),_:1}),t(c,{lg:20,xs:24},{default:s(()=>{var I,O;return[t(Ie,{"enter-active-class":(I=l(_))==null?void 0:I.animate.searchAnimate.enter,"leave-active-class":(O=l(_))==null?void 0:O.animate.searchAnimate.leave},{default:s(()=>[L(D("div",ze,[t(pe,{ref:"queryFormRef",model:l(n),inline:!0},{default:s(()=>[t(m,{label:"用户名称",prop:"userName"},{default:s(()=>[t(o,{modelValue:l(n).userName,"onUpdate:modelValue":e[1]||(e[1]=d=>l(n).userName=d),placeholder:"请输入用户名称",clearable:"",onKeyup:j(N,["enter"])},null,8,["modelValue"])]),_:1}),t(m,{label:"手机号码",prop:"phonenumber"},{default:s(()=>[t(o,{modelValue:l(n).phonenumber,"onUpdate:modelValue":e[2]||(e[2]=d=>l(n).phonenumber=d),placeholder:"请输入手机号码",clearable:"",onKeyup:j(N,["enter"])},null,8,["modelValue"])]),_:1}),t(m,null,{default:s(()=>[t(S,{type:"primary",onClick:N,icon:"Search"},{default:s(()=>[E("搜索")]),_:1}),t(S,{onClick:se,icon:"Refresh"},{default:s(()=>[E("重置")]),_:1})]),_:1})]),_:1},8,["model"])],512),[[G,l(x)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(u,{shadow:"hover"},{header:s(()=>[t(z,{gutter:10},{default:s(()=>[t(ve,{showSearch:l(x),"onUpdate:showSearch":e[3]||(e[3]=d=>A(x)?x.value=d:null),onQueryTable:N,search:!0},null,8,["showSearch"])]),_:1})]),default:s(()=>[L((y(),U(l(M),{data:l(w),ref_key:"multipleTableRef",ref:f,"row-key":"userId",onSelectionChange:oe},{default:s(()=>[t(h,{type:"selection",width:"50",align:"center"}),t(h,{label:"用户编号",align:"center",key:"userId",prop:"userId"}),t(h,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0}),t(h,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0}),t(h,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"}),t(h,{label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:s(d=>[D("span",null,H(d.row.createTime),1)]),_:1})]),_:1},8,["data"])),[[Q,l(p)]]),L(t(fe,{total:l(V),page:l(n).pageNum,"onUpdate:page":e[4]||(e[4]=d=>l(n).pageNum=d),limit:l(n).pageSize,"onUpdate:limit":e[5]||(e[5]=d=>l(n).pageSize=d),onPagination:N},null,8,["total","page","limit"]),[[G,l(V)>0]])]),_:1}),t(u,{shadow:"hover"},{default:s(()=>[(y(!0),F(ye,null,be(l(r),(d,_e)=>(y(),U(ge,{key:d.userId,style:{margin:"2px"},closable:"",onClose:je=>ce(d,_e)},{default:s(()=>[E(H(d.userName),1)]),_:2},1032,["onClose"]))),128))]),_:1})]}),_:1})]),_:1})])):W("",!0),l(C)==="delete"?(y(),F("div",Qe,[L((y(),U(l(M),{data:l(K),onSelectionChange:ue},{default:s(()=>[t(h,{type:"selection",width:"55"}),t(h,{prop:"name",label:"任务名称"}),t(h,{prop:"assigneeName",label:"办理人"})]),_:1},8,["data"])),[[Q,l(p)]])])):W("",!0)]),_:1},8,["modelValue","title","width","height"])}}});export{sa as _};
