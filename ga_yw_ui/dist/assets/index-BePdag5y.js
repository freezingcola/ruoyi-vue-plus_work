import{d as B,V as oe,aa as N,r as d,Y as ie,b as re,$ as ce,o as m,c as ue,k as t,m as l,w as p,x as D,e as s,t as q,y as r,a7 as z,ab as de,p as g,a3 as me,q as k,T as S,D as pe,C as _e,G as ve,H as fe,W as ge,X as ye,a8 as we,ak as be,a9 as he,a0 as ke,v as Ce}from"./index-BoCONcAc.js";/* empty css                */import{_ as De}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as Se}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as Ve}from"./index-B4NenLWv.js";/* empty css               *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{l as $e,d as Ee}from"./index-B85zt68h.js";import{c as Le}from"./index-LhLwlHgt.js";/* empty css                */const Ie={class:"p-2"},Pe={class:"search"},Te=B({name:"Leave"}),Ye=B({...Te,setup(Ne){const{proxy:e}=oe(),{wf_business_status:R}=N(e==null?void 0:e.useDict("wf_business_status")),V=d([]),_=d(!0),y=d(!0),$=d([]),U=d(!0),A=d(!0),C=d(0),F=[{value:"1",label:"事假"},{value:"2",label:"调休"},{value:"3",label:"病假"},{value:"4",label:"婚假"}],E=d(),K=ie({form:{},queryParams:{pageNum:1,pageSize:10,startLeaveDays:void 0,endLeaveDays:void 0},rules:{}}),{queryParams:i}=N(K),v=async()=>{_.value=!0;const n=await $e(i.value);V.value=n.rows,C.value=n.total,_.value=!1},w=()=>{i.value.pageNum=1,v()},Q=()=>{var n;(n=E.value)==null||n.resetFields(),w()},x=n=>{$.value=n.map(o=>o.id),U.value=n.length!=1,A.value=!n.length},G=()=>{e.$tab.closePage(e.$route),e.$router.push("/demo/leaveEdit/index/add/add"),e.$router.push({path:"/demo/leaveEdit/index",query:{type:"add"}})},H=n=>{e.$tab.closePage(e.$route),e.$router.push({path:"/demo/leaveEdit/index",query:{id:n.id,type:"update"}})},M=n=>{e.$tab.closePage(e.$route),e.$router.push({path:"/demo/leaveEdit/index",query:{id:n.id,type:"view"}})},W=async n=>{const o=(n==null?void 0:n.id)||$.value;await(e==null?void 0:e.$modal.confirm('是否确认删除请假编号为"'+o+'"的数据项？').finally(()=>_.value=!1)),await Ee(o),e==null||e.$modal.msgSuccess("删除成功"),await v()},X=()=>{e==null||e.download("demo/leave/export",{...i.value},`leave_${new Date().getTime()}.xlsx`)},Y=async n=>{await(e==null?void 0:e.$modal.confirm("是否确认撤销当前单据？")),_.value=!0,await Le(n).finally(()=>_.value=!1),await v(),e==null||e.$modal.msgSuccess("撤销成功")};return re(()=>{v()}),(n,o)=>{var P,T;const L=pe,b=_e,c=ve,j=fe,I=ge,J=Ve,O=ye,u=we,Z=be,ee=Se,ae=he,te=De,le=ke,h=ce("hasPermi"),ne=Ce;return m(),ue("div",Ie,[t(de,{"enter-active-class":(P=s(e))==null?void 0:P.animate.searchAnimate.enter,"leave-active-class":(T=s(e))==null?void 0:T.animate.searchAnimate.leave},{default:l(()=>[p(D("div",Pe,[t(j,{ref_key:"queryFormRef",ref:E,model:s(i),inline:!0},{default:l(()=>[t(b,{label:"请假天数",prop:"startLeaveDays"},{default:l(()=>[t(L,{modelValue:s(i).startLeaveDays,"onUpdate:modelValue":o[0]||(o[0]=a=>s(i).startLeaveDays=a),placeholder:"请输入请假天数",clearable:"",onKeyup:q(w,["enter"])},null,8,["modelValue"])]),_:1}),t(b,{prop:"endLeaveDays"},{default:l(()=>[r(" 至 ")]),_:1}),t(b,{prop:"endLeaveDays"},{default:l(()=>[t(L,{modelValue:s(i).endLeaveDays,"onUpdate:modelValue":o[1]||(o[1]=a=>s(i).endLeaveDays=a),placeholder:"请输入请假天数",clearable:"",onKeyup:q(w,["enter"])},null,8,["modelValue"])]),_:1}),t(b,null,{default:l(()=>[t(c,{type:"primary",icon:"Search",onClick:w},{default:l(()=>[r("搜索")]),_:1}),t(c,{icon:"Refresh",onClick:Q},{default:l(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"])],512),[[z,s(y)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(le,{shadow:"never"},{header:l(()=>[t(O,{gutter:10,class:"mb8"},{default:l(()=>[t(I,{span:1.5},{default:l(()=>[p((m(),g(c,{type:"primary",plain:"",icon:"Plus",onClick:G},{default:l(()=>[r("新增")]),_:1})),[[h,["demo:leave:add"]]])]),_:1}),t(I,{span:1.5},{default:l(()=>[p((m(),g(c,{type:"warning",plain:"",icon:"Download",onClick:X},{default:l(()=>[r("导出")]),_:1})),[[h,["demo:leave:export"]]])]),_:1}),t(J,{showSearch:s(y),"onUpdate:showSearch":o[2]||(o[2]=a=>me(y)?y.value=a:null),onQueryTable:v},null,8,["showSearch"])]),_:1})]),default:l(()=>[p((m(),g(ae,{data:s(V),onSelectionChange:x},{default:l(()=>[t(u,{type:"selection",width:"55",align:"center"}),k("",!0),t(u,{label:"请假类型",align:"center"},{default:l(a=>[t(Z,null,{default:l(()=>{var f;return[r(S((f=F.find(se=>se.value===a.row.leaveType))==null?void 0:f.label),1)]}),_:2},1024)]),_:1}),t(u,{label:"开始时间",align:"center",prop:"startDate"},{default:l(a=>[D("span",null,S(n.parseTime(a.row.startDate,"{y}-{m}-{d}")),1)]),_:1}),t(u,{label:"结束时间",align:"center",prop:"endDate"},{default:l(a=>[D("span",null,S(n.parseTime(a.row.endDate,"{y}-{m}-{d}")),1)]),_:1}),t(u,{label:"请假天数",align:"center",prop:"leaveDays"}),t(u,{label:"请假原因",align:"center",prop:"remark"}),t(u,{align:"center",label:"流程状态","min-width":"70"},{default:l(a=>[t(ee,{options:s(R),value:a.row.processInstanceVo.businessStatus},null,8,["options","value"])]),_:1}),t(u,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(a=>[a.row.processInstanceVo.businessStatus==="draft"||a.row.processInstanceVo.businessStatus==="cancel"||a.row.processInstanceVo.businessStatus==="back"?p((m(),g(c,{key:0,size:"small",link:"",type:"primary",icon:"Edit",onClick:f=>H(a.row)},{default:l(()=>[r("修改")]),_:2},1032,["onClick"])),[[h,["demo:leave:edit"]]]):k("",!0),a.row.processInstanceVo.businessStatus==="draft"||a.row.processInstanceVo.businessStatus==="cancel"||a.row.processInstanceVo.businessStatus==="back"?p((m(),g(c,{key:1,size:"small",link:"",type:"primary",icon:"Delete",onClick:f=>W(a.row)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])),[[h,["demo:leave:remove"]]]):k("",!0),t(c,{link:"",type:"primary",size:"small",icon:"View",onClick:f=>M(a.row)},{default:l(()=>[r("查看")]),_:2},1032,["onClick"]),a.row.processInstanceVo.businessStatus==="waiting"?(m(),g(c,{key:2,link:"",size:"small",type:"primary",icon:"Notification",onClick:f=>Y(a.row.processInstanceVo.id)},{default:l(()=>[r("撤销")]),_:2},1032,["onClick"])):k("",!0)]),_:1})]),_:1},8,["data"])),[[ne,s(_)]]),p(t(te,{page:s(i).pageNum,"onUpdate:page":o[3]||(o[3]=a=>s(i).pageNum=a),limit:s(i).pageSize,"onUpdate:limit":o[4]||(o[4]=a=>s(i).pageSize=a),total:s(C),onPagination:v},null,8,["page","limit","total"]),[[z,s(C)>0]])]),_:1})])}}});export{Ye as default};
