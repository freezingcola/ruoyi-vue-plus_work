import{L as te,r as d,Y as ae,S as P,i as le,n as se,b as oe,j as ne,o as c,c as g,x as E,k as t,m as n,M as D,N as V,p as L,y as v,ad as R,w as re,T,q as ie,at as S,O as ce,P as de,as as ue,G as pe,a8 as me,ak as he,a9 as fe,am as ge,v as ve}from"./index-BoCONcAc.js";/* empty css                 *//* empty css                    *//* empty css                        *//* empty css                       */import{l as _e}from"./index-JZ_QvNlG.js";import{d as be}from"./index-DABdJVQF.js";import ke from"./process1-vpNVYsFf.js";import{l as ye}from"./index-BjZ9Zf1q.js";import"./index-Xwb6tvPf.js";/* empty css                *//* empty css                        *//* empty css                             */const we={components:{NewWorkProcess1:ke},setup(){let b=0;const r=e=>{const s=S(e).startOf("week"),i=S(e).endOf("week");return[s.format("YYYY-MM-DD"),i.format("YYYY-MM-DD")]},U=()=>{b=0,h.value=r(S()),y.value="thisWeek"},a=()=>{b=b+1,h.value=r(S().subtract(b,"week")),y.value="lastWeek"},q=()=>{b=b-1,h.value=r(S().subtract(b,"week")),y.value="nextWeek"},W=d([]),k=d("周报汇总"),x=d([]),h=d([]),u=d(""),o=d(""),y=d(""),w=d(""),Y=d([]),M=d(!1),B=d(""),l=d(""),f=ae({someProperty:""}),p={1:"未分配",2:"待接收",3:"处理中",4:"待审核",5:"已完成",6:"已完成（不通过）"},O=P(()=>{const e=new Set(W.value.map(s=>s.assignee));return Array.from(e)}),j=P(()=>W.value.filter(e=>{let s=!0;if(Array.isArray(h.value)&&h.value.length===2){const A=h.value[0],C=h.value[1];s=e.crTime>=A&&e.crTime<=C}const i=u.value?e.createname===u.value:!0,_=w.value?e.state===w.value:!0,m=o.value?e.project===o.value:!0;return s&&i&&_&&m})),G=P(()=>{const e={};return j.value.forEach(s=>{e[s.createname]||(e[s.createname]=[]),e[s.createname].push(s)}),e}),H=P(()=>{const e={};return j.value.forEach(s=>{e[s.project]||(e[s.project]=[]),e[s.project].push(s)}),e}),J=({row:e,column:s,rowIndex:i,columnIndex:_})=>{if(M.value&&_===0){debugger;const m=e.project;let A=1;console.log(j.value.length);for(let C=i+1;C<j.value.length;C++)j.value[C].project===m&&A++;return{rowspan:A,colspan:1}}return{rowspan:1,colspan:1}},K=e=>{switch(e){case"未分配":return"info";case"待接收":return"warning";case"处理中":return"primary";case"待审核":return"warning";case"已完成":return"success";case"已完成（不通过）":return"danger";default:return"info"}},N=d(!1),I=d(!1),z=d(null),Q=async()=>{try{N.value=!0;const e=await _e();e&&e.rows&&(Y.value=e.rows.map(s=>s.nickName))}catch(e){console.error("获取用户列表失败:",e)}},F=async(e,s,i)=>{try{N.value=!0;const _=await be(e,s,i);_&&_.data&&(W.value=_.data.map(m=>({project:m.projectName,assignee:m.contactPerson,createname:m.createName,description:m.workTitle,status:X(m.state),crTime:m.createTime,issues:"无",date:m.date||"2023-10",sblsh:m.number,workTime:m.workTime,state:m.state.toString()})))}catch(_){console.error("获取工作信息失败:",_)}},X=e=>p[e]||"未知状态",Z=()=>{M.value=!0;const e=u.value,s=h.value,i=w.value;F(e,s,i)},$=async()=>{const e=await ye(),s=[];e.rows.forEach(i=>{s.push(i.proName)}),x.value=s};le(j,async e=>{if(e.length>0){const s=h.value[0],i=h.value[1];B.value=s,l.value=i,!o.value&&!u.value?k.value="周报汇总（"+s+"--"+i+"）":u.value?k.value=e[0].createname+"个人工作周报（"+s+"--"+i+"）":k.value=o.value+"周报汇总（"+s+"--"+i+"）",await se(),setTimeout(()=>{N.value=!1},300)}});const ee=async e=>{try{N.value=!0,z.value=e,f.someProperty=e,I.value=!0}catch(s){console.error("获取任务详情失败:",s)}finally{N.value=!1}};return oe(()=>{$(),Q(),U(),F("",[],"")}),{selectedDate:h,selectThisWeek:U,selectLastWeek:a,selectNextWeek:q,selectedAssignee:u,selectedStatus:w,assignees:O,filteredTasks:j,handleSpanMethod:J,nickName:Y,filterTasks:Z,getStatusTagType:K,isLoading:N,statusMap:p,dialogVisible:I,selectedTask:z,handleRowClick:ee,yourProcessData:f,titleName:k,project:x,projectName:o,activeButton:y,groupedByAssignee:G,groupedByProject:H,startTime:B,endTime:l}}},Te={class:"filter-container"},je={style:{width:"70%",position:"absolute","margin-top":"-5%","margin-left":"35%"}},xe={"element-loading-text":"数据加载中，请稍后...","element-loading-spinner":"el-icon-loading"},Ne={key:0},Ce={style:{"text-align":"center"}},De={key:1},Ve={style:{"text-align":"center"}},Se={key:2};function We(b,r,U,a,q,W){const k=ce,x=de,h=ue,u=pe,o=me,y=he,w=fe,Y=ne("new-work-process1"),M=ge,B=ve;return c(),g("div",null,[E("div",Te,[t(x,{filterable:"",modelValue:a.projectName,"onUpdate:modelValue":r[0]||(r[0]=l=>a.projectName=l),placeholder:"选择项目",clearable:"",style:{"margin-right":"10px",width:"80%"}},{default:n(()=>[(c(!0),g(D,null,V(a.project,l=>(c(),L(k,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(x,{filterable:"",modelValue:a.selectedAssignee,"onUpdate:modelValue":r[1]||(r[1]=l=>a.selectedAssignee=l),placeholder:"选择处理人",clearable:"",style:{"margin-right":"10px",width:"30%"}},{default:n(()=>[(c(!0),g(D,null,V(a.nickName,l=>(c(),L(k,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(h,{modelValue:a.selectedDate,"onUpdate:modelValue":r[2]||(r[2]=l=>a.selectedDate=l),type:"daterange",placeholder:"选择月份",format:"YYYY年MM月-DD日","value-format":"YYYY-MM-DD",style:{"margin-right":"10px",width:"800px"}},null,8,["modelValue"]),E("div",je,[t(u,{class:R({"blue-button":this.activeButton==="lastWeek"}),onClick:a.selectLastWeek},{default:n(()=>[v(" 上周 ")]),_:1},8,["class","onClick"]),t(u,{class:R({"blue-button":this.activeButton==="thisWeek"}),onClick:a.selectThisWeek},{default:n(()=>[v(" 本周 ")]),_:1},8,["class","onClick"]),t(u,{class:R({"blue-button":this.activeButton==="nextWeek"}),onClick:a.selectNextWeek},{default:n(()=>[v(" 下周 ")]),_:1},8,["class","onClick"])]),t(x,{modelValue:a.selectedStatus,"onUpdate:modelValue":r[3]||(r[3]=l=>a.selectedStatus=l),placeholder:"选择状态",clearable:"",style:{"margin-right":"10px",width:"30%"}},{default:n(()=>[(c(!0),g(D,null,V(a.statusMap,(l,f)=>(c(),L(k,{key:f,label:l,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),re((c(),g("div",xe,[a.projectName&&!a.selectedAssignee?(c(),g("div",Ne,[(c(!0),g(D,null,V(a.groupedByAssignee,(l,f)=>(c(),g("div",{key:f},[E("h2",Ce,T(f+"（"+this.startTime+"--"+this.endTime+"）"),1),t(w,{data:l,style:{width:"95%","margin-left":"2%"},border:"","span-method":a.handleSpanMethod},{default:n(()=>[t(o,{prop:"project",label:"所属项目",width:"350"}),t(o,{prop:"createname",label:"处理人",width:"100"}),t(o,{prop:"sblsh",label:"流水号",width:"160"}),t(o,{prop:"assignee",label:"任务安排人/对接人",width:"150"}),t(o,{label:"具体工作内容"},{default:n(({row:p})=>[t(u,{type:"text",onClick:O=>a.handleRowClick(p.sblsh)},{default:n(()=>[v(T(p.description),1)]),_:2},1032,["onClick"])]),_:1}),t(o,{prop:"workTime",label:"工作时长",width:"150"}),t(o,{prop:"status",label:"完成情况",width:"120"},{default:n(({row:p})=>[t(y,{type:a.getStatusTagType(p.status)},{default:n(()=>[v(T(p.status),1)]),_:2},1032,["type"])]),_:1}),t(o,{prop:"crTime",label:"创建时间",width:"200"})]),_:2},1032,["data","span-method"])]))),128))])):a.selectedAssignee&&!a.projectName?(c(),g("div",De,[(c(!0),g(D,null,V(a.groupedByProject,(l,f)=>(c(),g("div",{key:f},[E("h2",Ve,T(f),1),t(w,{data:l,style:{width:"95%","margin-left":"2%"},border:"","span-method":a.handleSpanMethod},{default:n(()=>[t(o,{prop:"project",label:"所属项目",width:"350"}),t(o,{prop:"createname",label:"处理人",width:"100"}),t(o,{prop:"sblsh",label:"流水号",width:"160"}),t(o,{prop:"assignee",label:"任务安排人/对接人",width:"150"}),t(o,{label:"具体工作内容"},{default:n(({row:p})=>[t(u,{type:"text",onClick:O=>a.handleRowClick(p.sblsh)},{default:n(()=>[v(T(p.description),1)]),_:2},1032,["onClick"])]),_:1}),t(o,{prop:"workTime",label:"工作时长",width:"150"}),t(o,{prop:"status",label:"完成情况",width:"120"},{default:n(({row:p})=>[t(y,{type:a.getStatusTagType(p.status)},{default:n(()=>[v(T(p.status),1)]),_:2},1032,["type"])]),_:1}),t(o,{prop:"crTime",label:"创建时间",width:"200"})]),_:2},1032,["data","span-method"])]))),128))])):(c(),g("div",Se,[t(w,{data:a.filteredTasks,style:{width:"95%","margin-left":"2%"},border:"","span-method":a.handleSpanMethod},{default:n(()=>[t(o,{prop:"project",label:"所属项目",width:"350"}),t(o,{prop:"createname",label:"处理人",width:"100"}),t(o,{prop:"sblsh",label:"流水号",width:"160"}),t(o,{prop:"assignee",label:"任务安排人/对接人",width:"150"}),t(o,{label:"具体工作内容"},{default:n(({row:l})=>[t(u,{type:"text",onClick:f=>a.handleRowClick(l.sblsh)},{default:n(()=>[v(T(l.description),1)]),_:2},1032,["onClick"])]),_:1}),t(o,{prop:"workTime",label:"工作时长",width:"150"}),t(o,{prop:"status",label:"完成情况",width:"120"},{default:n(({row:l})=>[t(y,{type:a.getStatusTagType(l.status)},{default:n(()=>[v(T(l.status),1)]),_:2},1032,["type"])]),_:1}),t(o,{prop:"crTime",label:"创建时间",width:"200"})]),_:1},8,["data","span-method"])]))])),[[B,a.isLoading]]),t(M,{modelValue:a.dialogVisible,"onUpdate:modelValue":r[5]||(r[5]=l=>a.dialogVisible=l),title:"流程详情",width:"80%"},{footer:n(()=>[t(u,{onClick:r[4]||(r[4]=l=>a.dialogVisible=!1)},{default:n(()=>[v("关闭")]),_:1})]),default:n(()=>[a.dialogVisible?(c(),L(Y,{key:0,"process-data":a.yourProcessData},null,8,["process-data"])):ie("",!0)]),_:1},8,["modelValue"])])}const Fe=te(we,[["render",We],["__scopeId","data-v-f220d26f"]]);export{Fe as default};
