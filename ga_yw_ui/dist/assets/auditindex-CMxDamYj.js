import{d as fe,a as Qe,V as Me,aa as ie,r as c,h as ue,Y as S,b as Ge,$ as de,o as i,c as I,k as l,m as o,e as t,x as h,w,M as T,N,p as d,y as p,a7 as ce,ab as He,a3 as pe,T as me,q,aw as Je,O as Xe,P as Ye,C as Ke,G as Ze,H as el,a0 as ll,W as tl,X as al,a8 as ol,ac as nl,a9 as rl,D as sl,am as il,v as ul}from"./index-BoCONcAc.js";import{_ as dl}from"./index-DG7XexN9.js";import{_ as cl}from"./index.vue_vue_type_style_index_0_lang-Dyb-nOKR.js";import{_ as pl}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as ml}from"./index-Xwb6tvPf.js";import{_ as fl}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as _l}from"./index-B4NenLWv.js";/* empty css               *//* empty css                *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{A as vl,e as kl,f as wl,u as gl,h as bl,i as yl}from"./index-DABdJVQF.js";import{_ as hl}from"./selectUser.vue_vue_type_script_setup_true_name_SelectUser_lang-D3fIYqfe.js";import{_ as Vl}from"./finishWork.vue_vue_type_script_setup_true_name_InfoLog_lang-CzfZG0QT.js";import{_ as Cl}from"./workLog.vue_vue_type_script_setup_true_name_SelectUser_lang-D4fAoFFQ.js";import Il from"./process-k7O-Cf4R.js";/* empty css                *//* empty css                    *//* empty css                */import"./index-hgsK1_Ho.js";/* empty css                       *//* empty css                 */import"./index-hmiVVuGg.js";/* empty css                        *//* empty css                */const Tl=h("div",{style:{height:"0px"}},null,-1),Nl={class:"p-2"},Al={class:"mb-[10px]"},Ul=["onClick"],Sl={class:"dialog-footer"},$l={class:"dialog-footer"},jl=fe({name:"WorkInfo"}),ut=fe({...jl,setup(Dl){const L=Qe();console.log(L.currentRoute.value.query,"router");const{proxy:s}=Me(),{work_info_type:P,work_info_state:Q,test_xm:_e,test_fl:ve,test_dj:ke}=ie(s==null?void 0:s.useDict("work_info_type","work_info_state","test_xm","test_fl","test_dj")),M=c(),G=c(),F=c(),H=c([]),$=c(!1),A=c(!0),j=c(!0),D=c([]),J=c(!0),X=c(!0),W=c(0),Y=ue().userId,we=ue(),x=S({someProperty:""}),K=c(),O=c(),v=S({visible:!1,title:""}),g=S({}),Z={id:void 0,workTitle:void 0,workContent:void 0,state:void 0,workType:void 0,projectName:void 0,workLevel:void 0,classificationType:void 0,acceptAccount:void 0,acceptAccountName:void 0,attachs:void 0,attachIds:void 0},ge=S({form:{...Z},queryParams:{pageNum:1,pageSize:10,workTitle:void 0,workContent:void 0,state:void 0,workType:void 0,projectName:void 0,workLevel:void 0,classificationType:void 0,attachs:void 0,attachIds:void 0,acceptAccount:void 0,acceptAccountName:void 0,params:{}},rules:{workTitle:[{required:!0,message:"标题不能为空",trigger:"blur"}],workContent:[{required:!0,message:"内容不能为空",trigger:"blur"}],workType:[{required:!0,message:"类型不能为空",trigger:"change"}],workLevel:[{required:!0,message:"类型不能为空",trigger:"change"}],classificationType:[{required:!0,message:"类型不能为空",trigger:"change"}],projectName:[{required:!0,message:"项目名称不能为空",trigger:"change"}]}}),{queryParams:f,form:r,rules:be}=ie(ge),b=async()=>{A.value=!0,console.log(L.currentRoute.value.query,"router"),console.log("审批列表测试信息-----"+L.currentRoute.value.query.state);const n=await vl(f.value);H.value=n.rows,W.value=n.total,A.value=!1},ye=n=>{r.value.acceptAccount=n.userId,r.value.acceptAccountName=n.nickName},he=()=>{B(),v.visible=!1},V=c(!1),Ve=n=>{console.log(n.number),console.log(V.value),x.someProperty=n.number,console.log(x,1111),V.value=!0},B=()=>{var n;r.value={...Z},(n=O.value)==null||n.resetFields()},Ce=()=>{var n;(n=K.value)==null||n.resetFields(),E()},Ie=n=>{var a;(a=F.value)==null||a.show(),g.row=n,g.type="finishAudit",g.title="审核工作成果"},Te=n=>{var a;(a=F.value)==null||a.show(),g.row=n,g.type="finishWork",g.title="完成工单"},Ne=()=>{var n;(n=M.value)==null||n.show()},Ae=n=>{var a;(a=G.value)==null||a.show(n)},E=()=>{f.value.pageNum=1,b()},Ue=n=>{D.value=n.map(a=>a.id),J.value=n.length!=1,X.value=!n.length},Se=()=>{B(),v.visible=!0,v.title="添加工单管理"},$e=async n=>{const a=(n==null?void 0:n.id)||D.value;await(s==null?void 0:s.$modal.confirm('是否确认接收管理编号为"'+a+'"的工单？').finally(()=>A.value=!1)),await kl(a),s==null||s.$modal.msgSuccess("接收成功"),await b()},je=async n=>{B();const a=D.value[0],z=await wl(a);Object.assign(r.value,z.data);let k="";if(r.value.attachs){let m=JSON.parse(r.value.attachs),u=[];for(var y of m)u.push(y.id);k=u.join(","),r.value.attachIds=k}v.visible=!0,v.title="修改工单管理"},De=()=>{var n;(n=O.value)==null||n.validate(async a=>{a&&($.value=!0,r.value.id?await gl(r.value).finally(()=>$.value=!1):await bl(r.value).finally(()=>$.value=!1),s==null||s.$modal.msgSuccess("操作成功"),v.visible=!1,await b())})},ee=async n=>{const a=(n==null?void 0:n.id)||D.value;await(s==null?void 0:s.$modal.confirm('是否确认删除工单管理编号为"'+a+'"的数据项？').finally(()=>A.value=!1)),await yl(a),s==null||s.$modal.msgSuccess("删除成功"),await b()},Ee=()=>{s==null||s.download("workInfo/workInfo/export",{...f.value},`workInfo_${new Date().getTime()}.xlsx`)};return S({color:"rgba(0, 0, 0, .15)"}),Ge(()=>{b()}),(n,a)=>{var re,se;const z=Je,k=Xe,y=Ye,m=Ke,u=Ze,le=el,te=ll,R=tl,Re=_l,qe=al,_=ol,ae=fl,Le=ml,Pe=nl,Fe=rl,We=pl,oe=sl,xe=cl,Oe=dl,ne=il,U=de("hasPermi"),Be=de("hasRoles"),ze=ul;return i(),I(T,null,[l(z,{style:{position:"static"},content:[t(we).nickname]},{default:o(()=>[Tl]),_:1},8,["content"]),h("div",Nl,[l(He,{"enter-active-class":(re=t(s))==null?void 0:re.animate.searchAnimate.enter,"leave-active-class":(se=t(s))==null?void 0:se.animate.searchAnimate.leave},{default:o(()=>[w(h("div",Al,[l(te,{shadow:"hover"},{default:o(()=>[l(le,{ref_key:"queryFormRef",ref:K,model:t(f),inline:!0},{default:o(()=>[l(m,{label:"状态",prop:"state"},{default:o(()=>[l(y,{modelValue:t(f).state,"onUpdate:modelValue":a[0]||(a[0]=e=>t(f).state=e),placeholder:"请选择状态",clearable:""},{default:o(()=>[(i(!0),I(T,null,N(t(Q),e=>(i(),d(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"类型",prop:"workType"},{default:o(()=>[l(y,{modelValue:t(f).workType,"onUpdate:modelValue":a[1]||(a[1]=e=>t(f).workType=e),placeholder:"请选择类型",clearable:""},{default:o(()=>[(i(!0),I(T,null,N(t(P),e=>(i(),d(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:o(()=>[l(u,{type:"primary",icon:"Search",onClick:E},{default:o(()=>[p("搜索")]),_:1}),l(u,{icon:"Refresh",onClick:Ce},{default:o(()=>[p("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[ce,t(j)]])]),_:1},8,["enter-active-class","leave-active-class"]),l(te,{shadow:"never"},{header:o(()=>[l(qe,{gutter:10,class:"mb8"},{default:o(()=>[l(R,{span:1.5},{default:o(()=>[w((i(),d(u,{type:"primary",plain:"",icon:"Plus",onClick:Se},{default:o(()=>[p("新增")]),_:1})),[[U,["workInfo:workInfo:add"]]])]),_:1}),l(R,{span:1.5},{default:o(()=>[w((i(),d(u,{type:"success",plain:"",icon:"Edit",disabled:t(J),onClick:a[2]||(a[2]=e=>je())},{default:o(()=>[p("修改")]),_:1},8,["disabled"])),[[U,["workInfo:workInfo:edit"]]])]),_:1}),l(R,{span:1.5},{default:o(()=>[w((i(),d(u,{type:"danger",plain:"",icon:"Delete",disabled:t(X),onClick:a[3]||(a[3]=e=>ee())},{default:o(()=>[p("删除")]),_:1},8,["disabled"])),[[U,["workInfo:workInfo:remove"]]])]),_:1}),l(R,{span:1.5},{default:o(()=>[w((i(),d(u,{type:"warning",plain:"",icon:"Download",onClick:Ee},{default:o(()=>[p("导出")]),_:1})),[[U,["workInfo:workInfo:export"]]])]),_:1}),l(Re,{showSearch:t(j),"onUpdate:showSearch":a[4]||(a[4]=e=>pe(j)?j.value=e:null),onQueryTable:b},null,8,["showSearch"])]),_:1})]),default:o(()=>[w((i(),d(Fe,{data:t(H),onSelectionChange:Ue},{default:o(()=>[l(_,{type:"selection",width:"55",align:"center"}),l(_,{label:"流水号",align:"center",prop:"number",width:"150"},{default:o(e=>[h("span",{style:{color:"#009fff"},onClick:C=>Ve(e.row)},me(e.row.number),9,Ul)]),_:1}),l(_,{label:"标题",align:"center",prop:"workTitle"}),l(_,{label:"项目名称",align:"center",prop:"projectName"}),l(_,{label:"状态",align:"center",prop:"state"},{default:o(e=>[l(ae,{options:t(Q),value:e.row.state},null,8,["options","value"])]),_:1}),l(_,{label:"类型",align:"center",prop:"workType"},{default:o(e=>[l(ae,{options:t(P),value:e.row.workType},null,8,["options","value"])]),_:1}),l(_,{label:"创建人",align:"center",prop:"createByName"}),l(_,{label:"接收人",align:"center",prop:"acceptAccountName"}),l(_,{label:"附件",align:"center"},{default:o(e=>[l(Le,{modelValue:e.row.attachs,"onUpdate:modelValue":C=>e.row.attachs=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(_,{label:"创建时间",align:"center",prop:"createTime",width:"200"},{default:o(e=>[h("span",null,me(n.parseTime(e.row.createTime)),1)]),_:1}),l(_,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(e=>[l(Pe,{content:"删除",placement:"top"},{default:o(()=>[w(l(u,{link:"",type:"primary",icon:"Delete",onClick:C=>ee(e.row)},null,8,["onClick"]),[[U,["workInfo:workInfo:remove"]]])]),_:2},1024),e.row.acceptAccount==t(Y)&&e.row.state=="2"?(i(),d(u,{key:0,link:"",type:"text",class:"el-button--primary",onClick:C=>$e(e.row)},{default:o(()=>[p("接收")]),_:2},1032,["onClick"])):q("",!0),e.row.acceptAccount==t(Y)&&e.row.state=="3"?(i(),d(u,{key:1,link:"",type:"text",class:"el-button--primary",onClick:C=>Te(e.row)},{default:o(()=>[p("完成")]),_:2},1032,["onClick"])):q("",!0),e.row.state=="4"?w((i(),d(u,{key:2,link:"",type:"text",class:"el-button--primary",onClick:C=>Ie(e.row)},{default:o(()=>[p("审核")]),_:2},1032,["onClick"])),[[Be,["an_captain"]]]):q("",!0),l(u,{link:"",type:"text",class:"el-button--primary",onClick:C=>Ae(e.row)},{default:o(()=>[p("处理过程44")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ze,t(A)]]),w(l(We,{total:t(W),page:t(f).pageNum,"onUpdate:page":a[5]||(a[5]=e=>t(f).pageNum=e),limit:t(f).pageSize,"onUpdate:limit":a[6]||(a[6]=e=>t(f).pageSize=e),onPagination:b},null,8,["total","page","limit"]),[[ce,t(W)>0]])]),_:1}),l(ne,{title:t(v).title,modelValue:t(v).visible,"onUpdate:modelValue":a[15]||(a[15]=e=>t(v).visible=e),width:"auto","append-to-body":""},{footer:o(()=>[h("div",Sl,[l(u,{loading:t($),type:"primary",onClick:De},{default:o(()=>[p("确 定")]),_:1},8,["loading"]),l(u,{onClick:he},{default:o(()=>[p("取 消")]),_:1})])]),default:o(()=>[l(m,{label:"标题",prop:"workTitle"},{default:o(()=>[l(oe,{modelValue:t(r).workTitle,"onUpdate:modelValue":a[7]||(a[7]=e=>t(r).workTitle=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(le,{ref_key:"workInfoFormRef",ref:O,model:t(r),rules:t(be),"label-width":"80px"},{default:o(()=>[l(m,{label:"项目名称",prop:"projectName"},{default:o(()=>[l(y,{modelValue:t(r).projectName,"onUpdate:modelValue":a[8]||(a[8]=e=>t(r).projectName=e),placeholder:"请选择项目名称"},{default:o(()=>[(i(!0),I(T,null,N(t(_e),e=>(i(),d(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"分类",prop:"classificationType"},{default:o(()=>[l(y,{modelValue:t(r).classificationType,"onUpdate:modelValue":a[9]||(a[9]=e=>t(r).classificationType=e),placeholder:"请选择工单分类"},{default:o(()=>[(i(!0),I(T,null,N(t(ve),e=>(i(),d(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"类型",prop:"workType"},{default:o(()=>[l(y,{modelValue:t(r).workType,"onUpdate:modelValue":a[10]||(a[10]=e=>t(r).workType=e),placeholder:"请选择工单类型"},{default:o(()=>[(i(!0),I(T,null,N(t(P),e=>(i(),d(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"等级",prop:"workLevel"},{default:o(()=>[l(y,{modelValue:t(r).workLevel,"onUpdate:modelValue":a[11]||(a[11]=e=>t(r).workLevel=e),placeholder:"请选择工单等级"},{default:o(()=>[(i(!0),I(T,null,N(t(ke),e=>(i(),d(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"内容"},{default:o(()=>[l(xe,{modelValue:t(r).workContent,"onUpdate:modelValue":a[12]||(a[12]=e=>t(r).workContent=e),"min-height":192},null,8,["modelValue"])]),_:1}),l(m,{label:"附件",prop:"attachIds"},{default:o(()=>[l(Oe,{modelValue:t(r).attachIds,"onUpdate:modelValue":a[13]||(a[13]=e=>t(r).attachIds=e)},null,8,["modelValue"])]),_:1}),l(m,{label:"接收人"},{default:o(()=>[l(oe,{modelValue:t(r).acceptAccountName,"onUpdate:modelValue":a[14]||(a[14]=e=>t(r).acceptAccountName=e),placeholder:"",style:{width:"120px"},readonly:!0,disabled:!0},null,8,["modelValue"]),l(u,{type:"primary",plain:"",icon:"Plus",onClick:Ne},{default:o(()=>[p("请选择接收人")]),_:1})]),_:1})]),_:1},8,["model","rules"]),l(hl,{ref_key:"selectRef",ref:M,"parent-form":t(r),onOk:E,onSetAcceptAccount:ye},null,8,["parent-form"])]),_:1},8,["title","modelValue"]),l(Vl,{ref_key:"finishWork",ref:F,"data-object":t(g),onOk:E,onFreshList:b},null,8,["data-object"]),l(Cl,{ref_key:"workLog",ref:G,"data-object":t(g)},null,8,["data-object"]),l(ne,{modelValue:t(V),"onUpdate:modelValue":a[17]||(a[17]=e=>pe(V)?V.value=e:null),title:"流程跟踪",width:"80%"},{footer:o(()=>[h("div",$l,[l(u,{type:"primary",onClick:a[16]||(a[16]=e=>V.value=!1)},{default:o(()=>[p(" 关闭 ")]),_:1})])]),default:o(()=>[h("div",null,[t(V)?(i(),d(Il,{key:0,processData:t(x)},null,8,["processData"])):q("",!0)])]),_:1},8,["modelValue"])])],64)}}});export{ut as default};
