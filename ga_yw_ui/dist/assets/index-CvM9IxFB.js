import{d as _e,a as qe,V as xe,aa as me,r as i,h as pe,Y as P,b as Be,$ as Oe,o as s,c as C,k as t,m as l,e as n,x as y,w as h,M as D,N as U,p as f,y as m,a7 as fe,ab as ze,T as S,q as L,at as ve,aw as Qe,O as Ge,P as Je,C as Xe,D as Ke,G as Ze,H as et,a0 as tt,W as lt,X as at,a8 as ot,ac as nt,a9 as rt,ao as st,a2 as it,as as ut,am as dt,v as ct}from"./index-BoCONcAc.js";/* empty css                       *//* empty css                       *//* empty css                 */import{_ as mt}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as pt}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as ft}from"./index-B4NenLWv.js";/* empty css               *//* empty css                *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{l as vt,f as _t,u as wt,h as kt,i as bt}from"./index-DABdJVQF.js";import{_ as gt}from"./selectUser.vue_vue_type_script_setup_true_name_SelectUser_lang-Dq7ci3Pj.js";import{_ as yt}from"./finishWork.vue_vue_type_script_setup_true_name_InfoLog_lang-DQIgB1TV.js";import{_ as ht}from"./workLog.vue_vue_type_script_setup_true_name_SelectUser_lang-DhaQUP_R.js";import Vt from"./process1-vpNVYsFf.js";import{a as Tt,l as It}from"./index-BjZ9Zf1q.js";import{l as Ct}from"./index-JZ_QvNlG.js";/* empty css                */import"./index-hgsK1_Ho.js";import"./index-DG7XexN9.js";/* empty css                *//* empty css                    */import"./index.vue_vue_type_style_index_0_lang-Dyb-nOKR.js";import"./index-hmiVVuGg.js";import"./process1-CwB6Ars8.js";import"./index-Xwb6tvPf.js";/* empty css                        *//* empty css                             */const Dt=y("div",{style:{height:"0px"}},null,-1),Yt={class:"p-2"},At={class:"mb-[10px]"},Pt={class:"dialog-footer"},Ut={class:"dialog-footer"},Nt=_e({name:"WorkInfo"}),_l=_e({...Nt,setup(Et){const O=qe();console.log(O.currentRoute.value.query,"router");const{proxy:d}=xe(),{work_info_type:z,work_info_state:Q,test_xm:St,test_fl:Lt,test_dj:we}=me(d==null?void 0:d.useDict("work_info_type","work_info_state","test_xm","test_fl","test_dj")),G=i(),ke=i(),j=i();i(""),i("");const J=i([]),M=i(!1),V=i(!0),W=i(!0),$=i([]),X=i(!0),K=i(!0),R=i(0),Z=pe().userId,be=pe(),F=P({someProperty:""}),ee=i([]),H=i(i()),te=i(),q=i(),w=P({visible:!1,title:""}),k=P({}),le={id:void 0,workTitle:void 0,state:void 0,workLevel:void 0,classificationType:void 0,acceptAccount:void 0,acceptAccountName:void 0,attachs:void 0,attachIds:void 0,createBy:void 0,contactPerson:void 0},ge=P({form:{...le},queryParams:{pageNum:1,pageSize:10,workTitle:void 0,state:void 0,workLevel:void 0,classificationType:void 0,attachs:void 0,attachIds:void 0,acceptAccount:void 0,acceptAccountName:void 0,contactPerson:void 0,params:{}},rules:{workTitle:[{required:!0,message:"标题不能为空",trigger:"blur"}],workLevel:[{required:!0,message:"类型不能为空",trigger:"change"}]}}),{queryParams:u,form:r,rules:jt}=me(ge),b=async()=>{V.value=!0,console.log("事件列表查询信息-----"+O.currentRoute.value.query.state);const o=await vt(u.value);J.value=o.rows,R.value=o.total,V.value=!1},ye=async()=>{V.value=!0;const o=await Tt();o&&o.rows&&(ee.value=o.rows),console.log(o),V.value=!1},he=async()=>{V.value=!0;const o=await Ct();o&&o.rows&&(H.value=o.rows)},Ve=o=>{r.value.acceptAccount=o.userId,r.value.acceptAccountName=o.nickName},Te=()=>{x(),w.visible=!1},I=i(!1),Ie=o=>{console.log(o.number),console.log(I.value),F.someProperty=o.number,console.log(F,1111),I.value=!0},x=()=>{var o;r.value={...le},(o=q.value)==null||o.resetFields()},Ce=()=>{var o;(o=te.value)==null||o.resetFields(),N()},De=o=>{var a;(a=j.value)==null||a.show(),k.row=o,k.type="finishWork",k.title="完成工单"},Ye=()=>{var o;(o=G.value)==null||o.show()},N=()=>{u.value.pageNum=1,b()},Ae=o=>{$.value=o.map(a=>a.id),X.value=o.length!=1,K.value=!o.length},Pe=()=>{x(),w.visible=!0,w.title="添加工单管理",Ue(),b()},Ue=async()=>{const o=await It();ee.value=o.rows,console.log(o)},Ne=async o=>{var a;(a=j.value)==null||a.show(),k.row=o,k.type="receiveWork",k.title="接收工单",await b()},ae=async o=>{x();const a=(o==null?void 0:o.id)||$.value[0],Y=await _t(a);Object.assign(r.value,Y.data);let v="";if(r.value.attachs){let c=JSON.parse(r.value.attachs),T=[];for(var g of c)T.push(g.id);v=T.join(","),r.value.attachIds=v}w.visible=!0,w.title="修改工单管理"},Ee=()=>{var o;(o=q.value)==null||o.validate(async a=>{if(r.value.projectName="123",r.value.workContent="123",r.value.workType="1",a){M.value=!0;const Y=ve(r.value.startTime).format("YYYY-MM-DD HH:mm:ss"),v=ve(r.value.endTime).format("YYYY-MM-DD HH:mm:ss");try{r.value.startTime=Y,r.value.endTime=v,r.value.id?await wt(r.value):(await kt(r.value),k.type="receiveWork"),d==null||d.$modal.msgSuccess("操作成功"),w.visible=!1,await b()}catch(g){console.error("操作失败",g)}finally{M.value=!1}}})},Se=async o=>{const a=$.value;await(d==null?void 0:d.$modal.confirm('是否确认删除工单管理编号为"'+a+'"的数据项？').finally(()=>V.value=!1)),await bt(a),d==null||d.$modal.msgSuccess("删除成功"),await b()},Le=()=>{d==null||d.download("workInfo/workInfo/export",{...u.value},`workInfo_${new Date().getTime()}.xlsx`)};return P({color:"rgba(0, 0, 0, .15)"}),Be(()=>{ye(),he(),b()}),(o,a)=>{var de,ce;const Y=Qe,v=Ge,g=Je,c=Xe,T=Ke,p=Ze,oe=et,ne=tt,E=lt,je=ft,Me=at,_=ot,re=pt,We=nt,$e=rt,Re=mt,se=st,Fe=it,ie=ut,ue=dt,A=Oe("hasPermi"),He=ct;return s(),C(D,null,[t(Y,{style:{position:"static"},content:[n(be).nickname]},{default:l(()=>[Dt]),_:1},8,["content"]),y("div",Yt,[t(ze,{"enter-active-class":(de=n(d))==null?void 0:de.animate.searchAnimate.enter,"leave-active-class":(ce=n(d))==null?void 0:ce.animate.searchAnimate.leave},{default:l(()=>[h(y("div",At,[t(ne,{shadow:"hover"},{default:l(()=>[t(oe,{ref_key:"queryFormRef",ref:te,model:n(u),inline:!0},{default:l(()=>[t(c,{label:"创建人",prop:"createName"},{default:l(()=>[t(g,{filterable:"",modelValue:n(u).createBy,"onUpdate:modelValue":a[0]||(a[0]=e=>n(u).createBy=e),placeholder:"请选择创建人",clearable:""},{default:l(()=>[(s(!0),C(D,null,U(H.value,e=>(s(),f(v,{key:e.userId,label:e.nickName,value:e.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"接收人",prop:"acceptAccount"},{default:l(()=>[t(g,{filterable:"",modelValue:n(u).acceptAccount,"onUpdate:modelValue":a[1]||(a[1]=e=>n(u).acceptAccount=e),placeholder:"请选择接收人",clearable:""},{default:l(()=>[(s(!0),C(D,null,U(H.value,e=>(s(),f(v,{key:e.userId,label:e.nickName,value:e.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"状态",prop:"state"},{default:l(()=>[t(g,{modelValue:n(u).state,"onUpdate:modelValue":a[2]||(a[2]=e=>n(u).state=e),placeholder:"请选择状态",clearable:""},{default:l(()=>[(s(!0),C(D,null,U(n(Q),e=>(s(),f(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"类型",prop:"workType"},{default:l(()=>[t(g,{modelValue:n(u).workType,"onUpdate:modelValue":a[3]||(a[3]=e=>n(u).workType=e),placeholder:"请选择类型",clearable:""},{default:l(()=>[(s(!0),C(D,null,U(n(z),e=>(s(),f(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"标题或内容",prop:"workTitle","label-width":"90"},{default:l(()=>[t(T,{modelValue:n(u).workTitle,"onUpdate:modelValue":a[4]||(a[4]=e=>n(u).workTitle=e),placeholder:"请输入标题或内容"},null,8,["modelValue"])]),_:1}),t(c,null,{default:l(()=>[t(p,{type:"primary",icon:"Search",onClick:N},{default:l(()=>[m("搜索")]),_:1}),t(p,{icon:"Refresh",onClick:Ce},{default:l(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[fe,W.value]])]),_:1},8,["enter-active-class","leave-active-class"]),t(ne,{shadow:"never"},{header:l(()=>[t(Me,{gutter:10,class:"mb8"},{default:l(()=>[t(E,{span:1.5},{default:l(()=>[h((s(),f(p,{type:"primary",plain:"",icon:"Plus",onClick:Pe},{default:l(()=>[m("新增")]),_:1})),[[A,["workInfo:workInfo:add"]]])]),_:1}),t(E,{span:1.5},{default:l(()=>[h((s(),f(p,{type:"success",plain:"",icon:"Edit",disabled:X.value,onClick:a[5]||(a[5]=e=>ae())},{default:l(()=>[m("修改")]),_:1},8,["disabled"])),[[A,["workInfo:workInfo:edit"]]])]),_:1}),t(E,{span:1.5},{default:l(()=>[h((s(),f(p,{type:"danger",plain:"",icon:"Delete",disabled:K.value,onClick:a[6]||(a[6]=e=>Se())},{default:l(()=>[m("删除")]),_:1},8,["disabled"])),[[A,["workInfo:workInfo:remove"]]])]),_:1}),t(E,{span:1.5},{default:l(()=>[h((s(),f(p,{type:"warning",plain:"",icon:"Download",onClick:Le},{default:l(()=>[m("导出")]),_:1})),[[A,["workInfo:workInfo:export"]]])]),_:1}),t(je,{showSearch:W.value,"onUpdate:showSearch":a[7]||(a[7]=e=>W.value=e),onQueryTable:b},null,8,["showSearch"])]),_:1})]),default:l(()=>[h((s(),f($e,{data:J.value,onSelectionChange:Ae},{default:l(()=>[t(_,{type:"selection",width:"45",align:"center"}),t(_,{label:"流水号",prop:"number",width:"180"},{default:l(e=>[t(p,{type:"primary",link:"",onClick:B=>Ie(e.row)},{default:l(()=>[m(S(e.row.number),1)]),_:2},1032,["onClick"])]),_:1}),t(_,{label:"标题",prop:"workTitle"},{default:l(e=>[y("span",null,S(e.row.workTitle),1)]),_:1}),t(_,{label:"状态",align:"center",width:"120",prop:"state"},{default:l(e=>[t(re,{options:n(Q),value:e.row.state},null,8,["options","value"])]),_:1}),t(_,{label:"类型",align:"center",width:"95",prop:"workType"},{default:l(e=>[t(re,{options:n(z),value:e.row.workType},null,8,["options","value"])]),_:1}),t(_,{label:"接收人",width:"110",prop:"acceptAccountName"}),t(_,{label:"对接人",width:"110",prop:"contactPerson"}),t(_,{label:"创建时间",align:"center",prop:"createTime",width:"150"},{default:l(e=>[y("span",null,S(o.parseTime(e.row.createTime)),1)]),_:1}),t(_,{label:"完成时间",align:"center",prop:"createTime",width:"150"},{default:l(e=>[y("span",null,S(o.parseTime(e.row.finishTime)),1)]),_:1}),t(_,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(e=>[e.row.acceptAccount==n(Z)&&e.row.state=="2"?(s(),f(p,{key:0,type:"warning",onClick:B=>Ne(e.row)},{default:l(()=>[m(" 接收 ")]),_:2},1032,["onClick"])):L("",!0),e.row.acceptAccount==n(Z)&&e.row.state=="3"?(s(),f(p,{key:1,type:"success",onClick:B=>De(e.row)},{default:l(()=>[m("完成")]),_:2},1032,["onClick"])):L("",!0),t(We,{content:"修改",placement:"top"},{default:l(()=>[e.row.state==="2"?h((s(),f(p,{key:0,type:"primary",icon:"Edit",onClick:B=>ae(e.row)},null,8,["onClick"])),[[A,["workInfo:workInfo:edit"]]]):L("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[He,V.value]]),h(t(Re,{page:n(u).pageNum,"onUpdate:page":a[8]||(a[8]=e=>n(u).pageNum=e),limit:n(u).pageSize,"onUpdate:limit":a[9]||(a[9]=e=>n(u).pageSize=e),total:R.value,onPagination:b},null,8,["page","limit","total"]),[[fe,R.value>0]])]),_:1}),t(ue,{modelValue:n(w).visible,"onUpdate:modelValue":a[17]||(a[17]=e=>n(w).visible=e),title:n(w).title,width:"auto","append-to-body":""},{footer:l(()=>[y("div",Pt,[t(p,{loading:M.value,type:"primary",onClick:Ee},{default:l(()=>[m("确 定")]),_:1},8,["loading"]),t(p,{onClick:Te},{default:l(()=>[m("取 消")]),_:1})])]),default:l(()=>[t(c,{label:"工单类型",prop:"mode"},{default:l(()=>[t(Fe,{modelValue:n(r).mode,"onUpdate:modelValue":a[10]||(a[10]=e=>n(r).mode=e)},{default:l(()=>[t(se,{label:"A"},{default:l(()=>[m("会议保障")]),_:1}),t(se,{label:"B"},{default:l(()=>[m("故障处理")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"标题",prop:"workTitle","label-width":"80px"},{default:l(()=>[t(T,{modelValue:n(r).workTitle,"onUpdate:modelValue":a[11]||(a[11]=e=>n(r).workTitle=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(oe,{ref_key:"workInfoFormRef",ref:q,model:n(r),"label-width":"80px"},{default:l(()=>[t(c,{label:"等级",prop:"workLevel"},{default:l(()=>[t(g,{modelValue:n(r).workLevel,"onUpdate:modelValue":a[12]||(a[12]=e=>n(r).workLevel=e),placeholder:"请选择工单等级"},{default:l(()=>[(s(!0),C(D,null,U(n(we),e=>(s(),f(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"处理人",prop:"contactPerson"},{default:l(()=>[t(T,{modelValue:n(r).contactPerson,"onUpdate:modelValue":a[13]||(a[13]=e=>n(r).contactPerson=e),placeholder:"请输入处理人"},null,8,["modelValue"])]),_:1}),t(c,{label:"开始时间",style:{width:"666px"}},{default:l(()=>[t(ie,{modelValue:n(r).startTime,"onUpdate:modelValue":a[14]||(a[14]=e=>n(r).startTime=e),type:"datetime",placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"MMM DD, YYYY","time-format":"HH:mm"},null,8,["modelValue"])]),_:1}),t(c,{label:"结束时间",style:{width:"666px"}},{default:l(()=>[t(ie,{modelValue:n(r).endTime,"onUpdate:modelValue":a[15]||(a[15]=e=>n(r).endTime=e),type:"datetime",placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"MMM DD, YYYY","time-format":"HH:mm"},null,8,["modelValue"])]),_:1}),t(c,{label:"接收人"},{default:l(()=>[t(T,{modelValue:n(r).acceptAccountName,"onUpdate:modelValue":a[16]||(a[16]=e=>n(r).acceptAccountName=e),placeholder:"",style:{width:"120px"},readonly:!0,disabled:!0},null,8,["modelValue"]),t(p,{type:"primary",plain:"",icon:"Plus",onClick:Ye},{default:l(()=>[m("请选择接收人")]),_:1})]),_:1})]),_:1},8,["model"]),t(gt,{ref_key:"selectRef",ref:G,"parent-form":n(r),onOk:N,onSetAcceptAccount:Ve},null,8,["parent-form"])]),_:1},8,["modelValue","title"]),t(yt,{ref_key:"finishWork",ref:j,"data-object":n(k),onOk:N,onFreshList:b},null,8,["data-object"]),t(ht,{ref_key:"workLog",ref:ke,"data-object":n(k)},null,8,["data-object"]),t(ue,{modelValue:I.value,"onUpdate:modelValue":a[19]||(a[19]=e=>I.value=e),title:"流程跟踪",width:"80%"},{footer:l(()=>[y("div",Ut,[t(p,{type:"primary",onClick:a[18]||(a[18]=e=>I.value=!1)},{default:l(()=>[m(" 关闭 ")]),_:1})])]),default:l(()=>[y("div",null,[I.value?(s(),f(Vt,{key:0,"process-data":n(F)},null,8,["process-data"])):L("",!0)])]),_:1},8,["modelValue"])])],64)}}});export{_l as default};
