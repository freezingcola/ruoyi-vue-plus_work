import{d as ve,a as Qe,V as Me,aa as de,r as c,h as ce,Y as $,b as Ge,$ as pe,o as i,c as I,k as t,m as o,e as l,x as V,w as v,M as T,N as A,p as d,y as p,a7 as me,ab as He,a3 as fe,T as _e,q as P,aw as Je,O as Xe,P as Ye,C as Ke,G as Ze,H as et,a0 as tt,W as lt,X as at,a8 as ot,ac as nt,a9 as rt,D as st,am as it,v as ut}from"./index-BoCONcAc.js";import{_ as dt}from"./index-DG7XexN9.js";import{_ as ct}from"./index.vue_vue_type_style_index_0_lang-Dyb-nOKR.js";import{_ as pt}from"./index-B1KNwlHH.js";/* empty css                 *//* empty css                    */import{_ as mt}from"./index-Xwb6tvPf.js";import{_ as ft}from"./index-BXJ8XT-L.js";/* empty css                        *//* empty css               */import{_ as _t}from"./index-B4NenLWv.js";/* empty css               *//* empty css                *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{l as vt,e as kt,f as wt,u as gt,h as bt,i as yt}from"./index-DABdJVQF.js";import{_ as ht}from"./selectUser.vue_vue_type_script_setup_true_name_SelectUser_lang-D3fIYqfe.js";import{_ as Vt}from"./finishWork.vue_vue_type_script_setup_true_name_InfoLog_lang-CzfZG0QT.js";import{_ as Ct}from"./workLog.vue_vue_type_script_setup_true_name_SelectUser_lang-D4fAoFFQ.js";import It from"./process-k7O-Cf4R.js";/* empty css                *//* empty css                    *//* empty css                */import"./index-hgsK1_Ho.js";/* empty css                       *//* empty css                 */import"./index-hmiVVuGg.js";/* empty css                        *//* empty css                */const Tt=V("div",{style:{height:"0px"}},null,-1),Nt={class:"p-2"},At={class:"mb-[10px]"},Ut=["onClick"],$t={class:"dialog-footer"},St={class:"dialog-footer"},jt=ve({name:"WorkInfo"}),ul=ve({...jt,setup(Et){const z=Qe();console.log(z.currentRoute.value.query,"router");const{proxy:s}=Me(),{work_info_type:R,work_info_state:Q,test_xm:ke,test_fl:we,test_dj:ge}=de(s==null?void 0:s.useDict("work_info_type","work_info_state","test_xm","test_fl","test_dj")),M=c(),G=c(),W=c(),H=c([]),S=c(!1),U=c(!0),j=c(!0),E=c([]),J=c(!0),X=c(!0),q=c(0),Y=ce().userId,be=ce(),F=$({someProperty:""}),K=c(),x=c(),k=$({visible:!1,title:""}),g=$({}),Z={id:void 0,workTitle:void 0,workContent:void 0,state:void 0,workType:void 0,projectName:void 0,workLevel:void 0,classificationType:void 0,acceptAccount:void 0,acceptAccountName:void 0,attachs:void 0,attachIds:void 0},ye=$({form:{...Z},queryParams:{pageNum:1,pageSize:10,workTitle:void 0,workContent:void 0,state:void 0,workType:void 0,projectName:void 0,workLevel:void 0,classificationType:void 0,attachs:void 0,attachIds:void 0,acceptAccount:void 0,acceptAccountName:void 0,params:{}},rules:{workTitle:[{required:!0,message:"标题不能为空",trigger:"blur"}],workContent:[{required:!0,message:"内容不能为空",trigger:"blur"}],workType:[{required:!0,message:"类型不能为空",trigger:"change"}],workLevel:[{required:!0,message:"类型不能为空",trigger:"change"}],classificationType:[{required:!0,message:"类型不能为空",trigger:"change"}],projectName:[{required:!0,message:"项目名称不能为空",trigger:"change"}]}}),{queryParams:f,form:r,rules:he}=de(ye),b=async()=>{U.value=!0,console.log("事件列表查询信息-----"+z.currentRoute.value.query.state);const n=await vt(f.value);H.value=n.rows,q.value=n.total,U.value=!1},Ve=n=>{r.value.acceptAccount=n.userId,r.value.acceptAccountName=n.nickName},Ce=()=>{O(),k.visible=!1},C=c(!1),Ie=n=>{console.log(n.number),console.log(C.value),F.someProperty=n.number,console.log(F,1111),C.value=!0},O=()=>{var n;r.value={...Z},(n=x.value)==null||n.resetFields()},Te=()=>{var n;(n=K.value)==null||n.resetFields(),D()},Ne=n=>{var a;(a=W.value)==null||a.show(),g.row=n,g.type="finishAudit",g.title="审核工作成果"},Ae=n=>{var a;(a=W.value)==null||a.show(),g.row=n,g.type="finishWork",g.title="完成工单"},Ue=()=>{var n;(n=M.value)==null||n.show()},$e=n=>{var a;(a=G.value)==null||a.show(n)},D=()=>{f.value.pageNum=1,b()},Se=n=>{E.value=n.map(a=>a.id),J.value=n.length!=1,X.value=!n.length},je=()=>{O(),k.visible=!0,k.title="添加工单管理",console.log("开始查询"),getWorkProjectList()},Ee=async n=>{const a=(n==null?void 0:n.id)||E.value;await(s==null?void 0:s.$modal.confirm('是否确认接收管理编号为"'+a+'"的工单？').finally(()=>U.value=!1)),await kt(a),s==null||s.$modal.msgSuccess("接收成功"),await b()},ee=async n=>{O();const a=(n==null?void 0:n.id)||E.value[0],B=await wt(a);Object.assign(r.value,B.data);let w="";if(r.value.attachs){let m=JSON.parse(r.value.attachs),u=[];for(var y of m)u.push(y.id);w=u.join(","),r.value.attachIds=w}k.visible=!0,k.title="修改工单管理"},De=()=>{var n;(n=x.value)==null||n.validate(async a=>{a&&(S.value=!0,r.value.id?await gt(r.value).finally(()=>S.value=!1):await bt(r.value).finally(()=>S.value=!1),s==null||s.$modal.msgSuccess("操作成功"),k.visible=!1,await b())})},te=async n=>{const a=(n==null?void 0:n.id)||E.value;await(s==null?void 0:s.$modal.confirm('是否确认删除工单管理编号为"'+a+'"的数据项？').finally(()=>U.value=!1)),await yt(a),s==null||s.$modal.msgSuccess("删除成功"),await b()},Le=()=>{s==null||s.download("workInfo/workInfo/export",{...f.value},`workInfo_${new Date().getTime()}.xlsx`)};return $({color:"rgba(0, 0, 0, .15)"}),Ge(()=>{b()}),(n,a)=>{var ie,ue;const B=Je,w=Xe,y=Ye,m=Ke,u=Ze,le=et,ae=tt,L=lt,Pe=_t,Re=at,_=ot,oe=ft,We=mt,ne=nt,qe=rt,Fe=pt,re=st,xe=ct,Oe=dt,se=it,N=pe("hasPermi"),Be=pe("hasRoles"),ze=ut;return i(),I(T,null,[t(B,{style:{position:"static"},content:[l(be).nickname]},{default:o(()=>[Tt]),_:1},8,["content"]),V("div",Nt,[t(He,{"enter-active-class":(ie=l(s))==null?void 0:ie.animate.searchAnimate.enter,"leave-active-class":(ue=l(s))==null?void 0:ue.animate.searchAnimate.leave},{default:o(()=>[v(V("div",At,[t(ae,{shadow:"hover"},{default:o(()=>[t(le,{ref_key:"queryFormRef",ref:K,model:l(f),inline:!0},{default:o(()=>[t(m,{label:"状态",prop:"state"},{default:o(()=>[t(y,{modelValue:l(f).state,"onUpdate:modelValue":a[0]||(a[0]=e=>l(f).state=e),placeholder:"请选择状态",clearable:""},{default:o(()=>[(i(!0),I(T,null,A(l(Q),e=>(i(),d(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"类型",prop:"workType"},{default:o(()=>[t(y,{modelValue:l(f).workType,"onUpdate:modelValue":a[1]||(a[1]=e=>l(f).workType=e),placeholder:"请选择类型",clearable:""},{default:o(()=>[(i(!0),I(T,null,A(l(R),e=>(i(),d(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:o(()=>[t(u,{type:"primary",icon:"Search",onClick:D},{default:o(()=>[p("搜索")]),_:1}),t(u,{icon:"Refresh",onClick:Te},{default:o(()=>[p("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[me,l(j)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(ae,{shadow:"never"},{header:o(()=>[t(Re,{gutter:10,class:"mb8"},{default:o(()=>[t(L,{span:1.5},{default:o(()=>[v((i(),d(u,{type:"primary",plain:"",icon:"Plus",onClick:je},{default:o(()=>[p("新增")]),_:1})),[[N,["workInfo:workInfo:add"]]])]),_:1}),t(L,{span:1.5},{default:o(()=>[v((i(),d(u,{type:"success",plain:"",icon:"Edit",disabled:l(J),onClick:a[2]||(a[2]=e=>ee())},{default:o(()=>[p("修改")]),_:1},8,["disabled"])),[[N,["workInfo:workInfo:edit"]]])]),_:1}),t(L,{span:1.5},{default:o(()=>[v((i(),d(u,{type:"danger",plain:"",icon:"Delete",disabled:l(X),onClick:a[3]||(a[3]=e=>te())},{default:o(()=>[p("删除")]),_:1},8,["disabled"])),[[N,["workInfo:workInfo:remove"]]])]),_:1}),t(L,{span:1.5},{default:o(()=>[v((i(),d(u,{type:"warning",plain:"",icon:"Download",onClick:Le},{default:o(()=>[p("导出")]),_:1})),[[N,["workInfo:workInfo:export"]]])]),_:1}),t(Pe,{showSearch:l(j),"onUpdate:showSearch":a[4]||(a[4]=e=>fe(j)?j.value=e:null),onQueryTable:b},null,8,["showSearch"])]),_:1})]),default:o(()=>[v((i(),d(qe,{data:l(H),onSelectionChange:Se},{default:o(()=>[t(_,{type:"selection",width:"55",align:"center"}),t(_,{label:"流水号",align:"center",prop:"number",width:"150"},{default:o(e=>[V("span",{style:{color:"#009fff"},onClick:h=>Ie(e.row)},_e(e.row.number),9,Ut)]),_:1}),t(_,{label:"标题",align:"center",prop:"workTitle"}),t(_,{label:"项目名称",align:"center",prop:"projectName"}),t(_,{label:"状态",align:"center",prop:"state"},{default:o(e=>[t(oe,{options:l(Q),value:e.row.state},null,8,["options","value"])]),_:1}),t(_,{label:"类型",align:"center",prop:"workType"},{default:o(e=>[t(oe,{options:l(R),value:e.row.workType},null,8,["options","value"])]),_:1}),t(_,{label:"创建人",align:"center",prop:"createByName"}),t(_,{label:"接收人",align:"center",prop:"acceptAccountName"}),t(_,{label:"附件",align:"center"},{default:o(e=>[t(We,{modelValue:e.row.attachs,"onUpdate:modelValue":h=>e.row.attachs=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(_,{label:"创建时间",align:"center",prop:"createTime",width:"200"},{default:o(e=>[V("span",null,_e(n.parseTime(e.row.createTime)),1)]),_:1}),t(_,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(e=>[t(ne,{content:"修改",placement:"top"},{default:o(()=>[v(t(u,{link:"",type:"primary",icon:"Edit",onClick:h=>ee(e.row)},null,8,["onClick"]),[[N,["workInfo:workInfo:edit"]]])]),_:2},1024),t(ne,{content:"删除",placement:"top"},{default:o(()=>[v(t(u,{link:"",type:"primary",icon:"Delete",onClick:h=>te(e.row)},null,8,["onClick"]),[[N,["workInfo:workInfo:remove"]]])]),_:2},1024),e.row.acceptAccount==l(Y)&&e.row.state=="2"?(i(),d(u,{key:0,link:"",type:"text",class:"el-button--primary",onClick:h=>Ee(e.row)},{default:o(()=>[p("接收")]),_:2},1032,["onClick"])):P("",!0),e.row.acceptAccount==l(Y)&&e.row.state=="3"?(i(),d(u,{key:1,link:"",type:"text",class:"el-button--primary",onClick:h=>Ae(e.row)},{default:o(()=>[p("完成")]),_:2},1032,["onClick"])):P("",!0),e.row.state=="4"?v((i(),d(u,{key:2,link:"",type:"text",class:"el-button--primary",onClick:h=>Ne(e.row)},{default:o(()=>[p("审核")]),_:2},1032,["onClick"])),[[Be,["wf_captain"]]]):P("",!0),t(u,{link:"",type:"text",class:"el-button--primary",onClick:h=>$e(e.row)},{default:o(()=>[p("处理过程12312")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ze,l(U)]]),v(t(Fe,{page:l(f).pageNum,"onUpdate:page":a[5]||(a[5]=e=>l(f).pageNum=e),limit:l(f).pageSize,"onUpdate:limit":a[6]||(a[6]=e=>l(f).pageSize=e),total:l(q),onPagination:b},null,8,["page","limit","total"]),[[me,l(q)>0]])]),_:1}),t(se,{modelValue:l(k).visible,"onUpdate:modelValue":a[15]||(a[15]=e=>l(k).visible=e),title:l(k).title,width:"auto","append-to-body":""},{footer:o(()=>[V("div",$t,[t(u,{loading:l(S),type:"primary",onClick:De},{default:o(()=>[p("确 定")]),_:1},8,["loading"]),t(u,{onClick:Ce},{default:o(()=>[p("取 消")]),_:1})])]),default:o(()=>[t(m,{label:"标题",prop:"workTitle"},{default:o(()=>[t(re,{modelValue:l(r).workTitle,"onUpdate:modelValue":a[7]||(a[7]=e=>l(r).workTitle=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(le,{ref_key:"workInfoFormRef",ref:x,model:l(r),rules:l(he),"label-width":"80px"},{default:o(()=>[t(m,{label:"项目名称",prop:"projectName"},{default:o(()=>[t(y,{modelValue:l(r).projectName,"onUpdate:modelValue":a[8]||(a[8]=e=>l(r).projectName=e),placeholder:"请选择项目名称"},{default:o(()=>[(i(!0),I(T,null,A(l(ke),e=>(i(),d(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"分类",prop:"classificationType"},{default:o(()=>[t(y,{modelValue:l(r).classificationType,"onUpdate:modelValue":a[9]||(a[9]=e=>l(r).classificationType=e),placeholder:"请选择工单分类"},{default:o(()=>[(i(!0),I(T,null,A(l(we),e=>(i(),d(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"类型",prop:"workType"},{default:o(()=>[t(y,{modelValue:l(r).workType,"onUpdate:modelValue":a[10]||(a[10]=e=>l(r).workType=e),placeholder:"请选择工单类型"},{default:o(()=>[(i(!0),I(T,null,A(l(R),e=>(i(),d(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"等级",prop:"workLevel"},{default:o(()=>[t(y,{modelValue:l(r).workLevel,"onUpdate:modelValue":a[11]||(a[11]=e=>l(r).workLevel=e),placeholder:"请选择工单等级"},{default:o(()=>[(i(!0),I(T,null,A(l(ge),e=>(i(),d(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"内容"},{default:o(()=>[t(xe,{modelValue:l(r).workContent,"onUpdate:modelValue":a[12]||(a[12]=e=>l(r).workContent=e),"min-height":192},null,8,["modelValue"])]),_:1}),t(m,{label:"附件",prop:"attachIds"},{default:o(()=>[t(Oe,{modelValue:l(r).attachIds,"onUpdate:modelValue":a[13]||(a[13]=e=>l(r).attachIds=e)},null,8,["modelValue"])]),_:1}),t(m,{label:"接收人"},{default:o(()=>[t(re,{modelValue:l(r).acceptAccountName,"onUpdate:modelValue":a[14]||(a[14]=e=>l(r).acceptAccountName=e),placeholder:"",style:{width:"120px"},readonly:!0,disabled:!0},null,8,["modelValue"]),t(u,{type:"primary",plain:"",icon:"Plus",onClick:Ue},{default:o(()=>[p("请选择接收人")]),_:1})]),_:1})]),_:1},8,["model","rules"]),t(ht,{ref_key:"selectRef",ref:M,"parent-form":l(r),onOk:D,onSetAcceptAccount:Ve},null,8,["parent-form"])]),_:1},8,["modelValue","title"]),t(Vt,{ref_key:"finishWork",ref:W,"data-object":l(g),onOk:D,onFreshList:b},null,8,["data-object"]),t(Ct,{ref_key:"workLog",ref:G,"data-object":l(g)},null,8,["data-object"]),t(se,{modelValue:l(C),"onUpdate:modelValue":a[17]||(a[17]=e=>fe(C)?C.value=e:null),title:"流程跟踪",width:"80%"},{footer:o(()=>[V("div",St,[t(u,{type:"primary",onClick:a[16]||(a[16]=e=>C.value=!1)},{default:o(()=>[p(" 关闭 ")]),_:1})])]),default:o(()=>[V("div",null,[l(C)?(i(),d(It,{key:0,"process-data":l(F)},null,8,["process-data"])):P("",!0)])]),_:1},8,["modelValue"])])],64)}}});export{ul as default};
